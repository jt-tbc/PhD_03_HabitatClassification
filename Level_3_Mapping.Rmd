---
title: "Mapping"
author: "Joe Turner"
date: "30 March 2017"
output: pdf_document
---

```{read in data and packages, include=FALSE}

###################################
#### READ IN DATA AND PACKAGES ####
###################################

library(rpart)
library(tree)
library(randomForest)
library(e1071)
library(plyr)
library(vegan)
library(doBy)
library(rgdal)
library(clustsig)
library(gdata)
library(ggplot2)
library(scales)
library(ggrepel)
library(RColorBrewer)
library(reshape2)
library(reshape)
library(grid)
library(dplR)
library(gridExtra)
library(Hmisc)
library(corrplot)
library(PerformanceAnalytics)
library(raster)
st.err <- function(x) {sd(x)/sqrt(length(x))}

setwd("C:/OneDrive/C3_Map")
GT <- read.csv("8_GIS_GT_Intercept_5m_9999_Removed.csv", header = TRUE)
Helby <- read.csv("9_HelbyBanks_GT_5m.csv", header = TRUE)
Tanta <- read.csv("10_Tantabiddi_GT_5m.csv", header = TRUE)
Mgrove <- read.csv("11_Mangrove_GT_5m.csv", header = TRUE)
South <- read.csv("12_SouthSite_GT_5m.csv", header = TRUE)

setwd("C:/OneDrive/C3_Map/PointsForPrediction")

HBpoints <- read.csv("Helby_Predict_5m.csv", header = TRUE)
TBpoints <- read.csv("Tanta_Predict_5m.csv", header = TRUE)
MGpoints <- read.csv("Mangrove_Predict_5m.csv", header = TRUE)
SSpoints <- read.csv("South_Predict_5m.csv", header = TRUE)
points1 <- read.csv("AllSites_Predict_5m_1.csv", header = TRUE)
points2 <- read.csv("AllSites_Predict_5m_2.csv", header = TRUE)
points3 <- read.csv("AllSites_Predict_5m_3.csv", header = TRUE)

setwd("C:/OneDrive/C3_Map")

```

```{r correlation matrix}

############################
#### CORRELATION MATRIX ####
############################

# http://www.sthda.com/english/wiki/correlation-matrix-a-quick-start-guide-to-analyze-format-and-visualize-a-correlation-matrix-using-r-software

cor <- cor(GT[,32:62])
round(cor, 2)
corrplot(cor, method="number")
corrplot(cor, type="lower")

# can caluculate a correlation matrix with significance levels

cor2 <- rcorr(as.matrix(GT[,32:62]))
cor2
# Extract the correlation coefficients
cor2$r
# Extract p-values
cor2$P

# flattenCorrMatrix
# ++++++++++++++++++++++++++++
# cormat : matrix of the correlation coefficients
# pmat : matrix of the correlation p-values
flattenCorrMatrix <- function(cormat, pmat) {
  ut <- upper.tri(cormat)
  data.frame(
    row = rownames(cormat)[row(cormat)[ut]],
    column = rownames(cormat)[col(cormat)[ut]],
    cor  =(cormat)[ut],
    p = pmat[ut]
    )
}

res2<-rcorr(as.matrix(GT[,32:62]))
CorMatrix <- flattenCorrMatrix(res2$r, res2$P)
write.csv(CorMatrix, "8_Correlation_Matrix.csv")

# Insignificant correlation are left blank
corrplot(res2$r, type="upper", order="hclust", 
         p.mat = res2$P, sig.level = 0.01, insig = "blank")


# draw scatter plots
chart.Correlation(GT[,32:62], histogram=TRUE, pch=19)

```


```{r select training and evaluation data}

##############################
#### SELECT TRAINING DATA ####
##############################

set.seed(387)  

# For all data
size.modeldata <- round(0.75 * nrow(GT))
model  <- GT[sample ( 1:nrow(GT), size.modeldata, replace = FALSE),]
test <- GT[- c( sample ( 1:nrow(GT), size.modeldata, replace = FALSE) ),]

# For Helby Banks
HBsize.modeldata <- round(0.75 * nrow(Helby))
HBmodel  <- Helby[sample ( 1:nrow(Helby), HBsize.modeldata, replace = FALSE),]
HBtest <- Helby[- c( sample ( 1:nrow(Helby), HBsize.modeldata, replace = FALSE) ),]

# For Tantabiddi
TBsize.modeldata <- round(0.75 * nrow(Tanta))
TBmodel  <- Tanta[sample ( 1:nrow(Tanta), TBsize.modeldata, replace = FALSE),]
TBtest <- Tanta[- c( sample ( 1:nrow(Tanta), TBsize.modeldata, replace = FALSE) ),]

# For Mangrove
MGsize.modeldata <- round(0.75 * nrow(Mgrove))
MGmodel  <- Mgrove[sample ( 1:nrow(Mgrove), MGsize.modeldata, replace = FALSE),]
MGtest <- Mgrove[- c( sample ( 1:nrow(Mgrove), MGsize.modeldata, replace = FALSE) ),]

# For Southern Site
SSsize.modeldata <- round(0.75 * nrow(South))
SSmodel  <- South[sample ( 1:nrow(South), SSsize.modeldata, replace = FALSE),]
SStest <- South[- c( sample ( 1:nrow(South), SSsize.modeldata, replace = FALSE) ),]


```


```{r tree classification}

##########################
## CLASSIFICATION TREES ##
##########################


#############################################
#### Level 3 - COBBLE REEF THICK VENEER  ####
#############################################

Lv3CRTV.tree <- tree(as.factor(Lv3_Cobble_Reef_Thick_Veneer) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                        mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")

plot(Lv3CRTV.tree); text(Lv3CRTV.tree,cex=0.5)
Lv3CRTV.tree

# Select the best model variables
Lv3CRTV.tree <- tree(as.factor(Lv3_Cobble_Reef_Thick_Veneer) ~ range25 + BPI_B_250 + mean3 + BScatter + rugosity + 
                       BPI_B_50 + slope + hyp25 + std25 + hyp10,
                        data=model, method = "class")

summary(Lv3CRTV.tree) # MISCLASSIFICATION RATE 0.69%


#################
## Helby Banks ##
#################

HBLv3CRTV.tree <- tree(as.factor(Lv3_Cobble_Reef_Thick_Veneer) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	
                         mean3 +	
                          mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	
                          range10 +	range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	
                          BPI_F_10 + BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= HBmodel, na.action = na.exclude, method = "class")
plot(HBLv3CRTV.tree); text(HBLv3CRTV.tree,cex=0.5)
summary(HBLv3CRTV.tree)

# Select the best model variables
HBLv3CRTV.tree <- tree(as.factor(Lv3_Cobble_Reef_Thick_Veneer) ~ range25 + BPI_B_100 + range10 + BScatter + BPI_B_50 +
                         BPI_F_25 + range3 + mean25 + Depth + mean10 + hyp25 + std3,
                        data=HBmodel, method = "class")

summary(HBLv3CRTV.tree) # MISCLASSIFICATION RATE 0.76%


################
## Tantabiddi ##
################

TBLv3CRTV.tree <- tree(as.factor(Lv3_Cobble_Reef_Thick_Veneer) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	
                         mean3 +	
                          mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	
                          range10 +	range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	
                          BPI_F_10 + BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= TBmodel, na.action = na.exclude, method = "class")
plot(TBLv3CRTV.tree); text(TBLv3CRTV.tree,cex=0.5)
summary(TBLv3CRTV.tree)

# Select the best model variables
TBLv3CRTV.tree <- tree(as.factor(Lv3_Cobble_Reef_Thick_Veneer) ~ range25 + Depth + BPI_F_25 + std3 + range3 + BScatter +
                         std10,
                        data=TBmodel, method = "class")

summary(TBLv3CRTV.tree) # MISCLASSIFICATION RATE 0.34%


##############
## Mangrove ##
##############

# Habitat not observed at Mangrove

###################
## Southern Site ##
###################

# Habitat not observed at Southern Site



########################################################
## Investigating and Pruning the classification trees ##
########################################################

###############
## All sites ##
###############

par(mfrow=c(2,2))               ## makes graphs appear in 2 rows and 2columns - 4 per page

for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3CRTV.fit1  <- cv.tree(Lv3CRTV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3CRTV.fit1)
        summary(Lv3CRTV.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               ## makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6    ### enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3CRTV.prune <- prune.misclass(Lv3CRTV.tree, best = TreeSize) 
        plot(Lv3CRTV.prune); text(Lv3CRTV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3CRTV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))

# 0.71% misclassification, 12 trees
Lv3CRTV.prune <- prune.misclass(Lv3CRTV.tree, best = 12)         # choose best tree size and add value in!!!
plot(Lv3CRTV.prune); text(Lv3CRTV.prune,cex=0.8)

Lv3CRTV.predict <- predict(Lv3CRTV.prune, test, type = c("vector"))
Lv3CRTV.predict <- as.data.frame(Lv3CRTV.predict [,2])
out.predict.Lv3CRTV <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Cobble_Reef_Thick_Veneer, Lv3CRTV.predict))
names(out.predict.Lv3CRTV) <- c("X", "Y", "Lv3CRTV.test", "Lv3CRTV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3CRTV_prune.txt")
Lv3CRTV.prune 
sink()


#################
## Helby Banks ##
#################

par(mfrow=c(2,2))               ## makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        HBLv3CRTV.fit1  <- cv.tree(HBLv3CRTV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(HBLv3CRTV.fit1)
        summary(HBLv3CRTV.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               ## makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6    ### enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        HBLv3CRTV.prune <- prune.misclass(HBLv3CRTV.tree, best = TreeSize) 
        plot(HBLv3CRTV.prune); text(HBLv3CRTV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(HBLv3CRTV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))

# misclassification 1.6%, 8 trees
HBLv3CRTV.prune <- prune.misclass(HBLv3CRTV.tree, best = 8)         # choose best tree size and add value in!!!
plot(HBLv3CRTV.prune); text(HBLv3CRTV.prune,cex=0.8)

HBLv3CRTV.predict <- predict(HBLv3CRTV.prune, HBtest, type = c("vector"))
HBLv3CRTV.predict <- as.data.frame(HBLv3CRTV.predict [,2])
out.predict.HBLv3CRTV <- as.data.frame(cbind(HBtest$Long, HBtest$Lat, 
   HBtest$Lv3_Cobble_Reef_Thick_Veneer, HBLv3CRTV.predict))
names(out.predict.HBLv3CRTV) <- c("X", "Y", "Lv3CRTV.test", "Lv3CRTV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/HB_Lv3CRTV_prune.txt")
HBLv3CRTV.prune 
sink()


#################
## Tantabiddi ##
#################

par(mfrow=c(2,2))               ## makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        TBLv3CRTV.fit1  <- cv.tree(TBLv3CRTV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(TBLv3CRTV.fit1)
        summary(TBLv3CRTV.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               ## makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <-4    ### enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        TBLv3CRTV.prune <- prune.misclass(TBLv3CRTV.tree, best = TreeSize) 
        plot(TBLv3CRTV.prune); text(TBLv3CRTV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(TBLv3CRTV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))

# misclassification 0.34%, 8 trees
TBLv3CRTV.prune <- prune.misclass(TBLv3CRTV.tree, best = 8)         # choose best tree size and add value in!!!
plot(TBLv3CRTV.prune); text(TBLv3CRTV.prune,cex=0.8)

TBLv3CRTV.predict <- predict(TBLv3CRTV.prune, TBtest, type = c("vector"))
TBLv3CRTV.predict <- as.data.frame(TBLv3CRTV.predict [,2])
out.predict.TBLv3CRTV <- as.data.frame(cbind(TBtest$Long, TBtest$Lat, 
   TBtest$Lv3_Cobble_Reef_Thick_Veneer, TBLv3CRTV.predict))
names(out.predict.TBLv3CRTV) <- c("X", "Y", "Lv3CRTV.test", "Lv3CRTV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/TB_Lv3CRTV_prune.txt")
TBLv3CRTV.prune 
sink()



##############
## Predict  ##
##############



###############
## ALL SITES ##
###############

Lv3CRTV.rs.predict1 <- predict(Lv3CRTV.prune, points1, type = c("vector"))
Lv3CRTV.predict1 <- as.data.frame(Lv3CRTV.rs.predict1[,2])
pred.Lv3CRTV1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3CRTV.predict1))
names(pred.Lv3CRTV1) <- c("X","Y", "predLv3CRTV")

Lv3CRTV.rs.predict2 <- predict(Lv3CRTV.prune, points2, type = c("vector"))
Lv3CRTV.predict2 <- as.data.frame(Lv3CRTV.rs.predict2[,2])
pred.Lv3CRTV2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3CRTV.predict2))
names(pred.Lv3CRTV2) <- c("X","Y", "predLv3CRTV")

Lv3CRTV.rs.predict3 <- predict(Lv3CRTV.prune, points3, type = c("vector"))
Lv3CRTV.predict3 <- as.data.frame(Lv3CRTV.rs.predict3[,2])
pred.Lv3CRTV3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3CRTV.predict3))
names(pred.Lv3CRTV3) <- c("X","Y", "predLv3CRTV")


#########################
## Helby Banks Predict ##
#########################

HB.Lv3CRTV.rs.predict <- predict(HBLv3CRTV.prune, HBpoints, type = c("vector"))
HB.Lv3CRTV.predict <- as.data.frame(HB.Lv3CRTV.rs.predict[,2])
predHB.Lv3CRTV <- as.data.frame(cbind(HBpoints$Long, HBpoints$Lat,  HB.Lv3CRTV.predict))
names(predHB.Lv3CRTV) <- c("X","Y", "predLv3CRTV")


#########################
## Tantabiddi Predict ##
#########################

TB.Lv3CRTV.rs.predict <- predict(TBLv3CRTV.prune, TBpoints, type = c("vector"))
TB.Lv3CRTV.predict <- as.data.frame(TB.Lv3CRTV.rs.predict[,2])
predTB.Lv3CRTV <- as.data.frame(cbind(TBpoints$Long, TBpoints$Lat,  TB.Lv3CRTV.predict))
names(predTB.Lv3CRTV) <- c("X","Y", "predLv3CRTV")


#####################
## Export to ASCII ##
#####################

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")


# All Sites
coordinates(pred.Lv3CRTV1) <- ~X+Y
ext <- extent(pred.Lv3CRTV1)
table(diff(pred.Lv3CRTV1@coords[,1]))
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3CRTV1, r, 'predLv3CRTV')
writeRaster(to_ascii,'AllLv3CRTkV1.asc', format='ascii')

coordinates(pred.Lv3CRTV2) <- ~X+Y
ext2 <- extent(pred.Lv3CRTV2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3CRTV2, r2, 'predLv3CRTV')
writeRaster(to_ascii2,'AllLv3CRTkV2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3CRTV3) <- ~X+Y
ext3 <- extent(pred.Lv3CRTV3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3CRTV3, r3, 'predLv3CRTV')
writeRaster(to_ascii3,'AllLv3CRTkV3.asc', format='ascii')


# Helby Banks
coordinates(predHB.Lv3CRTV) <- ~X+Y
extHB <- extent(predHB.Lv3CRTV)
table(diff(predHB.Lv3CRTV@coords[,1]))
rHB <- raster(ext=extHB,res=0.0000483000000031097)
to_asciiHB <- rasterize(predHB.Lv3CRTV, rHB, 'predLv3CRTV')
writeRaster(to_asciiHB,'HBLv3CRTkV.asc', format='ascii')

# Tantabiddi
coordinates(predTB.Lv3CRTV) <- ~X+Y
extTB <- extent(predTB.Lv3CRTV)
table(diff(predTB.Lv3CRTV@coords[,1]))
rTB <- raster(ext=extTB,res=0.0000483000000031097)
to_asciiTB <- rasterize(predTB.Lv3CRTV, rTB, 'predLv3CRTV')
writeRaster(to_asciiTB,'TBLv3CRTkV.asc', format='ascii')


################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3CRTV, "27_OutPredict_All_Lv3CRTV_5m.csv")
write.csv(out.predict.HBLv3CRTV, "28_OutPredict_HB_Lv3CRTV_5m.csv")
write.csv(out.predict.TBLv3CRTV, "62_OutPredict_TB_Lv3CRTV_5m.csv")

```












```{r}

###########################################
#### Level 3 - COBBLE REEF THIN VENEER ####
###########################################

Lv3CRThinV.tree <- tree(as.factor(Lv3_Cobble_Reef_Thin_Veneer) ~ curv +	curv_plan +	curv_prof +	slope +	
                          mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                          range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3CRThinV.tree); text(Lv3CRThinV.tree,cex=0.5)
summary(Lv3CRThinV.tree)


# Select the best model variables
Lv3CRThinV.tree <- tree(as.factor(Lv3_Cobble_Reef_Thin_Veneer) ~ mean25 + BPI_B_50 + BPI_B_250 + mean3 + BScatter +
                          range5 + std5 + hyp10 + range25 + BPI_B_100 + hyp3 + hyp25,
                        data=model, method = "class")

summary(Lv3CRThinV.tree) # MISCLASSIFICATION RATE 2.1%


#################
## Helby Banks ##
#################

HBLv3CRThinV.tree <- tree(as.factor(Lv3_Cobble_Reef_Thin_Veneer) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +
                            mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= HBmodel, na.action = na.exclude, method = "class")
plot(HBLv3CRThinV.tree); text(HBLv3CRThinV.tree,cex=0.5)
summary(HBLv3CRThinV.tree)

# Select the best model variables
HBLv3CRThinV.tree <- tree(as.factor(Lv3_Cobble_Reef_Thin_Veneer) ~ mean10 + BPI_F_25 + std25 + slope + hyp5 + 
                          BPI_B_250 + range10 + std5 + range25 + hyp25 + mean25 + rugosity + curv_plan + range5 +
                            mean5 + BPI_B_100 + std10 + east + mean3,
                        data=HBmodel, method = "class")

summary(HBLv3CRThinV.tree) # MISCLASSIFICATION RATE 2.1%



################
## Tantabiddi ##
################

TBLv3CRThinV.tree <- tree(as.factor(Lv3_Cobble_Reef_Thin_Veneer) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +
                            mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= TBmodel, na.action = na.exclude, method = "class")
plot(TBLv3CRThinV.tree); text(TBLv3CRThinV.tree,cex=0.5)
summary(TBLv3CRThinV.tree)

# Select the best model variables
TBLv3CRThinV.tree <- tree(as.factor(Lv3_Cobble_Reef_Thin_Veneer) ~ BPI_B_50 + slope + range25 + Depth,
                        data=TBmodel, method = "class")

summary(TBLv3CRThinV.tree) # MISCLASSIFICATION RATE 0.03%



##############
## Mangrove ##
##############


MGLv3CRThinV.tree <- tree(as.factor(Lv3_Cobble_Reef_Thin_Veneer) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +
                            mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= MGmodel, na.action = na.exclude, method = "class")
plot(MGLv3CRThinV.tree); text(MGLv3CRThinV.tree,cex=0.5)
summary(MGLv3CRThinV.tree)

# Select the best model variables
MGLv3CRThinV.tree <- tree(as.factor(Lv3_Cobble_Reef_Thin_Veneer) ~ BPI_B_100 + hyp25 + curv_plan + mean25 + range25,
                        data=MGmodel, method = "class")

summary(MGLv3CRThinV.tree) # MISCLASSIFICATION RATE 0.12%



##################
# Southern Site ##
##################

# Habitat not observed at Southern Site




########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3CRThinV.fit1  <- cv.tree(Lv3CRThinV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3CRThinV.fit1)
        summary(Lv3CRThinV.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 8    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3CRThinV.prune <- prune.misclass(Lv3CRThinV.tree, best = TreeSize) 
        plot(Lv3CRThinV.prune); text(Lv3CRThinV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3CRThinV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3CRThinV.prune <- prune.misclass(Lv3CRThinV.tree, best = 8)         # choose best tree size and add value in!!!
plot(Lv3CRThinV.prune); text(Lv3CRThinV.prune,cex=0.8)
summary(Lv3CRThinV.prune) # 2.5% misclassification

Lv3CRThinV.predict <- predict(Lv3CRThinV.prune, test, type = c("vector"))
Lv3CRThinV.predict <- as.data.frame(Lv3CRThinV.predict [,2])
out.predict.Lv3CRThinV <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Cobble_Reef_Thin_Veneer, Lv3CRThinV.predict))
names(out.predict.Lv3CRThinV) <- c("X", "Y", "Lv3CRThinV.test", "Lv3CRThinV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3CRThinV_prune.txt")
Lv3CRThinV.prune 
sink()



###############
# Helby Banks #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        HBLv3CRThinV.fit1  <- cv.tree(HBLv3CRThinV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(HBLv3CRThinV.fit1)
        summary(HBLv3CRThinV.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 8    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        HBLv3CRThinV.prune <- prune.misclass(HBLv3CRThinV.tree, best = TreeSize) 
        plot(HBLv3CRThinV.prune); text(HBLv3CRThinV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(HBLv3CRThinV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


HBLv3CRThinV.prune <- prune.misclass(HBLv3CRThinV.tree, best = 12)         # choose best tree size and add value in!!!
plot(HBLv3CRThinV.prune); text(HBLv3CRThinV.prune,cex=0.8)
summary(HBLv3CRThinV.prune) # misclassification rate 4.1%

HBLv3CRThinV.predict <- predict(HBLv3CRThinV.prune, HBtest, type = c("vector"))
HBLv3CRThinV.predict <- as.data.frame(HBLv3CRThinV.predict [,2])
out.predict.HBLv3CRThinV <- as.data.frame(cbind(HBtest$Long, HBtest$Lat, 
   HBtest$Lv3_Cobble_Reef_Thin_Veneer, HBLv3CRThinV.predict))
names(out.predict.HBLv3CRThinV) <- c("X", "Y", "Lv3CRThinV.test", "Lv3CRThinV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/HB_Lv3CRThinV_prune.txt")
HBLv3CRThinV.prune 
sink()


###############
# Tantabiddi #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        TBLv3CRThinV.fit1  <- cv.tree(TBLv3CRThinV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(TBLv3CRThinV.fit1)
        summary(TBLv3CRThinV.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        TBLv3CRThinV.prune <- prune.misclass(TBLv3CRThinV.tree, best = TreeSize) 
        plot(TBLv3CRThinV.prune); text(TBLv3CRThinV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(TBLv3CRThinV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


TBLv3CRThinV.prune <- prune.misclass(TBLv3CRThinV.tree, best = 2)         # choose best tree size and add value in!!!
plot(TBLv3CRThinV.prune); text(TBLv3CRThinV.prune,cex=0.8)
summary(TBLv3CRThinV.prune) # misclassification rate 0.03%

TBLv3CRThinV.predict <- predict(TBLv3CRThinV.prune, TBtest, type = c("vector"))
TBLv3CRThinV.predict <- as.data.frame(TBLv3CRThinV.predict [,2])
out.predict.TBLv3CRThinV <- as.data.frame(cbind(TBtest$Long, TBtest$Lat, 
   TBtest$Lv3_Cobble_Reef_Thin_Veneer, TBLv3CRThinV.predict))
names(out.predict.TBLv3CRThinV) <- c("X", "Y", "Lv3CRThinV.test", "Lv3CRThinV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/TB_Lv3CRThinV_prune.txt")
TBLv3CRThinV.prune 
sink()



###############
# Mangrove #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        MGLv3CRThinV.fit1  <- cv.tree(MGLv3CRThinV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(MGLv3CRThinV.fit1)
        summary(MGLv3CRThinV.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        MGLv3CRThinV.prune <- prune.misclass(MGLv3CRThinV.tree, best = TreeSize) 
        plot(MGLv3CRThinV.prune); text(MGLv3CRThinV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(MGLv3CRThinV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


MGLv3CRThinV.prune <- prune.misclass(MGLv3CRThinV.tree, best = 4)         # choose best tree size and add value in!!!
plot(MGLv3CRThinV.prune); text(MGLv3CRThinV.prune,cex=0.8)
summary(MGLv3CRThinV.prune) # misclassification rate 0.1%

MGLv3CRThinV.predict <- predict(MGLv3CRThinV.prune, MGtest, type = c("vector"))
MGLv3CRThinV.predict <- as.data.frame(MGLv3CRThinV.predict [,2])
out.predict.MGLv3CRThinV <- as.data.frame(cbind(MGtest$Long, MGtest$Lat, 
   MGtest$Lv3_Cobble_Reef_Thin_Veneer, MGLv3CRThinV.predict))
names(out.predict.MGLv3CRThinV) <- c("X", "Y", "Lv3CRThinV.test", "Lv3CRThinV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/MG_Lv3CRThinV_prune.txt")
MGLv3CRThinV.prune 
sink()


############
# Predict ##
############

Lv3CRThinV.prune
HBLv3CRThinV.prune

###########
# ALL SITES 
###########


Lv3CRThinV.rs.predict1 <- predict(Lv3CRThinV.prune, points1, type = c("vector"))
Lv3CRThinV.predict1 <- as.data.frame(Lv3CRThinV.rs.predict1[,2])
pred.Lv3CRThinV1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3CRThinV.predict1))
names(pred.Lv3CRThinV1) <- c("X","Y", "predLv3CRThinV")

Lv3CRThinV.rs.predict2 <- predict(Lv3CRThinV.prune, points2, type = c("vector"))
Lv3CRThinV.predict2 <- as.data.frame(Lv3CRThinV.rs.predict2[,2])
pred.Lv3CRThinV2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3CRThinV.predict2))
names(pred.Lv3CRThinV2) <- c("X","Y", "predLv3CRThinV")

Lv3CRThinV.rs.predict3 <- predict(Lv3CRThinV.prune, points3, type = c("vector"))
Lv3CRThinV.predict3 <- as.data.frame(Lv3CRThinV.rs.predict3[,2])
pred.Lv3CRThinV3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3CRThinV.predict3))
names(pred.Lv3CRThinV3) <- c("X","Y", "predLv3CRThinV")


#########################
## Helby Banks Predict ##
#########################

HB.Lv3CRThinV.rs.predict <- predict(HBLv3CRThinV.prune, HBpoints, type = c("vector"))
HB.Lv3CRThinV.predict <- as.data.frame(HB.Lv3CRThinV.rs.predict[,2])
predHB.Lv3CRThinV <- as.data.frame(cbind(HBpoints$Long, HBpoints$Lat,  HB.Lv3CRThinV.predict))
names(predHB.Lv3CRThinV) <- c("X","Y", "predLv3CRThinV")

#########################
## Tantabiddi Predict ##
#########################

TB.Lv3CRThinV.rs.predict <- predict(TBLv3CRThinV.prune, TBpoints, type = c("vector"))
TB.Lv3CRThinV.predict <- as.data.frame(TB.Lv3CRThinV.rs.predict[,2])
predTB.Lv3CRThinV <- as.data.frame(cbind(TBpoints$Long, TBpoints$Lat,  TB.Lv3CRThinV.predict))
names(predTB.Lv3CRThinV) <- c("X","Y", "predLv3CRThinV")

#########################
## Mangrove Predict ##
#########################

MG.Lv3CRThinV.rs.predict <- predict(MGLv3CRThinV.prune, MGpoints, type = c("vector"))
MG.Lv3CRThinV.predict <- as.data.frame(MG.Lv3CRThinV.rs.predict[,2])
predMG.Lv3CRThinV <- as.data.frame(cbind(MGpoints$Long, MGpoints$Lat,  MG.Lv3CRThinV.predict))
names(predMG.Lv3CRThinV) <- c("X","Y", "predLv3CRThinV")


#####################
## Export to ASCII ##
#####################

pred.Lv3CRThinV1
pred.Lv3CRThinV2
pred.Lv3CRThinV3
predHB.Lv3CRThinV

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3CRThinV1) <- ~X+Y
ext <- extent(pred.Lv3CRThinV1)
table(diff(pred.Lv3CRThinV1@coords[,1]))
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3CRThinV1, r, 'predLv3CRThinV')
writeRaster(to_ascii,'AllLv3CRTnV1.asc', format='ascii')

coordinates(pred.Lv3CRThinV2) <- ~X+Y
ext2 <- extent(pred.Lv3CRThinV2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3CRThinV2, r2, 'predLv3CRThinV')
writeRaster(to_ascii2,'AllLv3CRTnV2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3CRThinV3) <- ~X+Y
ext3 <- extent(pred.Lv3CRThinV3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3CRThinV3, r3, 'predLv3CRThinV')
writeRaster(to_ascii3,'AllLv3CRTnV3.asc', format='ascii')

# Helby Banks
coordinates(predHB.Lv3CRThinV) <- ~X+Y
extHB <- extent(predHB.Lv3CRThinV)
rHB <- raster(ext=extHB,res=0.0000483000000031097)
to_asciiHB <- rasterize(predHB.Lv3CRThinV, rHB, 'predLv3CRThinV')
writeRaster(to_asciiHB,'HBLv3CRTnV.asc', format='ascii')

# Tantabiddi
coordinates(predTB.Lv3CRThinV) <- ~X+Y
extTB <- extent(predTB.Lv3CRThinV)
rTB <- raster(ext=extTB,res=0.0000483000000031097)
to_asciiTB <- rasterize(predTB.Lv3CRThinV, rTB, 'predLv3CRThinV')
writeRaster(to_asciiTB,'TBLv3CRTnV.asc', format='ascii')

# Mangrove
coordinates(predMG.Lv3CRThinV) <- ~X+Y
extMG <- extent(predMG.Lv3CRThinV)
rMG <- raster(ext=extMG,res=0.0000483000000031097)
to_asciiMG <- rasterize(predMG.Lv3CRThinV, rMG, 'predLv3CRThinV')
writeRaster(to_asciiMG,'MGLv3CRTnV.asc', format='ascii')



################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3CRThinV, "29_OutPredict_All_Lv3CRThinV_5m.csv")
write.csv(out.predict.HBLv3CRThinV, "30_OutPredict_HB_Lv3CRThinV_5m.csv")
write.csv(out.predict.TBLv3CRThinV, "63_OutPredict_TB_Lv3CRThinV_5m.csv")
write.csv(out.predict.MGLv3CRThinV, "64_OutPredict_MG_Lv3CRThinV_5m.csv")

```






```{r}

##########################
#### Level 3 - GRAVEL ####
##########################

Lv3Gravel.tree <- tree(as.factor(Lv3_Gravel) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3Gravel.tree); text(Lv3Gravel.tree,cex=0.5)
summary(Lv3Gravel.tree)


# Select the best model variables
Lv3Gravel.tree <- tree(as.factor(Lv3_Gravel) ~ BPI_B_250 +mean3 + hyp25 + range25 + std25 + std10 + range5 +
                         hyp10 + BScatter + BPI_B_100 + std3,
                        data=model, method = "class")

summary(Lv3Gravel.tree) # MISCLASSIFICATION RATE 0.27%


#################
## Helby Banks ##
#################

HBLv3Gravel.tree <- tree(as.factor(Lv3_Gravel) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= HBmodel, na.action = na.exclude, method = "class")
plot(HBLv3Gravel.tree); text(HBLv3Gravel.tree,cex=0.5)
summary(HBLv3Gravel.tree)

# Select the best model variables
HBLv3Gravel.tree <- tree(as.factor(Lv3_Gravel) ~ hyp25 + Depth + range5 + std5 + mean3 + BPI_F_25,
                        data=HBmodel, method = "class")

summary(HBLv3Gravel.tree) # MISCLASSIFICATION RATE 0.26%



################
## Tantabiddi ##
################

TBLv3Gravel.tree <- tree(as.factor(Lv3_Gravel) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= TBmodel, na.action = na.exclude, method = "class")
plot(TBLv3Gravel.tree); text(TBLv3Gravel.tree,cex=0.5)
summary(TBLv3Gravel.tree)

# Select the best model variables
TBLv3Gravel.tree <- tree(as.factor(Lv3_Gravel) ~ BPI_B_250 + Depth + range10 + range25 + std10 + BScatter + hyp25,
                        data=TBmodel, method = "class")

summary(TBLv3Gravel.tree) # MISCLASSIFICATION RATE 0.64%


##############
## Mangrove ##
##############


# Habitat not observed at Mangrove



##################
# Southern Site ##
##################

# Habitat not observed at Southern Site




########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3Gravel.fit1  <- cv.tree(Lv3Gravel.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3Gravel.fit1)
        summary(Lv3Gravel.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 10    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3Gravel.prune <- prune.misclass(Lv3Gravel.tree, best = TreeSize) 
        plot(Lv3Gravel.prune); text(Lv3Gravel.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3Gravel.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3Gravel.prune <- prune.misclass(Lv3Gravel.tree, best = 12)         # choose best tree size and add value in!!!
plot(Lv3Gravel.prune); text(Lv3Gravel.prune,cex=0.8)
summary(Lv3Gravel.prune) # 0.53% misclassification

Lv3Gravel.predict <- predict(Lv3Gravel.prune, test, type = c("vector"))
Lv3Gravel.predict <- as.data.frame(Lv3Gravel.predict [,2])
out.predict.Lv3Gravel <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Gravel, Lv3Gravel.predict))
names(out.predict.Lv3Gravel) <- c("X", "Y", "Lv3Gravel.test", "Lv3Gravel.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3Gravel_prune.txt")
Lv3Gravel.prune 
sink()



###############
# Helby Banks #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        HBLv3Gravel.fit1  <- cv.tree(HBLv3Gravel.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(HBLv3Gravel.fit1)
        summary(HBLv3Gravel.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        HBLv3Gravel.prune <- prune.misclass(HBLv3Gravel.tree, best = TreeSize) 
        plot(HBLv3Gravel.prune); text(HBLv3Gravel.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(HBLv3Gravel.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


HBLv3Gravel.prune <- prune.misclass(HBLv3Gravel.tree, best = 6)         # choose best tree size and add value in!!!
plot(HBLv3Gravel.prune); text(HBLv3Gravel.prune,cex=0.8)
summary(HBLv3Gravel.prune) # misclassification rate 0.26%

HBLv3Gravel.predict <- predict(HBLv3Gravel.prune, HBtest, type = c("vector"))
HBLv3Gravel.predict <- as.data.frame(HBLv3Gravel.predict [,2])
out.predict.HBLv3Gravel <- as.data.frame(cbind(HBtest$Long, HBtest$Lat, 
   HBtest$Lv3_Gravel, HBLv3Gravel.predict))
names(out.predict.HBLv3Gravel) <- c("X", "Y", "Lv3Gravel.test", "Lv3Gravel.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/HB_Lv3Gravel_prune.txt")
HBLv3Gravel.prune 
sink()


###############
# Tantabiddi #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        TBLv3Gravel.fit1  <- cv.tree(TBLv3Gravel.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(TBLv3Gravel.fit1)
        summary(TBLv3Gravel.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 8    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        TBLv3Gravel.prune <- prune.misclass(TBLv3Gravel.tree, best = TreeSize) 
        plot(TBLv3Gravel.prune); text(TBLv3Gravel.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(TBLv3Gravel.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


TBLv3Gravel.prune <- prune.misclass(TBLv3Gravel.tree, best = 12)         # choose best tree size and add value in!!!
plot(TBLv3Gravel.prune); text(TBLv3Gravel.prune,cex=0.8)
summary(TBLv3Gravel.prune) # misclassification rate 0.91%

TBLv3Gravel.predict <- predict(TBLv3Gravel.prune, TBtest, type = c("vector"))
TBLv3Gravel.predict <- as.data.frame(TBLv3Gravel.predict [,2])
out.predict.TBLv3Gravel <- as.data.frame(cbind(TBtest$Long, TBtest$Lat, 
   TBtest$Lv3_Gravel, TBLv3Gravel.predict))
names(out.predict.TBLv3Gravel) <- c("X", "Y", "Lv3Gravel.test", "Lv3Gravel.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/TB_Lv3Gravel_prune.txt")
TBLv3Gravel.prune 
sink()


############
# Predict ##
############

Lv3Gravel.prune
HBLv3Gravel.prune

###########
# ALL SITES 
###########

Lv3Gravel.rs.predict1 <- predict(Lv3Gravel.prune, points1, type = c("vector"))
Lv3Gravel.predict1 <- as.data.frame(Lv3Gravel.rs.predict1[,2])
pred.Lv3Gravel1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3Gravel.predict1))
names(pred.Lv3Gravel1) <- c("X","Y", "predLv3Gravel")

Lv3Gravel.rs.predict2 <- predict(Lv3Gravel.prune, points2, type = c("vector"))
Lv3Gravel.predict2 <- as.data.frame(Lv3Gravel.rs.predict2[,2])
pred.Lv3Gravel2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3Gravel.predict2))
names(pred.Lv3Gravel2) <- c("X","Y", "predLv3Gravel")

Lv3Gravel.rs.predict3 <- predict(Lv3Gravel.prune, points3, type = c("vector"))
Lv3Gravel.predict3 <- as.data.frame(Lv3Gravel.rs.predict3[,2])
pred.Lv3Gravel3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3Gravel.predict3))
names(pred.Lv3Gravel3) <- c("X","Y", "predLv3Gravel")


#########################
## Helby Banks Predict ##
#########################

HB.Lv3Gravel.rs.predict <- predict(HBLv3Gravel.prune, HBpoints, type = c("vector"))
HB.Lv3Gravel.predict <- as.data.frame(HB.Lv3Gravel.rs.predict[,2])
predHB.Lv3Gravel <- as.data.frame(cbind(HBpoints$Long, HBpoints$Lat,  HB.Lv3Gravel.predict))
names(predHB.Lv3Gravel) <- c("X","Y", "predLv3Gravel")

#########################
## Tantabiddi Predict ##
#########################

TB.Lv3Gravel.rs.predict <- predict(TBLv3Gravel.prune, TBpoints, type = c("vector"))
TB.Lv3Gravel.predict <- as.data.frame(TB.Lv3Gravel.rs.predict[,2])
predTB.Lv3Gravel <- as.data.frame(cbind(TBpoints$Long, TBpoints$Lat,  TB.Lv3Gravel.predict))
names(predTB.Lv3Gravel) <- c("X","Y", "predLv3Gravel")



#####################
## Export to ASCII ##
#####################

pred.Lv3Gravel1
pred.Lv3Gravel2
pred.Lv3Gravel3
predHB.Lv3Gravel

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3Gravel1) <- ~X+Y
ext <- extent(pred.Lv3Gravel1)
table(diff(pred.Lv3Gravel1@coords[,1]))
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3Gravel1, r, 'predLv3Gravel')
writeRaster(to_ascii,'AllLv3Grav1.asc', format='ascii')

coordinates(pred.Lv3Gravel2) <- ~X+Y
ext2 <- extent(pred.Lv3Gravel2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3Gravel2, r2, 'predLv3Gravel')
writeRaster(to_ascii2,'AllLv3Grav2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3Gravel3) <- ~X+Y
ext3 <- extent(pred.Lv3Gravel3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3Gravel3, r3, 'predLv3Gravel')
writeRaster(to_ascii3,'AllLv3Grav3.asc', format='ascii')

# Helby Banks
coordinates(predHB.Lv3Gravel) <- ~X+Y
extHB <- extent(predHB.Lv3Gravel)
rHB <- raster(ext=extHB,res=0.0000483000000031097)
to_asciiHB <- rasterize(predHB.Lv3Gravel, rHB, 'predLv3Gravel')
writeRaster(to_asciiHB,'HBLv3Grav.asc', format='ascii')

# Tantabiddi
coordinates(predTB.Lv3Gravel) <- ~X+Y
extTB <- extent(predTB.Lv3Gravel)
rTB <- raster(ext=extTB,res=0.0000483000000031097)
to_asciiTB <- rasterize(predTB.Lv3Gravel, rTB, 'predLv3Gravel')
writeRaster(to_asciiTB,'TBLv3Grav.asc', format='ascii')

################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3Gravel, "31_OutPredict_All_Lv3Gravel_5m.csv")
write.csv(out.predict.HBLv3Gravel, "32_OutPredict_HB_Lv3Gravel_5m.csv")
write.csv(out.predict.TBLv3Gravel, "65_OutPredict_TB_Lv3Gravel_5m.csv")

```










```{r}

#################################
#### Level 3 - GRAVELLEY SAND ####
#################################

Lv3GrvSnd.tree <- tree(as.factor(Lv3_Gravelly_Sand) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3GrvSnd.tree); text(Lv3GrvSnd.tree,cex=0.5)
summary(Lv3GrvSnd.tree)


# Select the best model variables
Lv3GrvSnd.tree <- tree(as.factor(Lv3_Gravelly_Sand) ~ BPI_B_250 + mean25 + std25 + std5 + mean3 + std10 + BScatter + 
                         range10 + hyp25 + range25,
                        data=model, method = "class")

summary(Lv3GrvSnd.tree) # MISCLASSIFICATION RATE 0.12%


#################
## Helby Banks ##
#################

HBLv3GrvSnd.tree <- tree(as.factor(Lv3_Gravelly_Sand) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= HBmodel, na.action = na.exclude, method = "class")
plot(HBLv3GrvSnd.tree); text(HBLv3GrvSnd.tree,cex=0.5)
summary(HBLv3GrvSnd.tree)

# Select the best model variables
HBLv3GrvSnd.tree <- tree(as.factor(Lv3_Gravelly_Sand) ~ BPI_B_250 + Depth + range10 + std25 + hyp25 + mean25 + std10 +
                           BScatter + slope + range25 + mean10 + hyp10 + rugosity,
                        data=HBmodel, method = "class")

summary(HBLv3GrvSnd.tree) # MISCLASSIFICATION RATE 0.32%



################
## Tantabiddi ##
################

# Habitat not observed at Tantabiddi


##############
## Mangrove ##
##############


# Habitat not observed at Mangrove



##################
# Southern Site ##
##################

# Habitat not observed at Southern Site




########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3GrvSnd.fit1  <- cv.tree(Lv3GrvSnd.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3GrvSnd.fit1)
        summary(Lv3GrvSnd.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3GrvSnd.prune <- prune.misclass(Lv3GrvSnd.tree, best = TreeSize) 
        plot(Lv3GrvSnd.prune); text(Lv3GrvSnd.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3GrvSnd.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3GrvSnd.prune <- prune.misclass(Lv3GrvSnd.tree, best = 6)         # choose best tree size and add value in!!!
plot(Lv3GrvSnd.prune); text(Lv3GrvSnd.prune,cex=0.8)
summary(Lv3GrvSnd.prune) # 1.2% misclassification

Lv3GrvSnd.predict <- predict(Lv3GrvSnd.prune, test, type = c("vector"))
Lv3GrvSnd.predict <- as.data.frame(Lv3GrvSnd.predict [,2])
out.predict.Lv3GrvSnd <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Gravelly_Sand, Lv3GrvSnd.predict))
names(out.predict.Lv3GrvSnd) <- c("X", "Y", "Lv3GrvSnd.test", "Lv3GrvSnd.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3GrvSnd_prune.txt")
Lv3GrvSnd.prune 
sink()



###############
# Helby Banks #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        HBLv3GrvSnd.fit1  <- cv.tree(HBLv3GrvSnd.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(HBLv3GrvSnd.fit1)
        summary(HBLv3GrvSnd.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        HBLv3GrvSnd.prune <- prune.misclass(HBLv3GrvSnd.tree, best = TreeSize) 
        plot(HBLv3GrvSnd.prune); text(HBLv3GrvSnd.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(HBLv3GrvSnd.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


HBLv3GrvSnd.prune <- prune.misclass(HBLv3GrvSnd.tree, best = 6)         # choose best tree size and add value in!!!
plot(HBLv3GrvSnd.prune); text(HBLv3GrvSnd.prune,cex=0.8)
summary(HBLv3GrvSnd.prune) # misclassification rate 1.3%

HBLv3GrvSnd.predict <- predict(HBLv3GrvSnd.prune, HBtest, type = c("vector"))
HBLv3GrvSnd.predict <- as.data.frame(HBLv3GrvSnd.predict [,2])
out.predict.HBLv3GrvSnd <- as.data.frame(cbind(HBtest$Long, HBtest$Lat, 
   HBtest$Lv3_Gravelly_Sand, HBLv3GrvSnd.predict))
names(out.predict.HBLv3GrvSnd) <- c("X", "Y", "Lv3GrvSnd.test", "Lv3GrvSnd.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/HB_Lv3GrvSnd_prune.txt")
HBLv3GrvSnd.prune 
sink()


############
# Predict ##
############

Lv3GrvSnd.prune
HBLv3GrvSnd.prune

###########
# ALL SITES 
###########

Lv3GrvSnd.rs.predict1 <- predict(Lv3GrvSnd.prune, points1, type = c("vector"))
Lv3GrvSnd.predict1 <- as.data.frame(Lv3GrvSnd.rs.predict1[,2])
pred.Lv3GrvSnd1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3GrvSnd.predict1))
names(pred.Lv3GrvSnd1) <- c("X","Y", "predLv3GrvSnd")

Lv3GrvSnd.rs.predict2 <- predict(Lv3GrvSnd.prune, points2, type = c("vector"))
Lv3GrvSnd.predict2 <- as.data.frame(Lv3GrvSnd.rs.predict2[,2])
pred.Lv3GrvSnd2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3GrvSnd.predict2))
names(pred.Lv3GrvSnd2) <- c("X","Y", "predLv3GrvSnd")

Lv3GrvSnd.rs.predict3 <- predict(Lv3GrvSnd.prune, points3, type = c("vector"))
Lv3GrvSnd.predict3 <- as.data.frame(Lv3GrvSnd.rs.predict3[,2])
pred.Lv3GrvSnd3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3GrvSnd.predict3))
names(pred.Lv3GrvSnd3) <- c("X","Y", "predLv3GrvSnd")


#########################
## Helby Banks Predict ##
#########################

HB.Lv3GrvSnd.rs.predict <- predict(HBLv3GrvSnd.prune, HBpoints, type = c("vector"))
HB.Lv3GrvSnd.predict <- as.data.frame(HB.Lv3GrvSnd.rs.predict[,2])
predHB.Lv3GrvSnd <- as.data.frame(cbind(HBpoints$Long, HBpoints$Lat,  HB.Lv3GrvSnd.predict))
names(predHB.Lv3GrvSnd) <- c("X","Y", "predLv3GrvSnd")



#####################
## Export to ASCII ##
#####################

pred.Lv3GrvSnd1
pred.Lv3GrvSnd2
pred.Lv3GrvSnd3
predHB.Lv3GrvSnd

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3GrvSnd1) <- ~X+Y
ext <- extent(pred.Lv3GrvSnd1)
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3GrvSnd1, r, 'predLv3GrvSnd')
writeRaster(to_ascii,'AllLv3GrvSnd1.asc', format='ascii')

coordinates(pred.Lv3GrvSnd2) <- ~X+Y
ext2 <- extent(pred.Lv3GrvSnd2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3GrvSnd2, r2, 'predLv3GrvSnd')
writeRaster(to_ascii2,'AllLv3GrvSnd2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3GrvSnd3) <- ~X+Y
ext3 <- extent(pred.Lv3GrvSnd3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3GrvSnd3, r3, 'predLv3GrvSnd')
writeRaster(to_ascii3,'AllLv3GrvSnd3.asc', format='ascii')

# Helby Banks
coordinates(predHB.Lv3GrvSnd) <- ~X+Y
extHB <- extent(predHB.Lv3GrvSnd)
rHB <- raster(ext=extHB,res=0.0000483000000031097)
to_asciiHB <- rasterize(predHB.Lv3GrvSnd, rHB, 'predLv3GrvSnd')
writeRaster(to_asciiHB,'HBLv3GrvSnd.asc', format='ascii')


################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3GrvSnd, "33_OutPredict_All_Lv3GrvSnd_5m.csv")
write.csv(out.predict.HBLv3GrvSnd, "34_OutPredict_HB_Lv3GrvSnd_5m.csv")


```












```{r}

###########################
#### Level 3 - PEBBLES ####
###########################

Lv3Peb.tree <- tree(as.factor(Lv3_Pebbles) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3Peb.tree); text(Lv3Peb.tree,cex=0.5)
summary(Lv3Peb.tree)


# Select the best model variables
Lv3Peb.tree <- tree(as.factor(Lv3_Pebbles) ~ mean3  + range25 + BScatter + std10 + mean10 + BPI_B_250 + hyp10 +
                      curv_plan + std25 + BPI_B_100 + Depth,
                        data=model, method = "class")

summary(Lv3Peb.tree) # MISCLASSIFICATION RATE 0.33%


#################
## Tantabiddi ##
#################

TBLv3Peb.tree <- tree(as.factor(Lv3_Pebbles) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= TBmodel, na.action = na.exclude, method = "class")
plot(TBLv3Peb.tree); text(TBLv3Peb.tree,cex=0.5)
summary(TBLv3Peb.tree)

# Select the best model variables
TBLv3Peb.tree <- tree(as.factor(Lv3_Pebbles) ~ range25 + BPI_B_250 + Depth + std10 + BScatter + BPI_B_50 +
                        BPI_F_25 + north,
                        data=TBmodel, method = "class")

summary(TBLv3Peb.tree) # MISCLASSIFICATION RATE 4.6%



########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3Peb.fit1  <- cv.tree(Lv3Peb.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3Peb.fit1)
        summary(Lv3Peb.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 10    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3Peb.prune <- prune.misclass(Lv3Peb.tree, best = TreeSize) 
        plot(Lv3Peb.prune); text(Lv3Peb.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3Peb.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3Peb.prune <- prune.misclass(Lv3Peb.tree, best = 10)         # choose best tree size and add value in!!!
plot(Lv3Peb.prune); text(Lv3Peb.prune,cex=0.8)
summary(Lv3Peb.prune) # 7.3% misclassification

Lv3Peb.predict <- predict(Lv3Peb.prune, test, type = c("vector"))
Lv3Peb.predict <- as.data.frame(Lv3Peb.predict [,2])
out.predict.Lv3Peb <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Pebbles, Lv3Peb.predict))
names(out.predict.Lv3Peb) <- c("X", "Y", "Lv3Peb.test", "Lv3Peb.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3Peb_prune.txt")
Lv3Peb.prune 
sink()



###############
# Tantabiddi #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        TBLv3Peb.fit1  <- cv.tree(TBLv3Peb.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(TBLv3Peb.fit1)
        summary(TBLv3Peb.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        TBLv3Peb.prune <- prune.misclass(TBLv3Peb.tree, best = TreeSize) 
        plot(TBLv3Peb.prune); text(TBLv3Peb.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(TBLv3Peb.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


TBLv3Peb.prune <- prune.misclass(TBLv3Peb.tree, best = 10)         # choose best tree size and add value in!!!
plot(TBLv3Peb.prune); text(TBLv3Peb.prune,cex=0.8)
summary(TBLv3Peb.prune) # misclassification rate 1.3%

TBLv3Peb.predict <- predict(TBLv3Peb.prune, TBtest, type = c("vector"))
TBLv3Peb.predict <- as.data.frame(TBLv3Peb.predict [,2])
out.predict.TBLv3Peb <- as.data.frame(cbind(TBtest$Long, TBtest$Lat, 
   TBtest$Lv3_Pebbles, TBLv3Peb.predict))
names(out.predict.TBLv3Peb) <- c("X", "Y", "Lv3Peb.test", "Lv3Peb.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/TB_Lv3Peb_prune.txt")
TBLv3Peb.prune 
sink()


############
# Predict ##
############

Lv3Peb.prune
TBLv3Peb.prune

###########
# ALL SITES 
###########

Lv3Peb.rs.predict1 <- predict(Lv3Peb.prune, points1, type = c("vector"))
Lv3Peb.predict1 <- as.data.frame(Lv3Peb.rs.predict1[,2])
pred.Lv3Peb1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3Peb.predict1))
names(pred.Lv3Peb1) <- c("X","Y", "predLv3Peb")

Lv3Peb.rs.predict2 <- predict(Lv3Peb.prune, points2, type = c("vector"))
Lv3Peb.predict2 <- as.data.frame(Lv3Peb.rs.predict2[,2])
pred.Lv3Peb2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3Peb.predict2))
names(pred.Lv3Peb2) <- c("X","Y", "predLv3Peb")

Lv3Peb.rs.predict3 <- predict(Lv3Peb.prune, points3, type = c("vector"))
Lv3Peb.predict3 <- as.data.frame(Lv3Peb.rs.predict3[,2])
pred.Lv3Peb3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3Peb.predict3))
names(pred.Lv3Peb3) <- c("X","Y", "predLv3Peb")


#########################
## Tantabiddi Predict ##
#########################

TB.Lv3Peb.rs.predict <- predict(TBLv3Peb.prune, TBpoints, type = c("vector"))
TB.Lv3Peb.predict <- as.data.frame(TB.Lv3Peb.rs.predict[,2])
predTB.Lv3Peb <- as.data.frame(cbind(TBpoints$Long, TBpoints$Lat,  TB.Lv3Peb.predict))
names(predTB.Lv3Peb) <- c("X","Y", "predLv3Peb")



#####################
## Export to ASCII ##
#####################

pred.Lv3Peb1
pred.Lv3Peb2
pred.Lv3Peb3
predTB.Lv3Peb

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3Peb1) <- ~X+Y
ext <- extent(pred.Lv3Peb1)
table(diff(pred.Lv3Peb1@coords[,1]))
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3Peb1, r, 'predLv3Peb')
writeRaster(to_ascii,'AllLv3Peb1.asc', format='ascii')

coordinates(pred.Lv3Peb2) <- ~X+Y
ext2 <- extent(pred.Lv3Peb2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3Peb2, r2, 'predLv3Peb')
writeRaster(to_ascii2,'AllLv3Peb2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3Peb3) <- ~X+Y
ext3 <- extent(pred.Lv3Peb3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3Peb3, r3, 'predLv3Peb')
writeRaster(to_ascii3,'AllLv3Peb3.asc', format='ascii')

# Tantabiddi
coordinates(predTB.Lv3Peb) <- ~X+Y
extTB <- extent(predTB.Lv3Peb)
table(diff(predTB.Lv3Peb@coords[,1]))
rTB <- raster(ext=extTB,res=0.0000483000000031097)
to_asciiTB <- rasterize(predTB.Lv3Peb, rTB, 'predLv3Peb')
writeRaster(to_asciiTB,'TBLv3Peb.asc', format='ascii')


################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3Peb, "35_OutPredict_All_Lv3Peb_5m.csv")
write.csv(out.predict.TBLv3Peb, "36_OutPredict_TB_Lv3Peb_5m.csv")


```














```{r}

####################################
#### Level 3 - PEBBLES AND SAND ####
####################################

Lv3PebSnd.tree <- tree(as.factor(Lv3_Pebbles_and_Sand) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3PebSnd.tree); text(Lv3PebSnd.tree,cex=0.5)
summary(Lv3PebSnd.tree)


# Select the best model variables
Lv3PebSnd.tree <- tree(as.factor(Lv3_Pebbles_and_Sand) ~ BPI_B_250 + std25 + rugosity + std10 + mean3 + BScatter +
                         BPI_B_100 + mean25 + BPI_B_50 + range3 + range25 + hyp5,
                        data=model, method = "class")

summary(Lv3PebSnd.tree) # MISCLASSIFICATION RATE 0.52%


#################
## Helby Banks ##
#################

HBLv3PebSnd.tree <- tree(as.factor(Lv3_Pebbles_and_Sand) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= HBmodel, na.action = na.exclude, method = "class")
plot(HBLv3PebSnd.tree); text(HBLv3PebSnd.tree,cex=0.5)
summary(HBLv3PebSnd.tree)

# Select the best model variables
HBLv3PebSnd.tree <- tree(as.factor(Lv3_Pebbles_and_Sand) ~ std10 + mean25 + std25 + std3 + curv_plan + east + range10 +
                           north + hyp10,
                        data=HBmodel, method = "class")

summary(HBLv3PebSnd.tree) # MISCLASSIFICATION RATE 0.26%



################
## Tantabiddi ##
################

TBLv3PebSnd.tree <- tree(as.factor(Lv3_Pebbles_and_Sand) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= TBmodel, na.action = na.exclude, method = "class")
plot(TBLv3PebSnd.tree); text(TBLv3PebSnd.tree,cex=0.5)
summary(TBLv3PebSnd.tree)

# Select the best model variables
TBLv3PebSnd.tree <- tree(as.factor(Lv3_Pebbles_and_Sand) ~ BPI_B_250 + range10 + Depth + BScatter,
                        data=TBmodel, method = "class")

summary(TBLv3PebSnd.tree) # MISCLASSIFICATION RATE 0.03%


##############
## Mangrove ##
##############


MGLv3PebSnd.tree <- tree(as.factor(Lv3_Pebbles_and_Sand) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= MGmodel, na.action = na.exclude, method = "class")
plot(MGLv3PebSnd.tree); text(MGLv3PebSnd.tree,cex=0.5)
summary(MGLv3PebSnd.tree)

# Select the best model variables
MGLv3PebSnd.tree <- tree(as.factor(Lv3_Pebbles_and_Sand) ~ BPI_B_250 + range10 + Depth + slope + BScatter + range25 +
                           range3 + north,
                        data=MGmodel, method = "class")

summary(MGLv3PebSnd.tree) # MISCLASSIFICATION RATE 0.32%



##################
# Southern Site ##
##################

# Habitat not observed at Southern Site




########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3PebSnd.fit1  <- cv.tree(Lv3PebSnd.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3PebSnd.fit1)
        summary(Lv3PebSnd.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3PebSnd.prune <- prune.misclass(Lv3PebSnd.tree, best = TreeSize) 
        plot(Lv3PebSnd.prune); text(Lv3PebSnd.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3PebSnd.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3PebSnd.prune <- prune.misclass(Lv3PebSnd.tree, best = 6)         # choose best tree size and add value in!!!
plot(Lv3PebSnd.prune); text(Lv3PebSnd.prune,cex=0.8)
summary(Lv3PebSnd.prune) # 0.83% misclassification

Lv3PebSnd.predict <- predict(Lv3PebSnd.prune, test, type = c("vector"))
Lv3PebSnd.predict <- as.data.frame(Lv3PebSnd.predict [,2])
out.predict.Lv3PebSnd <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Pebbles_and_Sand, Lv3PebSnd.predict))
names(out.predict.Lv3PebSnd) <- c("X", "Y", "Lv3PebSnd.test", "Lv3PebSnd.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3PebSnd_prune.txt")
Lv3PebSnd.prune 
sink()



###############
# Helby Banks #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        HBLv3PebSnd.fit1  <- cv.tree(HBLv3PebSnd.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(HBLv3PebSnd.fit1)
        summary(HBLv3PebSnd.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 4    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        HBLv3PebSnd.prune <- prune.misclass(HBLv3PebSnd.tree, best = TreeSize) 
        plot(HBLv3PebSnd.prune); text(HBLv3PebSnd.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(HBLv3PebSnd.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


HBLv3PebSnd.prune <- prune.misclass(HBLv3PebSnd.tree, best = 4)         # choose best tree size and add value in!!!
plot(HBLv3PebSnd.prune); text(HBLv3PebSnd.prune,cex=0.8)
summary(HBLv3PebSnd.prune) # misclassification rate 0.32%

HBLv3PebSnd.predict <- predict(HBLv3PebSnd.prune, HBtest, type = c("vector"))
HBLv3PebSnd.predict <- as.data.frame(HBLv3PebSnd.predict [,2])
out.predict.HBLv3PebSnd <- as.data.frame(cbind(HBtest$Long, HBtest$Lat, 
   HBtest$Lv3_Pebbles_and_Sand, HBLv3PebSnd.predict))
names(out.predict.HBLv3PebSnd) <- c("X", "Y", "Lv3PebSnd.test", "Lv3PebSnd.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/HB_Lv3PebSnd_prune.txt")
HBLv3PebSnd.prune 
sink()


###############
# Tantabiddi #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        TBLv3PebSnd.fit1  <- cv.tree(TBLv3PebSnd.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(TBLv3PebSnd.fit1)
        summary(TBLv3PebSnd.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        TBLv3PebSnd.prune <- prune.misclass(TBLv3PebSnd.tree, best = TreeSize) 
        plot(TBLv3PebSnd.prune); text(TBLv3PebSnd.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(TBLv3PebSnd.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


TBLv3PebSnd.prune <- prune.misclass(TBLv3PebSnd.tree, best = 6)         # choose best tree size and add value in!!!
plot(TBLv3PebSnd.prune); text(TBLv3PebSnd.prune,cex=0.8)
summary(TBLv3PebSnd.prune) # misclassification rate 0.03%

TBLv3PebSnd.predict <- predict(TBLv3PebSnd.prune, TBtest, type = c("vector"))
TBLv3PebSnd.predict <- as.data.frame(TBLv3PebSnd.predict [,2])
out.predict.TBLv3PebSnd <- as.data.frame(cbind(TBtest$Long, TBtest$Lat, 
   TBtest$Lv3_Pebbles_and_Sand, TBLv3PebSnd.predict))
names(out.predict.TBLv3PebSnd) <- c("X", "Y", "Lv3PebSnd.test", "Lv3PebSnd.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/TB_Lv3PebSnd_prune.txt")
TBLv3PebSnd.prune 
sink()


###############
# Mangrove #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        MGLv3PebSnd.fit1  <- cv.tree(MGLv3PebSnd.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(MGLv3PebSnd.fit1)
        summary(MGLv3PebSnd.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 4    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        MGLv3PebSnd.prune <- prune.misclass(MGLv3PebSnd.tree, best = TreeSize) 
        plot(MGLv3PebSnd.prune); text(MGLv3PebSnd.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(MGLv3PebSnd.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


MGLv3PebSnd.prune <- prune.misclass(MGLv3PebSnd.tree, best = 10)         # choose best tree size and add value in!!!
plot(MGLv3PebSnd.prune); text(MGLv3PebSnd.prune,cex=0.8)
summary(MGLv3PebSnd.prune) # misclassification rate 0.32%

MGLv3PebSnd.predict <- predict(MGLv3PebSnd.prune, MGtest, type = c("vector"))
MGLv3PebSnd.predict <- as.data.frame(MGLv3PebSnd.predict [,2])
out.predict.MGLv3PebSnd <- as.data.frame(cbind(MGtest$Long, MGtest$Lat, 
   MGtest$Lv3_Pebbles_and_Sand, MGLv3PebSnd.predict))
names(out.predict.MGLv3PebSnd) <- c("X", "Y", "Lv3PebSnd.test", "Lv3PebSnd.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/MG_Lv3PebSnd_prune.txt")
MGLv3PebSnd.prune 
sink()


############
# Predict ##
############

Lv3PebSnd.prune
HBLv3PebSnd.prune

###########
# ALL SITES 
###########

Lv3PebSnd.rs.predict1 <- predict(Lv3PebSnd.prune, points1, type = c("vector"))
Lv3PebSnd.predict1 <- as.data.frame(Lv3PebSnd.rs.predict1[,2])
pred.Lv3PebSnd1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3PebSnd.predict1))
names(pred.Lv3PebSnd1) <- c("X","Y", "predLv3PebSnd")

Lv3PebSnd.rs.predict2 <- predict(Lv3PebSnd.prune, points2, type = c("vector"))
Lv3PebSnd.predict2 <- as.data.frame(Lv3PebSnd.rs.predict2[,2])
pred.Lv3PebSnd2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3PebSnd.predict2))
names(pred.Lv3PebSnd2) <- c("X","Y", "predLv3PebSnd")

Lv3PebSnd.rs.predict3 <- predict(Lv3PebSnd.prune, points3, type = c("vector"))
Lv3PebSnd.predict3 <- as.data.frame(Lv3PebSnd.rs.predict3[,2])
pred.Lv3PebSnd3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3PebSnd.predict3))
names(pred.Lv3PebSnd3) <- c("X","Y", "predLv3PebSnd")


#########################
## Helby Banks Predict ##
#########################

HB.Lv3PebSnd.rs.predict <- predict(HBLv3PebSnd.prune, HBpoints, type = c("vector"))
HB.Lv3PebSnd.predict <- as.data.frame(HB.Lv3PebSnd.rs.predict[,2])
predHB.Lv3PebSnd <- as.data.frame(cbind(HBpoints$Long, HBpoints$Lat,  HB.Lv3PebSnd.predict))
names(predHB.Lv3PebSnd) <- c("X","Y", "predLv3PebSnd")

#########################
## Tantabiddi Predict ##
#########################

TB.Lv3PebSnd.rs.predict <- predict(TBLv3PebSnd.prune, TBpoints, type = c("vector"))
TB.Lv3PebSnd.predict <- as.data.frame(TB.Lv3PebSnd.rs.predict[,2])
predTB.Lv3PebSnd <- as.data.frame(cbind(TBpoints$Long, TBpoints$Lat,  TB.Lv3PebSnd.predict))
names(predTB.Lv3PebSnd) <- c("X","Y", "predLv3PebSnd")

#########################
## Mangrove Predict ##
#########################

MG.Lv3PebSnd.rs.predict <- predict(MGLv3PebSnd.prune, MGpoints, type = c("vector"))
MG.Lv3PebSnd.predict <- as.data.frame(MG.Lv3PebSnd.rs.predict[,2])
predMG.Lv3PebSnd <- as.data.frame(cbind(MGpoints$Long, MGpoints$Lat,  MG.Lv3PebSnd.predict))
names(predMG.Lv3PebSnd) <- c("X","Y", "predLv3PebSnd")


#####################
## Export to ASCII ##
#####################

pred.Lv3PebSnd1
pred.Lv3PebSnd2
pred.Lv3PebSnd3
predHB.Lv3PebSnd

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3PebSnd1) <- ~X+Y
ext <- extent(pred.Lv3PebSnd1)
table(diff(pred.Lv3PebSnd1@coords[,1]))
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3PebSnd1, r, 'predLv3PebSnd')
writeRaster(to_ascii,'AllLv3PebSnd1.asc', format='ascii')

coordinates(pred.Lv3PebSnd2) <- ~X+Y
ext2 <- extent(pred.Lv3PebSnd2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3PebSnd2, r2, 'predLv3PebSnd')
writeRaster(to_ascii2,'AllLv3PebSnd2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3PebSnd3) <- ~X+Y
ext3 <- extent(pred.Lv3PebSnd3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3PebSnd3, r3, 'predLv3PebSnd')
writeRaster(to_ascii3,'AllLv3PebSnd3.asc', format='ascii')

# Helby Banks
coordinates(predHB.Lv3PebSnd) <- ~X+Y
extHB <- extent(predHB.Lv3PebSnd)
table(diff(predHB.Lv3PebSnd@coords[,1]))
rHB <- raster(ext=extHB,res=0.0000483000000031097)
to_asciiHB <- rasterize(predHB.Lv3PebSnd, rHB, 'predLv3PebSnd')
writeRaster(to_asciiHB,'HBLv3PebSnd.asc', format='ascii')

# Tantabiddi
coordinates(predTB.Lv3PebSnd) <- ~X+Y
extTB <- extent(predTB.Lv3PebSnd)
rTB <- raster(ext=extTB,res=0.0000483000000031097)
to_asciiTB <- rasterize(predTB.Lv3PebSnd, rTB, 'predLv3PebSnd')
writeRaster(to_asciiTB,'TBLv3PebSnd.asc', format='ascii')

# Mangrove
coordinates(predMG.Lv3PebSnd) <- ~X+Y
extMG <- extent(predMG.Lv3PebSnd)
rMG <- raster(ext=extMG,res=0.0000483000000031097)
to_asciiMG <- rasterize(predMG.Lv3PebSnd, rMG, 'predLv3PebSnd')
writeRaster(to_asciiMG,'MGLv3PebSnd.asc', format='ascii')

################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3PebSnd, "37_OutPredict_All_Lv3PebSnd_5m.csv")
write.csv(out.predict.HBLv3PebSnd, "38_OutPredict_HB_Lv3PebSnd_5m.csv")
write.csv(out.predict.TBLv3PebSnd, "66_OutPredict_TB_Lv3PebSnd_5m.csv")
write.csv(out.predict.MGLv3PebSnd, "67_OutPredict_MG_Lv3PebSnd_5m.csv")

```







```{r}

################################
#### Level 3 - BOULDER REEF ####
################################

Lv3BldrRf.tree <- tree(as.factor(Lv3_Reef_Boulders) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3BldrRf.tree); text(Lv3BldrRf.tree,cex=0.5)
summary(Lv3BldrRf.tree)


# Select the best model variables
Lv3BldrRf.tree <- tree(as.factor(Lv3_Reef_Boulders) ~ hyp25 + rugosity + Depth + BScatter,
                        data=model, method = "class")

summary(Lv3BldrRf.tree) # MISCLASSIFICATION RATE 0.00%


#################
## Helby Banks ##
#################

HBLv3BldrRf.tree <- tree(as.factor(Lv3_Reef_Boulders) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= HBmodel, na.action = na.exclude, method = "class")
plot(HBLv3BldrRf.tree); text(HBLv3BldrRf.tree,cex=0.5)
summary(HBLv3BldrRf.tree)

# Select the best model variables
HBLv3BldrRf.tree <- tree(as.factor(Lv3_Reef_Boulders) ~ hyp25 + Depth + BScatter + mean3,
                        data=HBmodel, method = "class")

summary(HBLv3BldrRf.tree) # MISCLASSIFICATION RATE 0.02%



################
## Tantabiddi ##
################

# Habitat not observed at Tantabiddi


##############
## Mangrove ##
##############


# Habitat not observed at Mangrove



##################
# Southern Site ##
##################

# Habitat not observed at Southern Site




########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3BldrRf.fit1  <- cv.tree(Lv3BldrRf.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3BldrRf.fit1)
        summary(Lv3BldrRf.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3BldrRf.prune <- prune.misclass(Lv3BldrRf.tree, best = TreeSize) 
        plot(Lv3BldrRf.prune); text(Lv3BldrRf.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3BldrRf.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3BldrRf.prune <- prune.misclass(Lv3BldrRf.tree, best = 2)         # choose best tree size and add value in!!!
plot(Lv3BldrRf.prune); text(Lv3BldrRf.prune,cex=0.8)
summary(Lv3BldrRf.prune) # 0.00% misclassification

Lv3BldrRf.predict <- predict(Lv3BldrRf.prune, test, type = c("vector"))
Lv3BldrRf.predict <- as.data.frame(Lv3BldrRf.predict [,2])
out.predict.Lv3BldrRf <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Reef_Boulders, Lv3BldrRf.predict))
names(out.predict.Lv3BldrRf) <- c("X", "Y", "Lv3BldrRf.test", "Lv3BldrRf.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3BldrRf_prune.txt")
Lv3BldrRf.prune 
sink()



###############
# Helby Banks #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        HBLv3BldrRf.fit1  <- cv.tree(HBLv3BldrRf.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(HBLv3BldrRf.fit1)
        summary(HBLv3BldrRf.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        HBLv3BldrRf.prune <- prune.misclass(HBLv3BldrRf.tree, best = TreeSize) 
        plot(HBLv3BldrRf.prune); text(HBLv3BldrRf.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(HBLv3BldrRf.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


HBLv3BldrRf.prune <- prune.misclass(HBLv3BldrRf.tree, best = 2)         # choose best tree size and add value in!!!
plot(HBLv3BldrRf.prune); text(HBLv3BldrRf.prune,cex=0.8)
summary(HBLv3BldrRf.prune) # misclassification rate 0.02%

HBLv3BldrRf.predict <- predict(HBLv3BldrRf.prune, HBtest, type = c("vector"))
HBLv3BldrRf.predict <- as.data.frame(HBLv3BldrRf.predict [,2])
out.predict.HBLv3BldrRf <- as.data.frame(cbind(HBtest$Long, HBtest$Lat, 
   HBtest$Lv3_Reef_Boulders, HBLv3BldrRf.predict))
names(out.predict.HBLv3BldrRf) <- c("X", "Y", "Lv3BldrRf.test", "Lv3BldrRf.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/HB_Lv3BldrRf_prune.txt")
HBLv3BldrRf.prune 
sink()


############
# Predict ##
############

Lv3BldrRf.prune
HBLv3BldrRf.prune

###########
# ALL SITES 
###########

Lv3BldrRf.rs.predict1 <- predict(Lv3BldrRf.prune, points1, type = c("vector"))
Lv3BldrRf.predict1 <- as.data.frame(Lv3BldrRf.rs.predict1[,2])
pred.Lv3BldrRf1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3BldrRf.predict1))
names(pred.Lv3BldrRf1) <- c("X","Y", "predLv3BldrRf")

Lv3BldrRf.rs.predict2 <- predict(Lv3BldrRf.prune, points2, type = c("vector"))
Lv3BldrRf.predict2 <- as.data.frame(Lv3BldrRf.rs.predict2[,2])
pred.Lv3BldrRf2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3BldrRf.predict2))
names(pred.Lv3BldrRf2) <- c("X","Y", "predLv3BldrRf")

Lv3BldrRf.rs.predict3 <- predict(Lv3BldrRf.prune, points3, type = c("vector"))
Lv3BldrRf.predict3 <- as.data.frame(Lv3BldrRf.rs.predict3[,2])
pred.Lv3BldrRf3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3BldrRf.predict3))
names(pred.Lv3BldrRf3) <- c("X","Y", "predLv3BldrRf")


#########################
## Helby Banks Predict ##
#########################

HB.Lv3BldrRf.rs.predict <- predict(HBLv3BldrRf.prune, HBpoints, type = c("vector"))
HB.Lv3BldrRf.predict <- as.data.frame(HB.Lv3BldrRf.rs.predict[,2])
predHB.Lv3BldrRf <- as.data.frame(cbind(HBpoints$Long, HBpoints$Lat,  HB.Lv3BldrRf.predict))
names(predHB.Lv3BldrRf) <- c("X","Y", "predLv3BldrRf")



#####################
## Export to ASCII ##
#####################

pred.Lv3BldrRf1
pred.Lv3BldrRf2
pred.Lv3BldrRf3
predHB.Lv3BldrRf

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3BldrRf1) <- ~X+Y
ext <- extent(pred.Lv3BldrRf1)
table(diff(pred.Lv3BldrRf1@coords[,1]))
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3BldrRf1, r, 'predLv3BldrRf')
writeRaster(to_ascii,'AllLv3Bldr1.asc', format='ascii')

coordinates(pred.Lv3BldrRf2) <- ~X+Y
ext2 <- extent(pred.Lv3BldrRf2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3BldrRf2, r2, 'predLv3BldrRf')
writeRaster(to_ascii2,'AllLv3Bldr2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3BldrRf3) <- ~X+Y
ext3 <- extent(pred.Lv3BldrRf3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3BldrRf3, r3, 'predLv3BldrRf')
writeRaster(to_ascii3,'AllLv3Bldr3.asc', format='ascii')

# Helby Banks
coordinates(predHB.Lv3BldrRf) <- ~X+Y
extHB <- extent(predHB.Lv3BldrRf)
table(diff(predHB.Lv3BldrRf@coords[,1]))
rHB <- raster(ext=extHB,res=0.0000483000000031097)
to_asciiHB <- rasterize(predHB.Lv3BldrRf, rHB, 'predLv3BldrRf')
writeRaster(to_asciiHB,'HBLv3Bldr.asc', format='ascii')


################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3BldrRf, "39_OutPredict_All_Lv3BldrRf_5m.csv")
write.csv(out.predict.HBLv3BldrRf, "40_OutPredict_HB_Lv3BldrRf_5m.csv")


```







```{r}

################################
#### Level 3 - COBBLE REEF ####
################################

Lv3CbblRf.tree <- tree(as.factor(Lv3_Reef_Cobbles) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3CbblRf.tree); text(Lv3CbblRf.tree,cex=0.5)
summary(Lv3CbblRf.tree)


# Select the best model variables
Lv3CbblRf.tree <- tree(as.factor(Lv3_Reef_Cobbles) ~ hyp10 + mean25 + mean5 + BScatter+ BPI_B_100 + Depth + std25 +
                         range5 + std10 + BPI_B_250 + range25 + BPI_B_50 + std5 + hyp25 + slope + hyp5,
                        data=model, method = "class")

summary(Lv3CbblRf.tree) # MISCLASSIFICATION RATE 0.31%


#################
## Helby Banks ##
#################

HBLv3CbblRf.tree <- tree(as.factor(Lv3_Reef_Cobbles) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= HBmodel, na.action = na.exclude, method = "class")
plot(HBLv3CbblRf.tree); text(HBLv3CbblRf.tree,cex=0.5)
summary(HBLv3CbblRf.tree)

# Select the best model variables
HBLv3CbblRf.tree <- tree(as.factor(Lv3_Reef_Cobbles) ~ hyp10 + mean25 + mean5 + BPI_B_50 + hyp25 + curv_plan + std25 + 
                           hyp5 + range25 + std3 + slope + mean10,
                        data=HBmodel, method = "class")

summary(HBLv3CbblRf.tree) # MISCLASSIFICATION RATE 0.88%



################
## Tantabiddi ##
################

# Habitat not observed at Tantabiddi


##############
## Mangrove ##
##############


MGLv3CbblRf.tree <- tree(as.factor(Lv3_Reef_Cobbles) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= MGmodel, na.action = na.exclude, method = "class")
plot(MGLv3CbblRf.tree); text(MGLv3CbblRf.tree,cex=0.5)
summary(MGLv3CbblRf.tree)

# Select the best model variables
MGLv3CbblRf.tree <- tree(as.factor(Lv3_Reef_Cobbles) ~ range25 + std25 + curv + curv_plan,
                        data=MGmodel, method = "class")

summary(MGLv3CbblRf.tree) # MISCLASSIFICATION RATE 0.12%



##################
# Southern Site ##
##################

SSLv3CbblRf.tree <- tree(as.factor(Lv3_Reef_Cobbles) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= SSmodel, na.action = na.exclude, method = "class")
plot(SSLv3CbblRf.tree); text(SSLv3CbblRf.tree,cex=0.5)
summary(SSLv3CbblRf.tree)

# Select the best model variables
SSLv3CbblRf.tree <- tree(as.factor(Lv3_Reef_Cobbles) ~ std25 + mean25 + BScatter + std10 + std5,
                        data=SSmodel, method = "class")

summary(SSLv3CbblRf.tree) # MISCLASSIFICATION RATE 0.55%




########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3CbblRf.fit1  <- cv.tree(Lv3CbblRf.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3CbblRf.fit1)
        summary(Lv3CbblRf.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3CbblRf.prune <- prune.misclass(Lv3CbblRf.tree, best = TreeSize) 
        plot(Lv3CbblRf.prune); text(Lv3CbblRf.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3CbblRf.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3CbblRf.prune <- prune.misclass(Lv3CbblRf.tree, best = 12)         # choose best tree size and add value in!!!
plot(Lv3CbblRf.prune); text(Lv3CbblRf.prune,cex=0.8)
summary(Lv3CbblRf.prune) # 0.36% misclassification

Lv3CbblRf.predict <- predict(Lv3CbblRf.prune, test, type = c("vector"))
Lv3CbblRf.predict <- as.data.frame(Lv3CbblRf.predict [,2])
out.predict.Lv3CbblRf <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Reef_Cobbles, Lv3CbblRf.predict))
names(out.predict.Lv3CbblRf) <- c("X", "Y", "Lv3CbblRf.test", "Lv3CbblRf.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3CbblRf_prune.txt")
Lv3CbblRf.prune 
sink()



###############
# Helby Banks #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        HBLv3CbblRf.fit1  <- cv.tree(HBLv3CbblRf.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(HBLv3CbblRf.fit1)
        summary(HBLv3CbblRf.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 8   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        HBLv3CbblRf.prune <- prune.misclass(HBLv3CbblRf.tree, best = TreeSize) 
        plot(HBLv3CbblRf.prune); text(HBLv3CbblRf.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(HBLv3CbblRf.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


HBLv3CbblRf.prune <- prune.misclass(HBLv3CbblRf.tree, best = 12)         # choose best tree size and add value in!!!
plot(HBLv3CbblRf.prune); text(HBLv3CbblRf.prune,cex=0.8)
summary(HBLv3CbblRf.prune) # misclassification rate 0.34%

HBLv3CbblRf.predict <- predict(HBLv3CbblRf.prune, HBtest, type = c("vector"))
HBLv3CbblRf.predict <- as.data.frame(HBLv3CbblRf.predict [,2])
out.predict.HBLv3CbblRf <- as.data.frame(cbind(HBtest$Long, HBtest$Lat, 
   HBtest$Lv3_Reef_Cobbles, HBLv3CbblRf.predict))
names(out.predict.HBLv3CbblRf) <- c("X", "Y", "Lv3CbblRf.test", "Lv3CbblRf.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/HB_Lv3CbblRf_prune.txt")
HBLv3CbblRf.prune 
sink()


###############
# Mangrove #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        MGLv3CbblRf.fit1  <- cv.tree(MGLv3CbblRf.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(MGLv3CbblRf.fit1)
        summary(MGLv3CbblRf.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        MGLv3CbblRf.prune <- prune.misclass(MGLv3CbblRf.tree, best = TreeSize) 
        plot(MGLv3CbblRf.prune); text(MGLv3CbblRf.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(MGLv3CbblRf.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


MGLv3CbblRf.prune <- prune.misclass(MGLv3CbblRf.tree, best = 2)         # choose best tree size and add value in!!!
plot(MGLv3CbblRf.prune); text(MGLv3CbblRf.prune,cex=0.8)
summary(MGLv3CbblRf.prune) # misclassification rate 0.12%

MGLv3CbblRf.predict <- predict(MGLv3CbblRf.prune, MGtest, type = c("vector"))
MGLv3CbblRf.predict <- as.data.frame(MGLv3CbblRf.predict [,2])
out.predict.MGLv3CbblRf <- as.data.frame(cbind(MGtest$Long, MGtest$Lat, 
   MGtest$Lv3_Reef_Cobbles, MGLv3CbblRf.predict))
names(out.predict.MGLv3CbblRf) <- c("X", "Y", "Lv3CbblRf.test", "Lv3CbblRf.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/MG_Lv3CbblRf_prune.txt")
MGLv3CbblRf.prune 
sink()


###############
# Southern Site #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        SSLv3CbblRf.fit1  <- cv.tree(SSLv3CbblRf.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(SSLv3CbblRf.fit1)
        summary(SSLv3CbblRf.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        SSLv3CbblRf.prune <- prune.misclass(SSLv3CbblRf.tree, best = TreeSize) 
        plot(SSLv3CbblRf.prune); text(SSLv3CbblRf.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(SSLv3CbblRf.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


SSLv3CbblRf.prune <- prune.misclass(SSLv3CbblRf.tree, best = 8)         # choose best tree size and add value in!!!
plot(SSLv3CbblRf.prune); text(SSLv3CbblRf.prune,cex=0.8)
summary(SSLv3CbblRf.prune) # misclassification rate 0.55%

SSLv3CbblRf.predict <- predict(SSLv3CbblRf.prune, SStest, type = c("vector"))
SSLv3CbblRf.predict <- as.data.frame(SSLv3CbblRf.predict [,2])
out.predict.SSLv3CbblRf <- as.data.frame(cbind(SStest$Long, SStest$Lat, 
   SStest$Lv3_Reef_Cobbles, SSLv3CbblRf.predict))
names(out.predict.SSLv3CbblRf) <- c("X", "Y", "Lv3CbblRf.test", "Lv3CbblRf.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/SS_Lv3CbblRf_prune.txt")
SSLv3CbblRf.prune 
sink()



############
# Predict ##
############

Lv3CbblRf.prune
HBLv3CbblRf.prune

###########
# ALL SITES 
###########

Lv3CbblRf.rs.predict1 <- predict(Lv3CbblRf.prune, points1, type = c("vector"))
Lv3CbblRf.predict1 <- as.data.frame(Lv3CbblRf.rs.predict1[,2])
pred.Lv3CbblRf1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3CbblRf.predict1))
names(pred.Lv3CbblRf1) <- c("X","Y", "predLv3CbblRf")

Lv3CbblRf.rs.predict2 <- predict(Lv3CbblRf.prune, points2, type = c("vector"))
Lv3CbblRf.predict2 <- as.data.frame(Lv3CbblRf.rs.predict2[,2])
pred.Lv3CbblRf2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3CbblRf.predict2))
names(pred.Lv3CbblRf2) <- c("X","Y", "predLv3CbblRf")

Lv3CbblRf.rs.predict3 <- predict(Lv3CbblRf.prune, points3, type = c("vector"))
Lv3CbblRf.predict3 <- as.data.frame(Lv3CbblRf.rs.predict3[,2])
pred.Lv3CbblRf3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3CbblRf.predict3))
names(pred.Lv3CbblRf3) <- c("X","Y", "predLv3CbblRf")


#########################
## Helby Banks Predict ##
#########################

HB.Lv3CbblRf.rs.predict <- predict(HBLv3CbblRf.prune, HBpoints, type = c("vector"))
HB.Lv3CbblRf.predict <- as.data.frame(HB.Lv3CbblRf.rs.predict[,2])
predHB.Lv3CbblRf <- as.data.frame(cbind(HBpoints$Long, HBpoints$Lat,  HB.Lv3CbblRf.predict))
names(predHB.Lv3CbblRf) <- c("X","Y", "predLv3CbblRf")

#########################
## Mangrove Predict ##
#########################

MG.Lv3CbblRf.rs.predict <- predict(MGLv3CbblRf.prune, MGpoints, type = c("vector"))
MG.Lv3CbblRf.predict <- as.data.frame(MG.Lv3CbblRf.rs.predict[,2])
predMG.Lv3CbblRf <- as.data.frame(cbind(MGpoints$Long, MGpoints$Lat,  MG.Lv3CbblRf.predict))
names(predMG.Lv3CbblRf) <- c("X","Y", "predLv3CbblRf")

#########################
## Southern Site Predict ##
#########################

SS.Lv3CbblRf.rs.predict <- predict(SSLv3CbblRf.prune, SSpoints, type = c("vector"))
SS.Lv3CbblRf.predict <- as.data.frame(SS.Lv3CbblRf.rs.predict[,2])
predSS.Lv3CbblRf <- as.data.frame(cbind(SSpoints$Long, SSpoints$Lat,  SS.Lv3CbblRf.predict))
names(predSS.Lv3CbblRf) <- c("X","Y", "predLv3CbblRf")



#####################
## Export to ASCII ##
#####################

pred.Lv3CbblRf1
pred.Lv3CbblRf2
pred.Lv3CbblRf3
predHB.Lv3CbblRf

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3CbblRf1) <- ~X+Y
ext <- extent(pred.Lv3CbblRf1)
table(diff(pred.Lv3CbblRf1@coords[,1]))
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3CbblRf1, r, 'predLv3CbblRf')
writeRaster(to_ascii,'AllLv3Cbbl1.asc', format='ascii')

coordinates(pred.Lv3CbblRf2) <- ~X+Y
ext2 <- extent(pred.Lv3CbblRf2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3CbblRf2, r2, 'predLv3CbblRf')
writeRaster(to_ascii2,'AllLv3Cbbl2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3CbblRf3) <- ~X+Y
ext3 <- extent(pred.Lv3CbblRf3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3CbblRf3, r3, 'predLv3CbblRf')
writeRaster(to_ascii3,'AllLv3Cbbl3.asc', format='ascii')

# Helby Banks
coordinates(predHB.Lv3CbblRf) <- ~X+Y
extHB <- extent(predHB.Lv3CbblRf)
table(diff(predHB.Lv3CbblRf@coords[,1]))
rHB <- raster(ext=extHB,res=0.0000483000000031097)
to_asciiHB <- rasterize(predHB.Lv3CbblRf, rHB, 'predLv3CbblRf')
writeRaster(to_asciiHB,'HBLv3Cbbl.asc', format='ascii')

# Mangrove
coordinates(predMG.Lv3CbblRf) <- ~X+Y
extMG <- extent(predMG.Lv3CbblRf)
table(diff(predMG.Lv3CbblRf@coords[,1]))
rMG <- raster(ext=extMG,res=0.0000483000000031097)
to_asciiMG <- rasterize(predMG.Lv3CbblRf, rMG, 'predLv3CbblRf')
writeRaster(to_asciiMG,'MGLv3Cbbl.asc', format='ascii')

# Southern Site
coordinates(predSS.Lv3CbblRf) <- ~X+Y
extSS <- extent(predSS.Lv3CbblRf)
table(diff(predSS.Lv3CbblRf@coords[,1]))
rSS <- raster(ext=extSS,res=0.00004500000005447)
to_asciiSS <- rasterize(predSS.Lv3CbblRf, rSS, 'predLv3CbblRf')
writeRaster(to_asciiSS,'SSLv3Cbbl.asc', format='ascii')


################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3CbblRf, "41_OutPredict_All_Lv3CbblRf_5m.csv")
write.csv(out.predict.HBLv3CbblRf, "42_OutPredict_HB_Lv3CbblRf_5m.csv")
write.csv(out.predict.MGLv3CbblRf, "68_OutPredict_MG_Lv3CbblRf_5m.csv")
write.csv(out.predict.SSLv3CbblRf, "69_OutPredict_SS_Lv3CbblRf_5m.csv")

```








```{r}

################################
#### Level 3 - ROCKY REEF ####
################################

Lv3RockRf.tree <- tree(as.factor(Lv3_Reef_Rock) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3RockRf.tree); text(Lv3RockRf.tree,cex=0.5)
summary(Lv3RockRf.tree)


# Select the best model variables
Lv3RockRf.tree <- tree(as.factor(Lv3_Reef_Rock) ~ std5 + std25 + mean25 + Depth + BScatter + BPI_B_250 + slope +
                         range25 + BPI_B_50 + slope + range25 + BPI_B_50 + mean10 + range10,
                        data=model, method = "class")

summary(Lv3RockRf.tree) # MISCLASSIFICATION RATE 4.5%


#################
## Helby Banks ##
#################

HBLv3RockRf.tree <- tree(as.factor(Lv3_Reef_Rock) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= HBmodel, na.action = na.exclude, method = "class")
plot(HBLv3RockRf.tree); text(HBLv3RockRf.tree,cex=0.5)
summary(HBLv3RockRf.tree)

# Select the best model variables
HBLv3RockRf.tree <- tree(as.factor(Lv3_Reef_Rock) ~ std5 + mean10 + mean5 + BPI_B_100 + BPI_B_50 + BPI_B_250 +
                           range25 + mean25 + std10 + hyp5 + range3 + range10 + hyp25 + std25,
                        data=HBmodel, method = "class")

summary(HBLv3RockRf.tree) # MISCLASSIFICATION RATE 0.49%



################
## Tantabiddi ##
################

TBLv3RockRf.tree <- tree(as.factor(Lv3_Reef_Rock) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= TBmodel, na.action = na.exclude, method = "class")
plot(TBLv3RockRf.tree); text(TBLv3RockRf.tree,cex=0.5)
summary(TBLv3RockRf.tree)

# Select the best model variables
TBLv3RockRf.tree <- tree(as.factor(Lv3_Reef_Rock) ~ mean10 + range10 + std25 + BScatter + range5 + hyp25 + range25 +
                           std5 + Depth + BPI_B_250 + BPI_B_100,
                        data=TBmodel, method = "class")

summary(TBLv3RockRf.tree) # MISCLASSIFICATION RATE 1.3%

##############
## Mangrove ##
##############

MGLv3RockRf.tree <- tree(as.factor(Lv3_Reef_Rock) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= MGmodel, na.action = na.exclude, method = "class")
plot(MGLv3RockRf.tree); text(MGLv3RockRf.tree,cex=0.5)
summary(MGLv3RockRf.tree)

# Select the best model variables
MGLv3RockRf.tree <- tree(as.factor(Lv3_Reef_Rock) ~ BPI_B_250 + hyp25 + north + curv_prof + std5 + mean25 + std25 +
                           range25 + std10,
                        data=MGmodel, method = "class")

summary(MGLv3RockRf.tree) # MISCLASSIFICATION RATE 0.45%


##################
# Southern Site ##
##################

SSLv3RockRf.tree <- tree(as.factor(Lv3_Reef_Rock) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= SSmodel, na.action = na.exclude, method = "class")
plot(SSLv3RockRf.tree); text(SSLv3RockRf.tree,cex=0.5)
summary(SSLv3RockRf.tree)

# Select the best model variables
SSLv3RockRf.tree <- tree(as.factor(Lv3_Reef_Rock) ~ range25 + std25 + mean25 + BPI_B_250 + std10 + hyp10 + std5 + BScatter +
                           range10 + std3 + hyp25 + curv_plan,
                        data=SSmodel, method = "class")

summary(SSLv3RockRf.tree) # MISCLASSIFICATION RATE 1.6%


########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3RockRf.fit1  <- cv.tree(Lv3RockRf.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3RockRf.fit1)
        summary(Lv3RockRf.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 10    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3RockRf.prune <- prune.misclass(Lv3RockRf.tree, best = TreeSize) 
        plot(Lv3RockRf.prune); text(Lv3RockRf.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3RockRf.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3RockRf.prune <- prune.misclass(Lv3RockRf.tree, best = 12)         # choose best tree size and add value in!!!
plot(Lv3RockRf.prune); text(Lv3RockRf.prune,cex=0.8)
summary(Lv3RockRf.prune) # 4.6% misclassification

Lv3RockRf.predict <- predict(Lv3RockRf.prune, test, type = c("vector"))
Lv3RockRf.predict <- as.data.frame(Lv3RockRf.predict [,2])
out.predict.Lv3RockRf <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Reef_Rock, Lv3RockRf.predict))
names(out.predict.Lv3RockRf) <- c("X", "Y", "Lv3RockRf.test", "Lv3RockRf.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3RockRf_prune.txt")
Lv3RockRf.prune 
sink()



###############
# Helby Banks #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        HBLv3RockRf.fit1  <- cv.tree(HBLv3RockRf.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(HBLv3RockRf.fit1)
        summary(HBLv3RockRf.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 10   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        HBLv3RockRf.prune <- prune.misclass(HBLv3RockRf.tree, best = TreeSize) 
        plot(HBLv3RockRf.prune); text(HBLv3RockRf.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(HBLv3RockRf.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


HBLv3RockRf.prune <- prune.misclass(HBLv3RockRf.tree, best = 12)         # choose best tree size and add value in!!!
plot(HBLv3RockRf.prune); text(HBLv3RockRf.prune,cex=0.8)
summary(HBLv3RockRf.prune) # misclassification rate 0.17%

HBLv3RockRf.predict <- predict(HBLv3RockRf.prune, HBtest, type = c("vector"))
HBLv3RockRf.predict <- as.data.frame(HBLv3RockRf.predict [,2])
out.predict.HBLv3RockRf <- as.data.frame(cbind(HBtest$Long, HBtest$Lat, 
   HBtest$Lv3_Reef_Rock, HBLv3RockRf.predict))
names(out.predict.HBLv3RockRf) <- c("X", "Y", "Lv3RockRf.test", "Lv3RockRf.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/HB_Lv3RockRf_prune.txt")
HBLv3RockRf.prune 
sink()


###############
# Tantabiddi #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        TBLv3RockRf.fit1  <- cv.tree(TBLv3RockRf.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(TBLv3RockRf.fit1)
        summary(TBLv3RockRf.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        TBLv3RockRf.prune <- prune.misclass(TBLv3RockRf.tree, best = TreeSize) 
        plot(TBLv3RockRf.prune); text(TBLv3RockRf.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(TBLv3RockRf.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


TBLv3RockRf.prune <- prune.misclass(TBLv3RockRf.tree, best = 10)         # choose best tree size and add value in!!!
plot(TBLv3RockRf.prune); text(TBLv3RockRf.prune,cex=0.8)
summary(TBLv3RockRf.prune) # misclassification rate 1.6%

TBLv3RockRf.predict <- predict(TBLv3RockRf.prune, TBtest, type = c("vector"))
TBLv3RockRf.predict <- as.data.frame(TBLv3RockRf.predict [,2])
out.predict.TBLv3RockRf <- as.data.frame(cbind(TBtest$Long, TBtest$Lat, 
   TBtest$Lv3_Reef_Rock, TBLv3RockRf.predict))
names(out.predict.TBLv3RockRf) <- c("X", "Y", "Lv3RockRf.test", "Lv3RockRf.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/TB_Lv3RockRf_prune.txt")
TBLv3RockRf.prune 
sink()


############
# Mangrove #
############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        MGLv3RockRf.fit1  <- cv.tree(MGLv3RockRf.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(MGLv3RockRf.fit1)
        summary(MGLv3RockRf.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 4   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        MGLv3RockRf.prune <- prune.misclass(MGLv3RockRf.tree, best = TreeSize) 
        plot(MGLv3RockRf.prune); text(MGLv3RockRf.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(MGLv3RockRf.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


MGLv3RockRf.prune <- prune.misclass(MGLv3RockRf.tree, best = 8)         # choose best tree size and add value in!!!
plot(MGLv3RockRf.prune); text(MGLv3RockRf.prune,cex=0.8)
summary(MGLv3RockRf.prune) # misclassification rate 0.84%

MGLv3RockRf.predict <- predict(MGLv3RockRf.prune, MGtest, type = c("vector"))
MGLv3RockRf.predict <- as.data.frame(MGLv3RockRf.predict [,2])
out.predict.MGLv3RockRf <- as.data.frame(cbind(MGtest$Long, MGtest$Lat, 
   MGtest$Lv3_Reef_Rock, MGLv3RockRf.predict))
names(out.predict.MGLv3RockRf) <- c("X", "Y", "Lv3RockRf.test", "Lv3RockRf.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/MG_Lv3RockRf_prune.txt")
MGLv3RockRf.prune 
sink()


############
# Southern Site #
############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        SSLv3RockRf.fit1  <- cv.tree(SSLv3RockRf.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(SSLv3RockRf.fit1)
        summary(SSLv3RockRf.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 4   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        SSLv3RockRf.prune <- prune.misclass(SSLv3RockRf.tree, best = TreeSize) 
        plot(SSLv3RockRf.prune); text(SSLv3RockRf.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(SSLv3RockRf.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


SSLv3RockRf.prune <- prune.misclass(SSLv3RockRf.tree, best = 10)         # choose best tree size and add value in!!!
plot(SSLv3RockRf.prune); text(SSLv3RockRf.prune,cex=0.8)
summary(SSLv3RockRf.prune) # misclassification rate 3.4%

SSLv3RockRf.predict <- predict(SSLv3RockRf.prune, SStest, type = c("vector"))
SSLv3RockRf.predict <- as.data.frame(SSLv3RockRf.predict [,2])
out.predict.SSLv3RockRf <- as.data.frame(cbind(SStest$Long, SStest$Lat, 
   SStest$Lv3_Reef_Rock, SSLv3RockRf.predict))
names(out.predict.SSLv3RockRf) <- c("X", "Y", "Lv3RockRf.test", "Lv3RockRf.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/SS_Lv3RockRf_prune.txt")
SSLv3RockRf.prune 
sink()



############
# Predict ##
############

Lv3RockRf.prune
HBLv3RockRf.prune

###########
# ALL SITES 
###########

Lv3RockRf.rs.predict1 <- predict(Lv3RockRf.prune, points1, type = c("vector"))
Lv3RockRf.predict1 <- as.data.frame(Lv3RockRf.rs.predict1[,2])
pred.Lv3RockRf1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3RockRf.predict1))
names(pred.Lv3RockRf1) <- c("X","Y", "predLv3RockRf")

Lv3RockRf.rs.predict2 <- predict(Lv3RockRf.prune, points2, type = c("vector"))
Lv3RockRf.predict2 <- as.data.frame(Lv3RockRf.rs.predict2[,2])
pred.Lv3RockRf2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3RockRf.predict2))
names(pred.Lv3RockRf2) <- c("X","Y", "predLv3RockRf")

Lv3RockRf.rs.predict3 <- predict(Lv3RockRf.prune, points3, type = c("vector"))
Lv3RockRf.predict3 <- as.data.frame(Lv3RockRf.rs.predict3[,2])
pred.Lv3RockRf3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3RockRf.predict3))
names(pred.Lv3RockRf3) <- c("X","Y", "predLv3RockRf")


#########################
## Helby Banks Predict ##
#########################

HB.Lv3RockRf.rs.predict <- predict(HBLv3RockRf.prune, HBpoints, type = c("vector"))
HB.Lv3RockRf.predict <- as.data.frame(HB.Lv3RockRf.rs.predict[,2])
predHB.Lv3RockRf <- as.data.frame(cbind(HBpoints$Long, HBpoints$Lat,  HB.Lv3RockRf.predict))
names(predHB.Lv3RockRf) <- c("X","Y", "predLv3RockRf")


#########################
## Tantabiddi Predict ##
#########################

TB.Lv3RockRf.rs.predict <- predict(TBLv3RockRf.prune, TBpoints, type = c("vector"))
TB.Lv3RockRf.predict <- as.data.frame(TB.Lv3RockRf.rs.predict[,2])
predTB.Lv3RockRf <- as.data.frame(cbind(TBpoints$Long, TBpoints$Lat,  TB.Lv3RockRf.predict))
names(predTB.Lv3RockRf) <- c("X","Y", "predLv3RockRf")

######################
## Mangrove Predict ##
######################

MG.Lv3RockRf.rs.predict <- predict(MGLv3RockRf.prune, MGpoints, type = c("vector"))
MG.Lv3RockRf.predict <- as.data.frame(MG.Lv3RockRf.rs.predict[,2])
predMG.Lv3RockRf <- as.data.frame(cbind(MGpoints$Long, MGpoints$Lat,  MG.Lv3RockRf.predict))
names(predMG.Lv3RockRf) <- c("X","Y", "predLv3RockRf")

######################
## Southern Predict ##
######################

SS.Lv3RockRf.rs.predict <- predict(SSLv3RockRf.prune, SSpoints, type = c("vector"))
SS.Lv3RockRf.predict <- as.data.frame(SS.Lv3RockRf.rs.predict[,2])
predSS.Lv3RockRf <- as.data.frame(cbind(SSpoints$Long, SSpoints$Lat,  SS.Lv3RockRf.predict))
names(predSS.Lv3RockRf) <- c("X","Y", "predLv3RockRf")


#####################
## Export to ASCII ##
#####################

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3RockRf1) <- ~X+Y
ext <- extent(pred.Lv3RockRf1)
table(diff(pred.Lv3RockRf1@coords[,1]))
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3RockRf1, r, 'predLv3RockRf')
writeRaster(to_ascii,'AllLv3Rock1.asc', format='ascii')

coordinates(pred.Lv3RockRf2) <- ~X+Y
ext2 <- extent(pred.Lv3RockRf2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3RockRf2, r2, 'predLv3RockRf')
writeRaster(to_ascii2,'AllLv3Rock2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3RockRf3) <- ~X+Y
ext3 <- extent(pred.Lv3RockRf3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3RockRf3, r3, 'predLv3RockRf')
writeRaster(to_ascii3,'AllLv3Rock3.asc', format='ascii')

# Helby Banks
coordinates(predHB.Lv3RockRf) <- ~X+Y
extHB <- extent(predHB.Lv3RockRf)
table(diff(predHB.Lv3RockRf@coords[,1]))
rHB <- raster(ext=extHB,res=0.0000483000000031097)
to_asciiHB <- rasterize(predHB.Lv3RockRf, rHB, 'predLv3RockRf')
writeRaster(to_asciiHB,'HBLv3Rock.asc', format='ascii')

# Tantabiddi
coordinates(predTB.Lv3RockRf) <- ~X+Y
extTB <- extent(predTB.Lv3RockRf)
table(diff(predTB.Lv3RockRf@coords[,1]))
rTB <- raster(ext=extTB,res=0.0000483000000031097)
to_asciiTB <- rasterize(predTB.Lv3RockRf, rTB, 'predLv3RockRf')
writeRaster(to_asciiTB,'TBLv3Rock.asc', format='ascii')

# Mangrove
coordinates(predMG.Lv3RockRf) <- ~X+Y
extMG <- extent(predMG.Lv3RockRf)
table(diff(predMG.Lv3RockRf@coords[,1]))
rMG <- raster(ext=extMG,res=0.0000483000000031097)
to_asciiMG <- rasterize(predMG.Lv3RockRf, rMG, 'predLv3RockRf')
writeRaster(to_asciiMG,'MGLv3Rock.asc', format='ascii')

# Southern
coordinates(predSS.Lv3RockRf) <- ~X+Y
extSS <- extent(predSS.Lv3RockRf)
table(diff(predSS.Lv3RockRf@coords[,1]))
rSS <- raster(ext=extSS,res=0.00004500000005447)
to_asciiSS <- rasterize(predSS.Lv3RockRf, rSS, 'predLv3RockRf')
writeRaster(to_asciiSS,'SSLv3Rock.asc', format='ascii')


################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3RockRf, "43_OutPredict_All_Lv3RockRf_5m.csv")
write.csv(out.predict.HBLv3RockRf, "44_OutPredict_HB_Lv3RockRf_5m.csv")
write.csv(out.predict.TBLv3RockRf, "45_OutPredict_TB_Lv3RockRf_5m.csv")
write.csv(out.predict.MGLv3RockRf, "46_OutPredict_MG_Lv3RockRf_5m.csv")
write.csv(out.predict.SSLv3RockRf, "70_OutPredict_SS_Lv3RockRf_5m.csv")


```






```{r}

############################################
#### Level 3 - ROCKY REEF (HIGH RELEIF) ####
############################################

Lv3RockHigh.tree <- tree(as.factor(Lv3_Reef_Rock_High) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3RockHigh.tree); text(Lv3RockHigh.tree,cex=0.5)
summary(Lv3RockHigh.tree)


# Select the best model variables
Lv3RockHigh.tree <- tree(as.factor(Lv3_Reef_Rock_High) ~ std5 + range25 + BPI_B_100 + BPI_F_25 + mean25 + mean5,
                        data=model, method = "class")

summary(Lv3RockHigh.tree) # MISCLASSIFICATION RATE 7.4%


#################
## Helby Banks ##
#################

HBLv3RockHigh.tree <- tree(as.factor(Lv3_Reef_Rock_High) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= HBmodel, na.action = na.exclude, method = "class")
plot(HBLv3RockHigh.tree); text(HBLv3RockHigh.tree,cex=0.5)
summary(HBLv3RockHigh.tree)

# Select the best model variables
HBLv3RockHigh.tree <- tree(as.factor(Lv3_Reef_Rock_High) ~ rugosity + range5 + BPI_B_50 + range10,
                        data=HBmodel, method = "class")

summary(HBLv3RockHigh.tree) # MISCLASSIFICATION RATE 8.5%



################
## Tantabiddi ##
################

TBLv3RockHigh.tree <- tree(as.factor(Lv3_Reef_Rock_High) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= TBmodel, na.action = na.exclude, method = "class")
plot(TBLv3RockHigh.tree); text(TBLv3RockHigh.tree,cex=0.5)
summary(TBLv3RockHigh.tree)

# Select the best model variables
TBLv3RockHigh.tree <- tree(as.factor(Lv3_Reef_Rock_High) ~ mean25 + range10 + range25 + hyp25 + std10 + hyp3 +
                             std25,
                        data=TBmodel, method = "class")

summary(TBLv3RockHigh.tree) # MISCLASSIFICATION RATE 0.3%

##############
## Mangrove ##
##############

MGLv3RockHigh.tree <- tree(as.factor(Lv3_Reef_Rock_High) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= MGmodel, na.action = na.exclude, method = "class")
plot(MGLv3RockHigh.tree); text(MGLv3RockHigh.tree,cex=0.5)
summary(MGLv3RockHigh.tree)

# Select the best model variables
MGLv3RockHigh.tree <- tree(as.factor(Lv3_Reef_Rock_High) ~ Depth + hyp5 + BPI_F_25 +std25 + mean25 + curv,
                        data=MGmodel, method = "class")

summary(MGLv3RockHigh.tree) # MISCLASSIFICATION RATE 0.38%


##################
# Southern Site ##
##################

SSLv3RockHigh.tree <- tree(as.factor(Lv3_Reef_Rock_High) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= SSmodel, na.action = na.exclude, method = "class")
plot(SSLv3RockHigh.tree); text(SSLv3RockHigh.tree,cex=0.5)
summary(SSLv3RockHigh.tree)

# Select the best model variables
SSLv3RockHigh.tree <- tree(as.factor(Lv3_Reef_Rock_High) ~ BPI_B_50 + std25 + rugosity + curv_prof + mean25 + mean3 +
                             east + hyp5 + mean10 + BScatter + hyp3 + range25 + Depth + hyp25,
                        data=SSmodel, method = "class")

summary(SSLv3RockHigh.tree) # MISCLASSIFICATION RATE 6.6%


########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3RockHigh.fit1  <- cv.tree(Lv3RockHigh.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3RockHigh.fit1)
        summary(Lv3RockHigh.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3RockHigh.prune <- prune.misclass(Lv3RockHigh.tree, best = TreeSize) 
        plot(Lv3RockHigh.prune); text(Lv3RockHigh.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3RockHigh.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3RockHigh.prune <- prune.misclass(Lv3RockHigh.tree, best = 6)         # choose best tree size and add value in!!!
plot(Lv3RockHigh.prune); text(Lv3RockHigh.prune,cex=0.8)
summary(Lv3RockHigh.prune) # 7.4% misclassification

Lv3RockHigh.predict <- predict(Lv3RockHigh.prune, test, type = c("vector"))
Lv3RockHigh.predict <- as.data.frame(Lv3RockHigh.predict [,2])
out.predict.Lv3RockHigh <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Reef_Rock_High, Lv3RockHigh.predict))
names(out.predict.Lv3RockHigh) <- c("X", "Y", "Lv3RockHigh.test", "Lv3RockHigh.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3RockHigh_prune.txt")
Lv3RockHigh.prune 
sink()



###############
# Helby Banks #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        HBLv3RockHigh.fit1  <- cv.tree(HBLv3RockHigh.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(HBLv3RockHigh.fit1)
        summary(HBLv3RockHigh.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        HBLv3RockHigh.prune <- prune.misclass(HBLv3RockHigh.tree, best = TreeSize) 
        plot(HBLv3RockHigh.prune); text(HBLv3RockHigh.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(HBLv3RockHigh.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


HBLv3RockHigh.prune <- prune.misclass(HBLv3RockHigh.tree, best = 4)         # choose best tree size and add value in!!!
plot(HBLv3RockHigh.prune); text(HBLv3RockHigh.prune,cex=0.8)
summary(HBLv3RockHigh.prune) # misclassification rate 8.5%

HBLv3RockHigh.predict <- predict(HBLv3RockHigh.prune, HBtest, type = c("vector"))
HBLv3RockHigh.predict <- as.data.frame(HBLv3RockHigh.predict [,2])
out.predict.HBLv3RockHigh <- as.data.frame(cbind(HBtest$Long, HBtest$Lat, 
   HBtest$Lv3_Reef_Rock_High, HBLv3RockHigh.predict))
names(out.predict.HBLv3RockHigh) <- c("X", "Y", "Lv3RockHigh.test", "Lv3RockHigh.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/HB_Lv3RockHigh_prune.txt")
HBLv3RockHigh.prune 
sink()


###############
# Tantabiddi #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        TBLv3RockHigh.fit1  <- cv.tree(TBLv3RockHigh.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(TBLv3RockHigh.fit1)
        summary(TBLv3RockHigh.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 4   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        TBLv3RockHigh.prune <- prune.misclass(TBLv3RockHigh.tree, best = TreeSize) 
        plot(TBLv3RockHigh.prune); text(TBLv3RockHigh.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(TBLv3RockHigh.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


TBLv3RockHigh.prune <- prune.misclass(TBLv3RockHigh.tree, best = 10)         # choose best tree size and add value in!!!
plot(TBLv3RockHigh.prune); text(TBLv3RockHigh.prune,cex=0.8)
summary(TBLv3RockHigh.prune) # misclassification rate 0.3%

TBLv3RockHigh.predict <- predict(TBLv3RockHigh.prune, TBtest, type = c("vector"))
TBLv3RockHigh.predict <- as.data.frame(TBLv3RockHigh.predict [,2])
out.predict.TBLv3RockHigh <- as.data.frame(cbind(TBtest$Long, TBtest$Lat, 
   TBtest$Lv3_Reef_Rock_High, TBLv3RockHigh.predict))
names(out.predict.TBLv3RockHigh) <- c("X", "Y", "Lv3RockHigh.test", "Lv3RockHigh.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/TB_Lv3RockHigh_prune.txt")
TBLv3RockHigh.prune 
sink()


############
# Mangrove #
############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        MGLv3RockHigh.fit1  <- cv.tree(MGLv3RockHigh.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(MGLv3RockHigh.fit1)
        summary(MGLv3RockHigh.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        MGLv3RockHigh.prune <- prune.misclass(MGLv3RockHigh.tree, best = TreeSize) 
        plot(MGLv3RockHigh.prune); text(MGLv3RockHigh.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(MGLv3RockHigh.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


MGLv3RockHigh.prune <- prune.misclass(MGLv3RockHigh.tree, best = 8)         # choose best tree size and add value in!!!
plot(MGLv3RockHigh.prune); text(MGLv3RockHigh.prune,cex=0.8)
summary(MGLv3RockHigh.prune) # misclassification rate 0.38%

MGLv3RockHigh.predict <- predict(MGLv3RockHigh.prune, MGtest, type = c("vector"))
MGLv3RockHigh.predict <- as.data.frame(MGLv3RockHigh.predict [,2])
out.predict.MGLv3RockHigh <- as.data.frame(cbind(MGtest$Long, MGtest$Lat, 
   MGtest$Lv3_Reef_Rock_High, MGLv3RockHigh.predict))
names(out.predict.MGLv3RockHigh) <- c("X", "Y", "Lv3RockHigh.test", "Lv3RockHigh.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/MG_Lv3RockHigh_prune.txt")
MGLv3RockHigh.prune 
sink()


############
# Southern #
############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        SSLv3RockHigh.fit1  <- cv.tree(SSLv3RockHigh.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(SSLv3RockHigh.fit1)
        summary(SSLv3RockHigh.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        SSLv3RockHigh.prune <- prune.misclass(SSLv3RockHigh.tree, best = TreeSize) 
        plot(SSLv3RockHigh.prune); text(SSLv3RockHigh.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(SSLv3RockHigh.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


SSLv3RockHigh.prune <- prune.misclass(SSLv3RockHigh.tree, best = 12)         # choose best tree size and add value in!!!
plot(SSLv3RockHigh.prune); text(SSLv3RockHigh.prune,cex=0.8)
summary(SSLv3RockHigh.prune) # misclassification rate 11.1%

SSLv3RockHigh.predict <- predict(SSLv3RockHigh.prune, SStest, type = c("vector"))
SSLv3RockHigh.predict <- as.data.frame(SSLv3RockHigh.predict [,2])
out.predict.SSLv3RockHigh <- as.data.frame(cbind(SStest$Long, SStest$Lat, 
   SStest$Lv3_Reef_Rock_High, SSLv3RockHigh.predict))
names(out.predict.SSLv3RockHigh) <- c("X", "Y", "Lv3RockHigh.test", "Lv3RockHigh.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/SS_Lv3RockHigh_prune.txt")
SSLv3RockHigh.prune 
sink()


############
# Predict ##
############

Lv3RockHigh.prune
HBLv3RockHigh.prune

###########
# ALL SITES 
###########

Lv3RockHigh.rs.predict1 <- predict(Lv3RockHigh.prune, points1, type = c("vector"))
Lv3RockHigh.predict1 <- as.data.frame(Lv3RockHigh.rs.predict1[,2])
pred.Lv3RockHigh1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3RockHigh.predict1))
names(pred.Lv3RockHigh1) <- c("X","Y", "predLv3RockHigh")

Lv3RockHigh.rs.predict2 <- predict(Lv3RockHigh.prune, points2, type = c("vector"))
Lv3RockHigh.predict2 <- as.data.frame(Lv3RockHigh.rs.predict2[,2])
pred.Lv3RockHigh2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3RockHigh.predict2))
names(pred.Lv3RockHigh2) <- c("X","Y", "predLv3RockHigh")

Lv3RockHigh.rs.predict3 <- predict(Lv3RockHigh.prune, points3, type = c("vector"))
Lv3RockHigh.predict3 <- as.data.frame(Lv3RockHigh.rs.predict3[,2])
pred.Lv3RockHigh3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3RockHigh.predict3))
names(pred.Lv3RockHigh3) <- c("X","Y", "predLv3RockHigh")


#########################
## Helby Banks Predict ##
#########################

HB.Lv3RockHigh.rs.predict <- predict(HBLv3RockHigh.prune, HBpoints, type = c("vector"))
HB.Lv3RockHigh.predict <- as.data.frame(HB.Lv3RockHigh.rs.predict[,2])
predHB.Lv3RockHigh <- as.data.frame(cbind(HBpoints$Long, HBpoints$Lat,  HB.Lv3RockHigh.predict))
names(predHB.Lv3RockHigh) <- c("X","Y", "predLv3RockHigh")


#########################
## Tantabiddi Predict ##
#########################

TB.Lv3RockHigh.rs.predict <- predict(TBLv3RockHigh.prune, TBpoints, type = c("vector"))
TB.Lv3RockHigh.predict <- as.data.frame(TB.Lv3RockHigh.rs.predict[,2])
predTB.Lv3RockHigh <- as.data.frame(cbind(TBpoints$Long, TBpoints$Lat,  TB.Lv3RockHigh.predict))
names(predTB.Lv3RockHigh) <- c("X","Y", "predLv3RockHigh")

######################
## Mangrove Predict ##
######################

MG.Lv3RockHigh.rs.predict <- predict(MGLv3RockHigh.prune, MGpoints, type = c("vector"))
MG.Lv3RockHigh.predict <- as.data.frame(MG.Lv3RockHigh.rs.predict[,2])
predMG.Lv3RockHigh <- as.data.frame(cbind(MGpoints$Long, MGpoints$Lat,  MG.Lv3RockHigh.predict))
names(predMG.Lv3RockHigh) <- c("X","Y", "predLv3RockHigh")

######################
## Southern Predict ##
######################

SS.Lv3RockHigh.rs.predict <- predict(SSLv3RockHigh.prune, SSpoints, type = c("vector"))
SS.Lv3RockHigh.predict <- as.data.frame(SS.Lv3RockHigh.rs.predict[,2])
predSS.Lv3RockHigh <- as.data.frame(cbind(SSpoints$Long, SSpoints$Lat,  SS.Lv3RockHigh.predict))
names(predSS.Lv3RockHigh) <- c("X","Y", "predLv3RockHigh")


#####################
## Export to ASCII ##
#####################

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3RockHigh1) <- ~X+Y
ext <- extent(pred.Lv3RockHigh1)
table(diff(pred.Lv3RockHigh1@coords[,1]))
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3RockHigh1, r, 'predLv3RockHigh')
writeRaster(to_ascii,'AllLv3RckH1.asc', format='ascii')

coordinates(pred.Lv3RockHigh2) <- ~X+Y
ext2 <- extent(pred.Lv3RockHigh2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3RockHigh2, r2, 'predLv3RockHigh')
writeRaster(to_ascii2,'AllLv3RckH2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3RockHigh3) <- ~X+Y
ext3 <- extent(pred.Lv3RockHigh3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3RockHigh3, r3, 'predLv3RockHigh')
writeRaster(to_ascii3,'AllLv3RckH3.asc', format='ascii')

# Helby Banks
coordinates(predHB.Lv3RockHigh) <- ~X+Y
extHB <- extent(predHB.Lv3RockHigh)
table(diff(predHB.Lv3RockHigh@coords[,1]))
rHB <- raster(ext=extHB,res=0.0000483000000031097)
to_asciiHB <- rasterize(predHB.Lv3RockHigh, rHB, 'predLv3RockHigh')
writeRaster(to_asciiHB,'HBLv3RckH.asc', format='ascii')

# Tantabiddi
coordinates(predTB.Lv3RockHigh) <- ~X+Y
extTB <- extent(predTB.Lv3RockHigh)
table(diff(predTB.Lv3RockHigh@coords[,1]))
rTB <- raster(ext=extTB,res=0.0000483000000031097)
to_asciiTB <- rasterize(predTB.Lv3RockHigh, rTB, 'predLv3RockHigh')
writeRaster(to_asciiTB,'TBLv3RckH.asc', format='ascii')

# Mangrove
coordinates(predMG.Lv3RockHigh) <- ~X+Y
extMG <- extent(predMG.Lv3RockHigh)
table(diff(predMG.Lv3RockHigh@coords[,1]))
rMG <- raster(ext=extMG,res=0.0000483000000031097)
to_asciiMG <- rasterize(predMG.Lv3RockHigh, rMG, 'predLv3RockHigh')
writeRaster(to_asciiMG,'MGLv3RckH.asc', format='ascii')


# Southern
coordinates(predSS.Lv3RockHigh) <- ~X+Y
extSS <- extent(predSS.Lv3RockHigh)
table(diff(predSS.Lv3RockHigh@coords[,1]))
rSS <- raster(ext=extSS,res=0.00004500000005447)
to_asciiSS <- rasterize(predSS.Lv3RockHigh, rSS, 'predLv3RockHigh')
writeRaster(to_asciiSS,'SSLv3RckH.asc', format='ascii')


################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3RockHigh, "62_OutPredict_All_Lv3RockHigh_5m.csv")
write.csv(out.predict.HBLv3RockHigh, "63_OutPredict_HB_Lv3RockHigh_5m.csv")
write.csv(out.predict.TBLv3RockHigh, "64_OutPredict_TB_Lv3RockHigh_5m.csv")
write.csv(out.predict.MGLv3RockHigh, "65_OutPredict_MG_Lv3RockHigh_5m.csv")
write.csv(out.predict.SSLv3RockHigh, "71_OutPredict_SS_Lv3RockHigh_5m.csv")

```











```{r}

###########################################
#### Level 3 - ROCKY REEF THICK VENEER ####
###########################################

Lv3RckThickV.tree <- tree(as.factor(Lv3_Reef_Thick_Veneer) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3RckThickV.tree); text(Lv3RckThickV.tree,cex=0.5)
summary(Lv3RckThickV.tree)


# Select the best model variables
Lv3RckThickV.tree <- tree(as.factor(Lv3_Reef_Thick_Veneer) ~ mean25 + mean10 + BPI_B_250 + range25 + std10 + range10 +
                            BPI_B_100 + std25 + BScatter + range3,
                        data=model, method = "class")

summary(Lv3RckThickV.tree) # MISCLASSIFICATION RATE 1.4%


#################
## Helby Banks ##
#################

HBLv3RckThickV.tree <- tree(as.factor(Lv3_Reef_Thick_Veneer) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= HBmodel, na.action = na.exclude, method = "class")
plot(HBLv3RckThickV.tree); text(HBLv3RckThickV.tree,cex=0.5)
summary(HBLv3RckThickV.tree)

# Select the best model variables
HBLv3RckThickV.tree <- tree(as.factor(Lv3_Reef_Thick_Veneer) ~ mean25 + mean10 + range25 + mean3 + north + range10 +
                             Depth + std25 + slope + std5,
                        data=HBmodel, method = "class")

summary(HBLv3RckThickV.tree) # MISCLASSIFICATION RATE 1.0%

################
## Tantabiddi ##
################

TBLv3RckThickV.tree <- tree(as.factor(Lv3_Reef_Thick_Veneer) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= TBmodel, na.action = na.exclude, method = "class")
plot(TBLv3RckThickV.tree); text(TBLv3RckThickV.tree,cex=0.5)
summary(TBLv3RckThickV.tree)

# Select the best model variables
TBLv3RckThickV.tree <- tree(as.factor(Lv3_Reef_Thick_Veneer) ~ Depth + range25 + std10 + BScatter + mean10 + rugosity +
                           range10 + east + std5 + hyp25 + std25 + mean25,
                        data=TBmodel, method = "class")

summary(TBLv3RckThickV.tree) # MISCLASSIFICATION RATE 0.64%

##############
## Mangrove ##
##############

MGLv3RckThickV.tree <- tree(as.factor(Lv3_Reef_Thick_Veneer) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= MGmodel, na.action = na.exclude, method = "class")
plot(MGLv3RckThickV.tree); text(MGLv3RckThickV.tree,cex=0.5)
summary(MGLv3RckThickV.tree)

# Select the best model variables
MGLv3RckThickV.tree <- tree(as.factor(Lv3_Reef_Thick_Veneer) ~ BPI_B_100 + std25 + mean3 + Depth + rugosity + mean5,
                        data=MGmodel, method = "class")

summary(MGLv3RckThickV.tree) # MISCLASSIFICATION RATE 0.06%


##################
# Southern Site ##
##################



########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3RckThickV.fit1  <- cv.tree(Lv3RckThickV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3RckThickV.fit1)
        summary(Lv3RckThickV.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3RckThickV.prune <- prune.misclass(Lv3RckThickV.tree, best = TreeSize) 
        plot(Lv3RckThickV.prune); text(Lv3RckThickV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3RckThickV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3RckThickV.prune <- prune.misclass(Lv3RckThickV.tree, best = 6)         # choose best tree size and add value in!!!
plot(Lv3RckThickV.prune); text(Lv3RckThickV.prune,cex=0.8)
summary(Lv3RckThickV.prune) # 1.6% misclassification

Lv3RckThickV.predict <- predict(Lv3RckThickV.prune, test, type = c("vector"))
Lv3RckThickV.predict <- as.data.frame(Lv3RckThickV.predict [,2])
out.predict.Lv3RckThickV <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Reef_Thick_Veneer, Lv3RckThickV.predict))
names(out.predict.Lv3RckThickV) <- c("X", "Y", "Lv3RckThickV.test", "Lv3RckThickV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3RckThickV_prune.txt")
Lv3RckThickV.prune 
sink()

############
# Helby Banks #
############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        HBLv3RckThickV.fit1  <- cv.tree(HBLv3RckThickV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(HBLv3RckThickV.fit1)
        summary(HBLv3RckThickV.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        HBLv3RckThickV.prune <- prune.misclass(HBLv3RckThickV.tree, best = TreeSize) 
        plot(HBLv3RckThickV.prune); text(HBLv3RckThickV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(HBLv3RckThickV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


HBLv3RckThickV.prune <- prune.misclass(HBLv3RckThickV.tree, best = 10)         # choose best tree size and add value in!!!
plot(HBLv3RckThickV.prune); text(HBLv3RckThickV.prune,cex=0.8)
summary(HBLv3RckThickV.prune) # misclassification rate 1.4%

HBLv3RckThickV.predict <- predict(HBLv3RckThickV.prune, HBtest, type = c("vector"))
HBLv3RckThickV.predict <- as.data.frame(HBLv3RckThickV.predict [,2])
out.predict.HBLv3RckThickV <- as.data.frame(cbind(HBtest$Long, HBtest$Lat, 
   HBtest$Lv3_Reef_Thick_Veneer, HBLv3RckThickV.predict))
names(out.predict.HBLv3RckThickV) <- c("X", "Y", "Lv3RckThickV.test", "Lv3RckThickV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/HB_Lv3RckThickV_prune.txt")
HBLv3RckThickV.prune 
sink()


############
# Tantabiddi #
############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        TBLv3RckThickV.fit1  <- cv.tree(TBLv3RckThickV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(TBLv3RckThickV.fit1)
        summary(TBLv3RckThickV.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        TBLv3RckThickV.prune <- prune.misclass(TBLv3RckThickV.tree, best = TreeSize) 
        plot(TBLv3RckThickV.prune); text(TBLv3RckThickV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(TBLv3RckThickV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


TBLv3RckThickV.prune <- prune.misclass(TBLv3RckThickV.tree, best = 8)         # choose best tree size and add value in!!!
plot(TBLv3RckThickV.prune); text(TBLv3RckThickV.prune,cex=0.8)
summary(TBLv3RckThickV.prune) # misclassification rate 1.1%

TBLv3RckThickV.predict <- predict(TBLv3RckThickV.prune, TBtest, type = c("vector"))
TBLv3RckThickV.predict <- as.data.frame(TBLv3RckThickV.predict [,2])
out.predict.TBLv3RckThickV <- as.data.frame(cbind(TBtest$Long, TBtest$Lat, 
   TBtest$Lv3_Reef_Thick_Veneer, TBLv3RckThickV.predict))
names(out.predict.TBLv3RckThickV) <- c("X", "Y", "Lv3RckThickV.test", "Lv3RckThickV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/TB_Lv3RckThickV_prune.txt")
TBLv3RckThickV.prune 
sink()



############
# Mangrove #
############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        MGLv3RckThickV.fit1  <- cv.tree(MGLv3RckThickV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(MGLv3RckThickV.fit1)
        summary(MGLv3RckThickV.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        MGLv3RckThickV.prune <- prune.misclass(MGLv3RckThickV.tree, best = TreeSize) 
        plot(MGLv3RckThickV.prune); text(MGLv3RckThickV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(MGLv3RckThickV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


MGLv3RckThickV.prune <- prune.misclass(MGLv3RckThickV.tree, best = 6)         # choose best tree size and add value in!!!
plot(MGLv3RckThickV.prune); text(MGLv3RckThickV.prune,cex=0.8)
summary(MGLv3RckThickV.prune) # misclassification rate 0.06%

MGLv3RckThickV.predict <- predict(MGLv3RckThickV.prune, MGtest, type = c("vector"))
MGLv3RckThickV.predict <- as.data.frame(MGLv3RckThickV.predict [,2])
out.predict.MGLv3RckThickV <- as.data.frame(cbind(MGtest$Long, MGtest$Lat, 
   MGtest$Lv3_Reef_Thick_Veneer, MGLv3RckThickV.predict))
names(out.predict.MGLv3RckThickV) <- c("X", "Y", "Lv3RckThickV.test", "Lv3RckThickV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/MG_Lv3RckThickV_prune.txt")
MGLv3RckThickV.prune 
sink()




############
# Predict ##
############

Lv3RckThickV.prune
HBLv3RckThickV.prune

###########
# ALL SITES 
###########

Lv3RckThickV.rs.predict1 <- predict(Lv3RckThickV.prune, points1, type = c("vector"))
Lv3RckThickV.predict1 <- as.data.frame(Lv3RckThickV.rs.predict1[,2])
pred.Lv3RckThickV1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3RckThickV.predict1))
names(pred.Lv3RckThickV1) <- c("X","Y", "predLv3RckThickV")

Lv3RckThickV.rs.predict2 <- predict(Lv3RckThickV.prune, points2, type = c("vector"))
Lv3RckThickV.predict2 <- as.data.frame(Lv3RckThickV.rs.predict2[,2])
pred.Lv3RckThickV2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3RckThickV.predict2))
names(pred.Lv3RckThickV2) <- c("X","Y", "predLv3RckThickV")

Lv3RckThickV.rs.predict3 <- predict(Lv3RckThickV.prune, points3, type = c("vector"))
Lv3RckThickV.predict3 <- as.data.frame(Lv3RckThickV.rs.predict3[,2])
pred.Lv3RckThickV3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3RckThickV.predict3))
names(pred.Lv3RckThickV3) <- c("X","Y", "predLv3RckThickV")

######################
## Helby Banks Predict ##
######################

HB.Lv3RckThickV.rs.predict <- predict(HBLv3RckThickV.prune, HBpoints, type = c("vector"))
HB.Lv3RckThickV.predict <- as.data.frame(HB.Lv3RckThickV.rs.predict[,2])
predHB.Lv3RckThickV <- as.data.frame(cbind(HBpoints$Long, HBpoints$Lat,  HB.Lv3RckThickV.predict))
names(predHB.Lv3RckThickV) <- c("X","Y", "predLv3RckThickV")

######################
## Tantabiddi Predict ##
######################

TB.Lv3RckThickV.rs.predict <- predict(TBLv3RckThickV.prune, TBpoints, type = c("vector"))
TB.Lv3RckThickV.predict <- as.data.frame(TB.Lv3RckThickV.rs.predict[,2])
predTB.Lv3RckThickV <- as.data.frame(cbind(TBpoints$Long, TBpoints$Lat,  TB.Lv3RckThickV.predict))
names(predTB.Lv3RckThickV) <- c("X","Y", "predLv3RckThickV")

######################
## Mangrove Predict ##
######################

MG.Lv3RckThickV.rs.predict <- predict(MGLv3RckThickV.prune, MGpoints, type = c("vector"))
MG.Lv3RckThickV.predict <- as.data.frame(MG.Lv3RckThickV.rs.predict[,2])
predMG.Lv3RckThickV <- as.data.frame(cbind(MGpoints$Long, MGpoints$Lat,  MG.Lv3RckThickV.predict))
names(predMG.Lv3RckThickV) <- c("X","Y", "predLv3RckThickV")


#####################
## Export to ASCII ##
#####################

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3RckThickV1) <- ~X+Y
ext <- extent(pred.Lv3RckThickV1)
table(diff(pred.Lv3RckThickV1@coords[,1]))
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3RckThickV1, r, 'predLv3RckThickV')
writeRaster(to_ascii,'AllLv3RckTkV1.asc', format='ascii')

coordinates(pred.Lv3RckThickV2) <- ~X+Y
ext2 <- extent(pred.Lv3RckThickV2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3RckThickV2, r2, 'predLv3RckThickV')
writeRaster(to_ascii2,'AllLv3RckTkV2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3RckThickV3) <- ~X+Y
ext3 <- extent(pred.Lv3RckThickV3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3RckThickV3, r3, 'predLv3RckThickV')
writeRaster(to_ascii3,'AllLv3RckTkV3.asc', format='ascii')

# Helby Banks
coordinates(predHB.Lv3RckThickV) <- ~X+Y
extHB <- extent(predHB.Lv3RckThickV)
table(diff(predHB.Lv3RckThickV@coords[,1]))
rHB <- raster(ext=extHB,res=0.0000483000000031097)
to_asciiHB <- rasterize(predHB.Lv3RckThickV, rHB, 'predLv3RckThickV')
writeRaster(to_asciiHB,'HBLv3RckTkV.asc', format='ascii')

# Tantabiddi
coordinates(predTB.Lv3RckThickV) <- ~X+Y
extTB <- extent(predTB.Lv3RckThickV)
table(diff(predTB.Lv3RckThickV@coords[,1]))
rTB <- raster(ext=extTB,res=0.0000483000000031097)
to_asciiTB <- rasterize(predTB.Lv3RckThickV, rTB, 'predLv3RckThickV')
writeRaster(to_asciiTB,'TBLv3RckTkV.asc', format='ascii')

# Mangrove
coordinates(predMG.Lv3RckThickV) <- ~X+Y
extMG <- extent(predMG.Lv3RckThickV)
table(diff(predMG.Lv3RckThickV@coords[,1]))
rMG <- raster(ext=extMG,res=0.0000483000000031097)
to_asciiMG <- rasterize(predMG.Lv3RckThickV, rMG, 'predLv3RckThickV')
writeRaster(to_asciiMG,'MGLv3RckTkV.asc', format='ascii')


################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3RckThickV, "43_OutPredict_All_Lv3RckThickV_5m.csv")
write.csv(out.predict.HBLv3RckThickV, "44_OutPredict_HB_Lv3RckThickV_5m.csv")
write.csv(out.predict.TBLv3RckThickV, "45_OutPredict_TB_Lv3RckThickV_5m.csv")
write.csv(out.predict.MGLv3RckThickV, "46_OutPredict_MG_Lv3RckThickV_5m.csv")


```








```{r}

##########################################
#### Level 3 - ROCKY REEF THIN VENEER ####
##########################################

Lv3RRThinV.tree <- tree(as.factor(Lv3_Reef_Thin_Veneer) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3RRThinV.tree); text(Lv3RRThinV.tree,cex=0.5)
summary(Lv3RRThinV.tree)


# Select the best model variables
Lv3RRThinV.tree <- tree(as.factor(Lv3_Reef_Thin_Veneer) ~ mean25 + range25 + mean3 + std25 + BPI_B_250 + 
                          hyp25 + range5 + hyp10 + std10 + Depth,
                        data=model, method = "class")

summary(Lv3RRThinV.tree) # MISCLASSIFICATION RATE 7.5%


#################
## Helby Banks ##
#################

HBLv3RRThinV.tree <- tree(as.factor(Lv3_Reef_Thin_Veneer) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= HBmodel, na.action = na.exclude, method = "class")
plot(HBLv3RRThinV.tree); text(HBLv3RRThinV.tree,cex=0.5)
summary(HBLv3RRThinV.tree)

# Select the best model variables
HBLv3RRThinV.tree <- tree(as.factor(Lv3_Reef_Thin_Veneer) ~ mean25 + mean3 + mean5 + BScatter + std10 + range25 +
                            BPI_B_250 + range10 + mean10 + range5 + BPI_B_100,
                        data=HBmodel, method = "class")

summary(HBLv3RRThinV.tree) # MISCLASSIFICATION RATE 2.4%

################
## Tantabiddi ##
################

TBLv3RRThinV.tree <- tree(as.factor(Lv3_Reef_Thin_Veneer) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= TBmodel, na.action = na.exclude, method = "class")
plot(TBLv3RRThinV.tree); text(TBLv3RRThinV.tree,cex=0.5)
summary(TBLv3RRThinV.tree)

# Select the best model variables
TBLv3RRThinV.tree <- tree(as.factor(Lv3_Reef_Thin_Veneer) ~ mean25 + BPI_B_250 + slope + hyp10 + range25 +
                            std25 + std10 + hyp25 + range10,
                        data=TBmodel, method = "class")

summary(TBLv3RRThinV.tree) # MISCLASSIFICATION RATE 1.4%

##############
## Mangrove ##
##############

MGLv3RRThinV.tree <- tree(as.factor(Lv3_Reef_Thin_Veneer) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= MGmodel, na.action = na.exclude, method = "class")
plot(MGLv3RRThinV.tree); text(MGLv3RRThinV.tree,cex=0.5)
summary(MGLv3RRThinV.tree)

# Select the best model variables
MGLv3RRThinV.tree <- tree(as.factor(Lv3_Reef_Thin_Veneer) ~ Depth + BPI_B_250 + std5 + BPI_B_100 + range25 + std25 + std10 +
                           rugosity + north + BScatter + std3 + BPI_F_25 + BPI_B_50,
                        data=MGmodel, method = "class")

summary(MGLv3RRThinV.tree) # MISCLASSIFICATION RATE 2.4%


##################
# Southern Site ##
##################

SSLv3RRThinV.tree <- tree(as.factor(Lv3_Reef_Thin_Veneer) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= SSmodel, na.action = na.exclude, method = "class")
plot(SSLv3RRThinV.tree); text(SSLv3RRThinV.tree,cex=0.5)
summary(SSLv3RRThinV.tree)

# Select the best model variables
SSLv3RRThinV.tree <- tree(as.factor(Lv3_Reef_Thin_Veneer) ~ mean25 + range25 + slope,
                        data=SSmodel, method = "class")

summary(SSLv3RRThinV.tree) # MISCLASSIFICATION RATE 0.1%



########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3RRThinV.fit1  <- cv.tree(Lv3RRThinV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3RRThinV.fit1)
        summary(Lv3RRThinV.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 10    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3RRThinV.prune <- prune.misclass(Lv3RRThinV.tree, best = TreeSize) 
        plot(Lv3RRThinV.prune); text(Lv3RRThinV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3RRThinV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3RRThinV.prune <- prune.misclass(Lv3RRThinV.tree, best = 2)         # choose best tree size and add value in!!!
plot(Lv3RRThinV.prune); text(Lv3RRThinV.prune,cex=0.8)
summary(Lv3RRThinV.prune) # 7.7% misclassification

Lv3RRThinV.predict <- predict(Lv3RRThinV.prune, test, type = c("vector"))
Lv3RRThinV.predict <- as.data.frame(Lv3RRThinV.predict [,2])
out.predict.Lv3RRThinV <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Reef_Thin_Veneer, Lv3RRThinV.predict))
names(out.predict.Lv3RRThinV) <- c("X", "Y", "Lv3RRThinV.test", "Lv3RRThinV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3RRThinV_prune.txt")
Lv3RRThinV.prune 
sink()



###############
# Helby Banks #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        HBLv3RRThinV.fit1  <- cv.tree(HBLv3RRThinV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(HBLv3RRThinV.fit1)
        summary(HBLv3RRThinV.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        HBLv3RRThinV.prune <- prune.misclass(HBLv3RRThinV.tree, best = TreeSize) 
        plot(HBLv3RRThinV.prune); text(HBLv3RRThinV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(HBLv3RRThinV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


HBLv3RRThinV.prune <- prune.misclass(HBLv3RRThinV.tree, best = 10)         # choose best tree size and add value in!!!
plot(HBLv3RRThinV.prune); text(HBLv3RRThinV.prune,cex=0.8)
summary(HBLv3RRThinV.prune) # misclassification rate 4.1%

HBLv3RRThinV.predict <- predict(HBLv3RRThinV.prune, HBtest, type = c("vector"))
HBLv3RRThinV.predict <- as.data.frame(HBLv3RRThinV.predict [,2])
out.predict.HBLv3RRThinV <- as.data.frame(cbind(HBtest$Long, HBtest$Lat, 
   HBtest$Lv3_Reef_Thin_Veneer, HBLv3RRThinV.predict))
names(out.predict.HBLv3RRThinV) <- c("X", "Y", "Lv3RRThinV.test", "Lv3RRThinV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/HB_Lv3RRThinV_prune.txt")
HBLv3RRThinV.prune 
sink()


###############
# Tantabiddi #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        TBLv3RRThinV.fit1  <- cv.tree(TBLv3RRThinV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(TBLv3RRThinV.fit1)
        summary(TBLv3RRThinV.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        TBLv3RRThinV.prune <- prune.misclass(TBLv3RRThinV.tree, best = TreeSize) 
        plot(TBLv3RRThinV.prune); text(TBLv3RRThinV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(TBLv3RRThinV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


TBLv3RRThinV.prune <- prune.misclass(TBLv3RRThinV.tree, best = 12)         # choose best tree size and add value in!!!
plot(TBLv3RRThinV.prune); text(TBLv3RRThinV.prune,cex=0.8)
summary(TBLv3RRThinV.prune) # misclassification rate 1.9%

TBLv3RRThinV.predict <- predict(TBLv3RRThinV.prune, TBtest, type = c("vector"))
TBLv3RRThinV.predict <- as.data.frame(TBLv3RRThinV.predict [,2])
out.predict.TBLv3RRThinV <- as.data.frame(cbind(TBtest$Long, TBtest$Lat, 
   TBtest$Lv3_Reef_Thin_Veneer, TBLv3RRThinV.predict))
names(out.predict.TBLv3RRThinV) <- c("X", "Y", "Lv3RRThinV.test", "Lv3RRThinV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/TB_Lv3RRThinV_prune.txt")
TBLv3RRThinV.prune 
sink()


############
# Mangrove #
############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        MGLv3RRThinV.fit1  <- cv.tree(MGLv3RRThinV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(MGLv3RRThinV.fit1)
        summary(MGLv3RRThinV.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        MGLv3RRThinV.prune <- prune.misclass(MGLv3RRThinV.tree, best = TreeSize) 
        plot(MGLv3RRThinV.prune); text(MGLv3RRThinV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(MGLv3RRThinV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


MGLv3RRThinV.prune <- prune.misclass(MGLv3RRThinV.tree, best = 12)         # choose best tree size and add value in!!!
plot(MGLv3RRThinV.prune); text(MGLv3RRThinV.prune,cex=0.8)
summary(MGLv3RRThinV.prune) # misclassification rate 6.4%

MGLv3RRThinV.predict <- predict(MGLv3RRThinV.prune, MGtest, type = c("vector"))
MGLv3RRThinV.predict <- as.data.frame(MGLv3RRThinV.predict [,2])
out.predict.MGLv3RRThinV <- as.data.frame(cbind(MGtest$Long, MGtest$Lat, 
   MGtest$Lv3_Reef_Thin_Veneer, MGLv3RRThinV.predict))
names(out.predict.MGLv3RRThinV) <- c("X", "Y", "Lv3RRThinV.test", "Lv3RRThinV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/MG_Lv3RRThinV_prune.txt")
MGLv3RRThinV.prune 
sink()



#################
# Southern Site #
################

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        SSLv3RRThinV.fit1  <- cv.tree(SSLv3RRThinV.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(SSLv3RRThinV.fit1)
        summary(SSLv3RRThinV.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        SSLv3RRThinV.prune <- prune.misclass(SSLv3RRThinV.tree, best = TreeSize) 
        plot(SSLv3RRThinV.prune); text(SSLv3RRThinV.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(SSLv3RRThinV.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


SSLv3RRThinV.prune <- prune.misclass(SSLv3RRThinV.tree, best = 6)         # choose best tree size and add value in!!!
plot(SSLv3RRThinV.prune); text(SSLv3RRThinV.prune,cex=0.8)
summary(SSLv3RRThinV.prune) # misclassification rate 2.3%

SSLv3RRThinV.predict <- predict(SSLv3RRThinV.prune, SStest, type = c("vector"))
SSLv3RRThinV.predict <- as.data.frame(SSLv3RRThinV.predict [,2])
out.predict.SSLv3RRThinV <- as.data.frame(cbind(SStest$Long, SStest$Lat, 
   SStest$Lv3_Reef_Thin_Veneer, SSLv3RRThinV.predict))
names(out.predict.SSLv3RRThinV) <- c("X", "Y", "Lv3RRThinV.test", "Lv3RRThinV.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/SS_Lv3RRThinV_prune.txt")
SSLv3RRThinV.prune 
sink()



############
# Predict ##
############


###########
# ALL SITES 
###########

Lv3RRThinV.rs.predict1 <- predict(Lv3RRThinV.prune, points1, type = c("vector"))
Lv3RRThinV.predict1 <- as.data.frame(Lv3RRThinV.rs.predict1[,2])
pred.Lv3RRThinV1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3RRThinV.predict1))
names(pred.Lv3RRThinV1) <- c("X","Y", "predLv3RRThinV")

Lv3RRThinV.rs.predict2 <- predict(Lv3RRThinV.prune, points2, type = c("vector"))
Lv3RRThinV.predict2 <- as.data.frame(Lv3RRThinV.rs.predict2[,2])
pred.Lv3RRThinV2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3RRThinV.predict2))
names(pred.Lv3RRThinV2) <- c("X","Y", "predLv3RRThinV")

Lv3RRThinV.rs.predict3 <- predict(Lv3RRThinV.prune, points3, type = c("vector"))
Lv3RRThinV.predict3 <- as.data.frame(Lv3RRThinV.rs.predict3[,2])
pred.Lv3RRThinV3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3RRThinV.predict3))
names(pred.Lv3RRThinV3) <- c("X","Y", "predLv3RRThinV")


#########################
## Helby Banks Predict ##
#########################

HB.Lv3RRThinV.rs.predict <- predict(HBLv3RRThinV.prune, HBpoints, type = c("vector"))
HB.Lv3RRThinV.predict <- as.data.frame(HB.Lv3RRThinV.rs.predict[,2])
predHB.Lv3RRThinV <- as.data.frame(cbind(HBpoints$Long, HBpoints$Lat,  HB.Lv3RRThinV.predict))
names(predHB.Lv3RRThinV) <- c("X","Y", "predLv3RRThinV")

#########################
## Tantabiddi Predict ##
#########################

TB.Lv3RRThinV.rs.predict <- predict(TBLv3RRThinV.prune, TBpoints, type = c("vector"))
TB.Lv3RRThinV.predict <- as.data.frame(TB.Lv3RRThinV.rs.predict[,2])
predTB.Lv3RRThinV <- as.data.frame(cbind(TBpoints$Long, TBpoints$Lat,  TB.Lv3RRThinV.predict))
names(predTB.Lv3RRThinV) <- c("X","Y", "predLv3RRThinV")

######################
## Mangrove Predict ##
######################

MG.Lv3RRThinV.rs.predict <- predict(MGLv3RRThinV.prune, MGpoints, type = c("vector"))
MG.Lv3RRThinV.predict <- as.data.frame(MG.Lv3RRThinV.rs.predict[,2])
predMG.Lv3RRThinV <- as.data.frame(cbind(MGpoints$Long, MGpoints$Lat,  MG.Lv3RRThinV.predict))
names(predMG.Lv3RRThinV) <- c("X","Y", "predLv3RRThinV")

###########################
## Southern Site Predict ##
###########################

SS.Lv3RRThinV.rs.predict <- predict(SSLv3RRThinV.prune, SSpoints, type = c("vector"))
SS.Lv3RRThinV.predict <- as.data.frame(SS.Lv3RRThinV.rs.predict[,2])
predSS.Lv3RRThinV <- as.data.frame(cbind(SSpoints$Long, SSpoints$Lat,  SS.Lv3RRThinV.predict))
names(predSS.Lv3RRThinV) <- c("X","Y", "predLv3RRThinV")


#####################
## Export to ASCII ##
#####################

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3RRThinV1) <- ~X+Y
ext <- extent(pred.Lv3RRThinV1)
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3RRThinV1, r, 'predLv3RRThinV')
writeRaster(to_ascii,'AllLv3RRTnV1.asc', format='ascii')

coordinates(pred.Lv3RRThinV2) <- ~X+Y
ext2 <- extent(pred.Lv3RRThinV2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3RRThinV2, r2, 'predLv3RRThinV')
writeRaster(to_ascii2,'AllLv3RRTnV2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3RRThinV3) <- ~X+Y
ext3 <- extent(pred.Lv3RRThinV3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3RRThinV3, r3, 'predLv3RRThinV')
writeRaster(to_ascii3,'AllLv3RRTnV_3.asc', format='ascii')

# Helby Banks
coordinates(predHB.Lv3RRThinV) <- ~X+Y
extHB <- extent(predHB.Lv3RRThinV)
rHB <- raster(ext=extHB,res=0.0000483000000031097)
to_asciiHB <- rasterize(predHB.Lv3RRThinV, rHB, 'predLv3RRThinV')
writeRaster(to_asciiHB,'HBLv3RRTnV.asc', format='ascii', overwrite = TRUE)

# Tantabiddi
coordinates(predTB.Lv3RRThinV) <- ~X+Y
extTB <- extent(predTB.Lv3RRThinV)
rTB <- raster(ext=extTB,res=0.0000483000000031097)
to_asciiTB <- rasterize(predTB.Lv3RRThinV, rTB, 'predLv3RRThinV')
writeRaster(to_asciiTB,'TBLv3RRTnV.asc', format='ascii')

# Mangrove
coordinates(predMG.Lv3RRThinV) <- ~X+Y
extMG <- extent(predMG.Lv3RRThinV)
rMG <- raster(ext=extMG,res=0.0000483000000031097)
to_asciiMG <- rasterize(predMG.Lv3RRThinV, rMG, 'predLv3RRThinV')
writeRaster(to_asciiMG,'MGLv3RRTnV.asc', format='ascii')

# Southern Site
coordinates(predSS.Lv3RRThinV) <- ~X+Y
extSS <- extent(predSS.Lv3RRThinV)
rSS <- raster(ext=extSS,res=0.00004500000005447)
to_asciiSS <- rasterize(predSS.Lv3RRThinV, rSS, 'predLv3RRThinV')
writeRaster(to_asciiSS,'SSLv3RRTnV.asc', format='ascii')


################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3RRThinV, "47_OutPredict_All_Lv3RRThinV_5m.csv")
write.csv(out.predict.HBLv3RRThinV, "72_OutPredict_HB_Lv3RRThinV_5m.csv")
write.csv(out.predict.TBLv3RRThinV, "73_OutPredict_TB_Lv3RRThinV_5m.csv")
write.csv(out.predict.MGLv3RRThinV, "48_OutPredict_MG_Lv3RRThinV_5m.csv")
write.csv(out.predict.SSLv3RRThinV, "49_OutPredict_SS_Lv3RRThinV_5m.csv")

```






```{r}

##############################
#### Level 3 - RHODOLITHS ####
##############################

Lv3Rhod.tree <- tree(as.factor(Lv3_Rhodoliths) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3Rhod.tree); text(Lv3Rhod.tree,cex=0.5)
summary(Lv3Rhod.tree)


# Select the best model variables
Lv3Rhod.tree <- tree(as.factor(Lv3_Rhodoliths) ~ range25 + BPI_B_250 + BPI_B_100 + mean3 + range10 + rugosity +
                       std25 + hyp10 + mean10 + mean25 + std10,
                        data=model, method = "class")

summary(Lv3Rhod.tree) # MISCLASSIFICATION RATE 0.26%


#################
## Helby Banks ##
#################


################
## Tantabiddi ##
################


##############
## Mangrove ##
##############


##################
# Southern Site ##
##################

SSLv3Rhod.tree <- tree(as.factor(Lv3_Rhodoliths) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= SSmodel, na.action = na.exclude, method = "class")
plot(SSLv3Rhod.tree); text(SSLv3Rhod.tree,cex=0.5)
summary(SSLv3Rhod.tree)

# Select the best model variables
SSLv3Rhod.tree <- tree(as.factor(Lv3_Rhodoliths) ~ BPI_B_250 + std25 + range25 + BPI_B_100 + Depth + BScatter 
                       + hyp10 + hyp25 + rugosity,
                        data=SSmodel, method = "class")

summary(SSLv3Rhod.tree) # MISCLASSIFICATION RATE 1.6%



########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3Rhod.fit1  <- cv.tree(Lv3Rhod.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3Rhod.fit1)
        summary(Lv3Rhod.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3Rhod.prune <- prune.misclass(Lv3Rhod.tree, best = TreeSize) 
        plot(Lv3Rhod.prune); text(Lv3Rhod.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3Rhod.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3Rhod.prune <- prune.misclass(Lv3Rhod.tree, best = 12)         # choose best tree size and add value in!!!
plot(Lv3Rhod.prune); text(Lv3Rhod.prune,cex=0.8)
summary(Lv3Rhod.prune) # 0.46% misclassification

Lv3Rhod.predict <- predict(Lv3Rhod.prune, test, type = c("vector"))
Lv3Rhod.predict <- as.data.frame(Lv3Rhod.predict [,2])
out.predict.Lv3Rhod <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Rhodoliths, Lv3Rhod.predict))
names(out.predict.Lv3Rhod) <- c("X", "Y", "Lv3Rhod.test", "Lv3Rhod.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3Rhod_prune.txt")
Lv3Rhod.prune 
sink()



###############
# Helby Banks #
###############


###############
# Tantabiddi #
###############


############
# Mangrove #
############



#################
# Southern Site #
################

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        SSLv3Rhod.fit1  <- cv.tree(SSLv3Rhod.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(SSLv3Rhod.fit1)
        summary(SSLv3Rhod.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        SSLv3Rhod.prune <- prune.misclass(SSLv3Rhod.tree, best = TreeSize) 
        plot(SSLv3Rhod.prune); text(SSLv3Rhod.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(SSLv3Rhod.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


SSLv3Rhod.prune <- prune.misclass(SSLv3Rhod.tree, best = 12)         # choose best tree size and add value in!!!
plot(SSLv3Rhod.prune); text(SSLv3Rhod.prune,cex=0.8)
summary(SSLv3Rhod.prune) # misclassification rate 2.3%

SSLv3Rhod.predict <- predict(SSLv3Rhod.prune, SStest, type = c("vector"))
SSLv3Rhod.predict <- as.data.frame(SSLv3Rhod.predict [,2])
out.predict.SSLv3Rhod <- as.data.frame(cbind(SStest$Long, SStest$Lat, 
   SStest$Lv3_Rhodoliths, SSLv3Rhod.predict))
names(out.predict.SSLv3Rhod) <- c("X", "Y", "Lv3Rhod.test", "Lv3Rhod.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/SS_Lv3Rhod_prune.txt")
SSLv3Rhod.prune 
sink()



############
# Predict ##
############


###########
# ALL SITES 
###########

Lv3Rhod.rs.predict1 <- predict(Lv3Rhod.prune, points1, type = c("vector"))
Lv3Rhod.predict1 <- as.data.frame(Lv3Rhod.rs.predict1[,2])
pred.Lv3Rhod1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3Rhod.predict1))
names(pred.Lv3Rhod1) <- c("X","Y", "predLv3Rhod")

Lv3Rhod.rs.predict2 <- predict(Lv3Rhod.prune, points2, type = c("vector"))
Lv3Rhod.predict2 <- as.data.frame(Lv3Rhod.rs.predict2[,2])
pred.Lv3Rhod2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3Rhod.predict2))
names(pred.Lv3Rhod2) <- c("X","Y", "predLv3Rhod")

Lv3Rhod.rs.predict3 <- predict(Lv3Rhod.prune, points3, type = c("vector"))
Lv3Rhod.predict3 <- as.data.frame(Lv3Rhod.rs.predict3[,2])
pred.Lv3Rhod3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3Rhod.predict3))
names(pred.Lv3Rhod3) <- c("X","Y", "predLv3Rhod")


#########################
## Helby Banks Predict ##
#########################

#########################
## Tantabiddi Predict ##
#########################


######################
## Mangrove Predict ##
######################


###########################
## Southern Site Predict ##
###########################

SS.Lv3Rhod.rs.predict <- predict(SSLv3Rhod.prune, SSpoints, type = c("vector"))
SS.Lv3Rhod.predict <- as.data.frame(SS.Lv3Rhod.rs.predict[,2])
predSS.Lv3Rhod <- as.data.frame(cbind(SSpoints$Long, SSpoints$Lat,  SS.Lv3Rhod.predict))
names(predSS.Lv3Rhod) <- c("X","Y", "predLv3Rhod")


#####################
## Export to ASCII ##
#####################

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3Rhod1) <- ~X+Y
ext <- extent(pred.Lv3Rhod1)
table(diff(pred.Lv3Rhod1@coords[,1]))
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3Rhod1, r, 'predLv3Rhod')
writeRaster(to_ascii,'AllLv3Rho1.asc', format='ascii')

coordinates(pred.Lv3Rhod2) <- ~X+Y
ext2 <- extent(pred.Lv3Rhod2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3Rhod2, r2, 'predLv3Rhod')
writeRaster(to_ascii2,'AllLv3Rho2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3Rhod3) <- ~X+Y
ext3 <- extent(pred.Lv3Rhod3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3Rhod3, r3, 'predLv3Rhod')
writeRaster(to_ascii3,'AllLv3Rho3.asc', format='ascii')


# Southern Site
coordinates(predSS.Lv3Rhod) <- ~X+Y
extSS <- extent(predSS.Lv3Rhod)
table(diff(predSS.Lv3Rhod@coords[,1]))
rSS <- raster(ext=extSS,res=0.00004500000005447)
to_asciiSS <- rasterize(predSS.Lv3Rhod, rSS, 'predLv3Rhod')
writeRaster(to_asciiSS,'SSLv3Rho.asc', format='ascii')


################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3Rhod, "50_OutPredict_All_Lv3Rhod_5m.csv")
write.csv(out.predict.SSLv3Rhod, "51_OutPredict_SS_Lv3Rhod_5m.csv")

```









```{r}

###############################################
#### Level 3 - RHODOLITHS WITH GRAVEL SAND ####
###############################################

Lv3_RhodGS.tree <- tree(as.factor(Lv3_Rhodoliths_with_Gravel_Sand) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3_RhodGS.tree); text(Lv3_RhodGS.tree,cex=0.5)
summary(Lv3_RhodGS.tree)


# Select the best model variables
Lv3_RhodGS.tree <- tree(as.factor(Lv3_Rhodoliths_with_Gravel_Sand) ~ range25 + BScatter + mean3 + mean25 + mean5 +
                          std25 + BPI_B_250 + hyp25  + BPI_B_50 + mean10 + BPI_B_100,
                        data=model, method = "class")

summary(Lv3_RhodGS.tree) # MISCLASSIFICATION RATE 1.0%


#################
## Helby Banks ##
#################


HBLv3_RhodGS.tree <- tree(as.factor(Lv3_Rhodoliths_with_Gravel_Sand) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= HBmodel, na.action = na.exclude, method = "claHB")
plot(HBLv3_RhodGS.tree); text(HBLv3_RhodGS.tree,cex=0.5)
summary(HBLv3_RhodGS.tree)

# Select the best model variables
HBLv3_RhodGS.tree <- tree(as.factor(Lv3_Rhodoliths_with_Gravel_Sand) ~ mean10 + mean3 + BScatter + std25 +
                            BPI_B_250 + range25 + std10,
                        data=HBmodel, method = "claHB")

summary(HBLv3_RhodGS.tree) # MISCLAHBIFICATION RATE 2.3%

##############
## Mangrove ##
##############



##################
# Southern Site ##
##################

SSLv3_RhodGS.tree <- tree(as.factor(Lv3_Rhodoliths_with_Gravel_Sand) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= SSmodel, na.action = na.exclude, method = "class")
plot(SSLv3_RhodGS.tree); text(SSLv3_RhodGS.tree,cex=0.5)
summary(SSLv3_RhodGS.tree)

# Select the best model variables
SSLv3_RhodGS.tree <- tree(as.factor(Lv3_Rhodoliths_with_Gravel_Sand) ~ range5 + Depth + BScatter + hyp25 + std10,
                        data=SSmodel, method = "class")

summary(SSLv3_RhodGS.tree) # MISCLASSIFICATION RATE 0.27%



########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3_RhodGS.fit1  <- cv.tree(Lv3_RhodGS.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3_RhodGS.fit1)
        summary(Lv3_RhodGS.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3_RhodGS.prune <- prune.misclass(Lv3_RhodGS.tree, best = TreeSize) 
        plot(Lv3_RhodGS.prune); text(Lv3_RhodGS.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3_RhodGS.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3_RhodGS.prune <- prune.misclass(Lv3_RhodGS.tree, best = 10)         # choose best tree size and add value in!!!
plot(Lv3_RhodGS.prune); text(Lv3_RhodGS.prune,cex=0.8)
summary(Lv3_RhodGS.prune) # 2.0% misclassification

Lv3_RhodGS.predict <- predict(Lv3_RhodGS.prune, test, type = c("vector"))
Lv3_RhodGS.predict <- as.data.frame(Lv3_RhodGS.predict [,2])
out.predict.Lv3_RhodGS <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Rhodoliths_with_Gravel_Sand, Lv3_RhodGS.predict))
names(out.predict.Lv3_RhodGS) <- c("X", "Y", "Lv3_RhodGS.test", "Lv3_RhodGS.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3_RhodGS_prune.txt")
Lv3_RhodGS.prune 
sink()



###############
# Helby Banks #
###############


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats croHB validation proceHB to create 4 graphs of miscalHBification
        HBLv3_RhodGS.fit1  <- cv.tree(HBLv3_RhodGS.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(HBLv3_RhodGS.fit1)
        summary(HBLv3_RhodGS.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 4   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune proceHB to create 4 graphsof miscalHBification
        HBLv3_RhodGS.prune <- prune.misclass(HBLv3_RhodGS.tree, best = TreeSize) 
        plot(HBLv3_RhodGS.prune); text(HBLv3_RhodGS.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(HBLv3_RhodGS.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


HBLv3_RhodGS.prune <- prune.misclass(HBLv3_RhodGS.tree, best = 8)         # choose best tree size and add value in!!!
plot(HBLv3_RhodGS.prune); text(HBLv3_RhodGS.prune,cex=0.8)
summary(HBLv3_RhodGS.prune) # misclaHBification rate 2.3%

HBLv3_RhodGS.predict <- predict(HBLv3_RhodGS.prune, HBtest, type = c("vector"))
HBLv3_RhodGS.predict <- as.data.frame(HBLv3_RhodGS.predict [,2])
out.predict.HBLv3_RhodGS <- as.data.frame(cbind(HBtest$Long, HBtest$Lat, 
   HBtest$Lv3_Rhodoliths_with_Gravel_Sand, HBLv3_RhodGS.predict))
names(out.predict.HBLv3_RhodGS) <- c("X", "Y", "Lv3_RhodGS.test", "Lv3_RhodGS.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/HB_Lv3_RhodGS_prune.txt")
HBLv3_RhodGS.prune 
sink()



#################
# Southern Site #
################

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        SSLv3_RhodGS.fit1  <- cv.tree(SSLv3_RhodGS.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(SSLv3_RhodGS.fit1)
        summary(SSLv3_RhodGS.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        SSLv3_RhodGS.prune <- prune.misclass(SSLv3_RhodGS.tree, best = TreeSize) 
        plot(SSLv3_RhodGS.prune); text(SSLv3_RhodGS.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(SSLv3_RhodGS.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


SSLv3_RhodGS.prune <- prune.misclass(SSLv3_RhodGS.tree, best = 6)         # choose best tree size and add value in!!!
plot(SSLv3_RhodGS.prune); text(SSLv3_RhodGS.prune,cex=0.8)
summary(SSLv3_RhodGS.prune) # misclassification rate 0.27%

SSLv3_RhodGS.predict <- predict(SSLv3_RhodGS.prune, SStest, type = c("vector"))
SSLv3_RhodGS.predict <- as.data.frame(SSLv3_RhodGS.predict [,2])
out.predict.SSLv3_RhodGS <- as.data.frame(cbind(SStest$Long, SStest$Lat, 
   SStest$Lv3_Rhodoliths_with_Gravel_Sand, SSLv3_RhodGS.predict))
names(out.predict.SSLv3_RhodGS) <- c("X", "Y", "Lv3_RhodGS.test", "Lv3_RhodGS.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/SS_Lv3_RhodGS_prune.txt")
SSLv3_RhodGS.prune 
sink()



############
# Predict ##
############


###########
# ALL SITES 
###########

Lv3_RhodGS.rs.predict1 <- predict(Lv3_RhodGS.prune, points1, type = c("vector"))
Lv3_RhodGS.predict1 <- as.data.frame(Lv3_RhodGS.rs.predict1[,2])
pred.Lv3_RhodGS1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3_RhodGS.predict1))
names(pred.Lv3_RhodGS1) <- c("X","Y", "predLv3_RhodGS")

Lv3_RhodGS.rs.predict2 <- predict(Lv3_RhodGS.prune, points2, type = c("vector"))
Lv3_RhodGS.predict2 <- as.data.frame(Lv3_RhodGS.rs.predict2[,2])
pred.Lv3_RhodGS2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3_RhodGS.predict2))
names(pred.Lv3_RhodGS2) <- c("X","Y", "predLv3_RhodGS")

Lv3_RhodGS.rs.predict3 <- predict(Lv3_RhodGS.prune, points3, type = c("vector"))
Lv3_RhodGS.predict3 <- as.data.frame(Lv3_RhodGS.rs.predict3[,2])
pred.Lv3_RhodGS3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3_RhodGS.predict3))
names(pred.Lv3_RhodGS3) <- c("X","Y", "predLv3_RhodGS")


#########################
## Helby Banks Predict ##
#########################


HB.Lv3_RhodGS.rs.predict <- predict(HBLv3_RhodGS.prune, HBpoints, type = c("vector"))
HB.Lv3_RhodGS.predict <- as.data.frame(HB.Lv3_RhodGS.rs.predict[,2])
predHB.Lv3_RhodGS <- as.data.frame(cbind(HBpoints$Long, HBpoints$Lat,  HB.Lv3_RhodGS.predict))
names(predHB.Lv3_RhodGS) <- c("X","Y", "predLv3_RhodGS")


###########################
## Southern Site Predict ##
###########################

SS.Lv3_RhodGS.rs.predict <- predict(SSLv3_RhodGS.prune, SSpoints, type = c("vector"))
SS.Lv3_RhodGS.predict <- as.data.frame(SS.Lv3_RhodGS.rs.predict[,2])
predSS.Lv3_RhodGS <- as.data.frame(cbind(SSpoints$Long, SSpoints$Lat,  SS.Lv3_RhodGS.predict))
names(predSS.Lv3_RhodGS) <- c("X","Y", "predLv3_RhodGS")


#####################
## Export to ASCII ##
#####################

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3_RhodGS1) <- ~X+Y
ext <- extent(pred.Lv3_RhodGS1)
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3_RhodGS1, r, 'predLv3_RhodGS')
writeRaster(to_ascii,'AllLv3_RhoGS1.asc', format='ascii')

coordinates(pred.Lv3_RhodGS2) <- ~X+Y
ext2 <- extent(pred.Lv3_RhodGS2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3_RhodGS2, r2, 'predLv3_RhodGS')
writeRaster(to_ascii2,'AllLv3_RhoGS2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3_RhodGS3) <- ~X+Y
ext3 <- extent(pred.Lv3_RhodGS3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3_RhodGS3, r3, 'predLv3_RhodGS')
writeRaster(to_ascii3,'AllLv3_RhoGS3.asc', format='ascii')

# Helby Banks
coordinates(predHB.Lv3_RhodGS) <- ~X+Y
extHB <- extent(predHB.Lv3_RhodGS)
rHB <- raster(ext=extHB,res=0.0000483000000031097)
to_asciiHB <- rasterize(predHB.Lv3_RhodGS, rHB, 'predLv3_RhodGS')
writeRaster(to_asciiHB,'HBLv3_RhoGS.asc', format='ascii')


# Southern Site
coordinates(predSS.Lv3_RhodGS) <- ~X+Y
extSS <- extent(predSS.Lv3_RhodGS)
rSS <- raster(ext=extSS,res=0.00004500000005447)
to_asciiSS <- rasterize(predSS.Lv3_RhodGS, rSS, 'predLv3_RhodGS')
writeRaster(to_asciiSS,'SSLv3_RhoGS.asc', format='ascii')


################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3_RhodGS, "52_OutPredict_All_Lv3_RhodGS_5m.csv")
write.csv(out.predict.HBLv3_RhodGS, "53_OutPredict_HB_Lv3_RhodGS_5m.csv")
write.csv(out.predict.SSLv3_RhodGS, "55_OutPredict_SS_Lv3_RhodGS_5m.csv")

```












```{r}

########################
#### Level 3 - SAND ####
########################

Lv3Sand.tree <- tree(as.factor(Lv3_Sand) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3Sand.tree); text(Lv3Sand.tree,cex=0.5)
summary(Lv3Sand.tree)


# Select the best model variables
Lv3Sand.tree <- tree(as.factor(Lv3_Sand) ~ BScatter +std5 + std25 + BPI_B_250 + mean25 + range5,
                        data=model, method = "class")

summary(Lv3Sand.tree) # MISCLASSIFICATION RATE 10.5%


#################
## Helby Banks ##
#################

HBLv3Sand.tree <- tree(as.factor(Lv3_Sand) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= HBmodel, na.action = na.exclude, method = "class")
plot(HBLv3Sand.tree); text(HBLv3Sand.tree,cex=0.5)
summary(HBLv3Sand.tree)

# Select the best model variables
HBLv3Sand.tree <- tree(as.factor(Lv3_Sand) ~ BScatter + mean10 + range25 + range3 + std10 + Depth + mean5 +
                         BPI_B_50 + BPI_B_250 + mean3 + mean25,
                        data=HBmodel, method = "class")

summary(HBLv3Sand.tree) # MISCLAHBIFICATION RATE 1.6%


################
## Tantabiddi ##
################

TBLv3Sand.tree <- tree(as.factor(Lv3_Sand) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= TBmodel, na.action = na.exclude, method = "class")
plot(TBLv3Sand.tree); text(TBLv3Sand.tree,cex=0.5)
summary(TBLv3Sand.tree)

# Select the best model variables
TBLv3Sand.tree <- tree(as.factor(Lv3_Sand) ~ BScatter + BPI_B_250 + std5 + std25 + Depth + mean25 + BPI_B_100 + 
                         range10 + hyp25 + std10 + range25,
                        data=TBmodel, method = "class")

summary(TBLv3Sand.tree) # MISCLATBIFICATION RATE 9.0%

##############
## Mangrove ##
##############

MGLv3Sand.tree <- tree(as.factor(Lv3_Sand) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= MGmodel, na.action = na.exclude, method = "class")
plot(MGLv3Sand.tree); text(MGLv3Sand.tree,cex=0.5)
summary(MGLv3Sand.tree)

# Select the best model variables
MGLv3Sand.tree <- tree(as.factor(Lv3_Sand) ~ Depth + std25 + std10 + range10 + mean3 + BPI_B_50,
                        data=MGmodel, method = "class")

summary(MGLv3Sand.tree) # MISCLAMGIFICATION RATE 1.4%


##################
# Southern Site ##
##################

SSLv3Sand.tree <- tree(as.factor(Lv3_Sand) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= SSmodel, na.action = na.exclude, method = "class")
plot(SSLv3Sand.tree); text(SSLv3Sand.tree,cex=0.5)
summary(SSLv3Sand.tree)

# Select the best model variables
SSLv3Sand.tree <- tree(as.factor(Lv3_Sand) ~ rugosity + Depth,
                        data=SSmodel, method = "class")

summary(SSLv3Sand.tree) # MISCLASSIFICATION RATE 0.18%



########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3Sand.fit1  <- cv.tree(Lv3Sand.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3Sand.fit1)
        summary(Lv3Sand.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 4    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3Sand.prune <- prune.misclass(Lv3Sand.tree, best = TreeSize) 
        plot(Lv3Sand.prune); text(Lv3Sand.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3Sand.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3Sand.prune <- prune.misclass(Lv3Sand.tree, best = 4)         # choose best tree size and add value in!!!
plot(Lv3Sand.prune); text(Lv3Sand.prune,cex=0.8)
summary(Lv3Sand.prune) # 10.5% misclassification

Lv3Sand.predict <- predict(Lv3Sand.prune, test, type = c("vector"))
Lv3Sand.predict <- as.data.frame(Lv3Sand.predict [,2])
out.predict.Lv3Sand <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Sand, Lv3Sand.predict))
names(out.predict.Lv3Sand) <- c("X", "Y", "Lv3Sand.test", "Lv3Sand.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3Sand_prune.txt")
Lv3Sand.prune 
sink()



###############
# Helby Banks #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats croHB validation proceHB to create 4 graphs of miscalHBification
        HBLv3Sand.fit1  <- cv.tree(HBLv3Sand.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(HBLv3Sand.fit1)
        summary(HBLv3Sand.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune proceHB to create 4 graphsof miscalHBification
        HBLv3Sand.prune <- prune.misclass(HBLv3Sand.tree, best = TreeSize) 
        plot(HBLv3Sand.prune); text(HBLv3Sand.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(HBLv3Sand.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


HBLv3Sand.prune <- prune.misclass(HBLv3Sand.tree, best = 10)         # choose best tree size and add value in!!!
plot(HBLv3Sand.prune); text(HBLv3Sand.prune,cex=0.8)
summary(HBLv3Sand.prune) # misclaHBification rate 1.7%

HBLv3Sand.predict <- predict(HBLv3Sand.prune, HBtest, type = c("vector"))
HBLv3Sand.predict <- as.data.frame(HBLv3Sand.predict [,2])
out.predict.HBLv3Sand <- as.data.frame(cbind(HBtest$Long, HBtest$Lat, 
   HBtest$Lv3_Sand, HBLv3Sand.predict))
names(out.predict.HBLv3Sand) <- c("X", "Y", "Lv3Sand.test", "Lv3Sand.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/HB_Lv3Sand_prune.txt")
HBLv3Sand.prune 
sink()

###############
# Tantabiddi #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats croTB validation proceTB to create 4 graphs of miscalTBification
        TBLv3Sand.fit1  <- cv.tree(TBLv3Sand.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(TBLv3Sand.fit1)
        summary(TBLv3Sand.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune proceTB to create 4 graphsof miscalTBification
        TBLv3Sand.prune <- prune.misclass(TBLv3Sand.tree, best = TreeSize) 
        plot(TBLv3Sand.prune); text(TBLv3Sand.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(TBLv3Sand.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


TBLv3Sand.prune <- prune.misclass(TBLv3Sand.tree, best = 10)         # choose best tree size and add value in!!!
plot(TBLv3Sand.prune); text(TBLv3Sand.prune,cex=0.8)
summary(TBLv3Sand.prune) # misclaTBification rate 12.7%

TBLv3Sand.predict <- predict(TBLv3Sand.prune, TBtest, type = c("vector"))
TBLv3Sand.predict <- as.data.frame(TBLv3Sand.predict [,2])
out.predict.TBLv3Sand <- as.data.frame(cbind(TBtest$Long, TBtest$Lat, 
   TBtest$Lv3_Sand, TBLv3Sand.predict))
names(out.predict.TBLv3Sand) <- c("X", "Y", "Lv3Sand.test", "Lv3Sand.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/TB_Lv3Sand_prune.txt")
TBLv3Sand.prune 
sink()


############
# Mangrove #
############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats croMG validation proceMG to create 4 graphs of miscalMGification
        MGLv3Sand.fit1  <- cv.tree(MGLv3Sand.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(MGLv3Sand.fit1)
        summary(MGLv3Sand.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune proceMG to create 4 graphsof miscalMGification
        MGLv3Sand.prune <- prune.misclass(MGLv3Sand.tree, best = TreeSize) 
        plot(MGLv3Sand.prune); text(MGLv3Sand.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(MGLv3Sand.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


MGLv3Sand.prune <- prune.misclass(MGLv3Sand.tree, best = 6)         # choose best tree size and add value in!!!
plot(MGLv3Sand.prune); text(MGLv3Sand.prune,cex=0.8)
summary(MGLv3Sand.prune) # misclaMGification rate 6.7%

MGLv3Sand.predict <- predict(MGLv3Sand.prune, MGtest, type = c("vector"))
MGLv3Sand.predict <- as.data.frame(MGLv3Sand.predict [,2])
out.predict.MGLv3Sand <- as.data.frame(cbind(MGtest$Long, MGtest$Lat, 
   MGtest$Lv3_Sand, MGLv3Sand.predict))
names(out.predict.MGLv3Sand) <- c("X", "Y", "Lv3Sand.test", "Lv3Sand.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/MG_Lv3Sand_prune.txt")
MGLv3Sand.prune 
sink()

#################
# Southern Site #
################

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        SSLv3Sand.fit1  <- cv.tree(SSLv3Sand.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(SSLv3Sand.fit1)
        summary(SSLv3Sand.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        SSLv3Sand.prune <- prune.misclass(SSLv3Sand.tree, best = TreeSize) 
        plot(SSLv3Sand.prune); text(SSLv3Sand.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(SSLv3Sand.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


SSLv3Sand.prune <- prune.misclass(SSLv3Sand.tree, best = 2)         # choose best tree size and add value in!!!
plot(SSLv3Sand.prune); text(SSLv3Sand.prune,cex=0.8)
summary(SSLv3Sand.prune) # misclassification rate 0.18%

SSLv3Sand.predict <- predict(SSLv3Sand.prune, SStest, type = c("vector"))
SSLv3Sand.predict <- as.data.frame(SSLv3Sand.predict [,2])
out.predict.SSLv3Sand <- as.data.frame(cbind(SStest$Long, SStest$Lat, 
   SStest$Lv3_Sand, SSLv3Sand.predict))
names(out.predict.SSLv3Sand) <- c("X", "Y", "Lv3Sand.test", "Lv3Sand.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/SS_Lv3Sand_prune.txt")
SSLv3Sand.prune 
sink()



############
# Predict ##
############


###########
# ALL SITES 
###########

Lv3Sand.rs.predict1 <- predict(Lv3Sand.prune, points1, type = c("vector"))
Lv3Sand.predict1 <- as.data.frame(Lv3Sand.rs.predict1[,2])
pred.Lv3Sand1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3Sand.predict1))
names(pred.Lv3Sand1) <- c("X","Y", "predLv3Sand")

Lv3Sand.rs.predict2 <- predict(Lv3Sand.prune, points2, type = c("vector"))
Lv3Sand.predict2 <- as.data.frame(Lv3Sand.rs.predict2[,2])
pred.Lv3Sand2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3Sand.predict2))
names(pred.Lv3Sand2) <- c("X","Y", "predLv3Sand")

Lv3Sand.rs.predict3 <- predict(Lv3Sand.prune, points3, type = c("vector"))
Lv3Sand.predict3 <- as.data.frame(Lv3Sand.rs.predict3[,2])
pred.Lv3Sand3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3Sand.predict3))
names(pred.Lv3Sand3) <- c("X","Y", "predLv3Sand")


#########################
## Helby Banks Predict ##
#########################

HB.Lv3Sand.rs.predict <- predict(HBLv3Sand.prune, HBpoints, type = c("vector"))
HB.Lv3Sand.predict <- as.data.frame(HB.Lv3Sand.rs.predict[,2])
predHB.Lv3Sand <- as.data.frame(cbind(HBpoints$Long, HBpoints$Lat,  HB.Lv3Sand.predict))
names(predHB.Lv3Sand) <- c("X","Y", "predLv3Sand")

#########################
## Tantabiddi Predict ##
#########################

TB.Lv3Sand.rs.predict <- predict(TBLv3Sand.prune, TBpoints, type = c("vector"))
TB.Lv3Sand.predict <- as.data.frame(TB.Lv3Sand.rs.predict[,2])
predTB.Lv3Sand <- as.data.frame(cbind(TBpoints$Long, TBpoints$Lat,  TB.Lv3Sand.predict))
names(predTB.Lv3Sand) <- c("X","Y", "predLv3Sand")

######################
## Mangrove Predict ##
######################

MG.Lv3Sand.rs.predict <- predict(MGLv3Sand.prune, MGpoints, type = c("vector"))
MG.Lv3Sand.predict <- as.data.frame(MG.Lv3Sand.rs.predict[,2])
predMG.Lv3Sand <- as.data.frame(cbind(MGpoints$Long, MGpoints$Lat,  MG.Lv3Sand.predict))
names(predMG.Lv3Sand) <- c("X","Y", "predLv3Sand")


###########################
## Southern Site Predict ##
###########################

SS.Lv3Sand.rs.predict <- predict(SSLv3Sand.prune, SSpoints, type = c("vector"))
SS.Lv3Sand.predict <- as.data.frame(SS.Lv3Sand.rs.predict[,2])
predSS.Lv3Sand <- as.data.frame(cbind(SSpoints$Long, SSpoints$Lat,  SS.Lv3Sand.predict))
names(predSS.Lv3Sand) <- c("X","Y", "predLv3Sand")


#####################
## Export to ASCII ##
#####################

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3Sand1) <- ~X+Y
ext <- extent(pred.Lv3Sand1)
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3Sand1, r, 'predLv3Sand')
writeRaster(to_ascii,'AllLv3Sand1.asc', format='ascii')

coordinates(pred.Lv3Sand2) <- ~X+Y
ext2 <- extent(pred.Lv3Sand2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3Sand2, r2, 'predLv3Sand')
writeRaster(to_ascii2,'AllLv3Sand2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3Sand3) <- ~X+Y
ext3 <- extent(pred.Lv3Sand3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3Sand3, r3, 'predLv3Sand')
writeRaster(to_ascii3,'AllLv3Sand3.asc', format='ascii')

# Helby Banks
coordinates(predHB.Lv3Sand) <- ~X+Y
extHB <- extent(predHB.Lv3Sand)
rHB <- raster(ext=extHB,res=0.0000483000000031097)
to_asciiHB <- rasterize(predHB.Lv3Sand, rHB, 'predLv3Sand')
writeRaster(to_asciiHB,'HBLv3Sand.asc', format='ascii')


# Tantabiddi
coordinates(predTB.Lv3Sand) <- ~X+Y
extTB <- extent(predTB.Lv3Sand)
rTB <- raster(ext=extTB,res=0.0000483000000031097)
to_asciiTB <- rasterize(predTB.Lv3Sand, rTB, 'predLv3Sand')
writeRaster(to_asciiTB,'TBLv3Sand.asc', format='ascii')

# Mangrove
coordinates(predMG.Lv3Sand) <- ~X+Y
extMG <- extent(predMG.Lv3Sand)
table(diff(predMG.Lv3Sand@coords[,1]))
rMG <- raster(ext=extMG,res=0.0000483000000031097)
to_asciiMG <- rasterize(predMG.Lv3Sand, rMG, 'predLv3Sand')
writeRaster(to_asciiMG,'MGLv3Sand.asc', format='ascii')


# Southern Site
coordinates(predSS.Lv3Sand) <- ~X+Y
extSS <- extent(predSS.Lv3Sand)
rSS <- raster(ext=extSS,res=0.00004500000005447)
to_asciiSS <- rasterize(predSS.Lv3Sand, rSS, 'predLv3Sand')
writeRaster(to_asciiSS,'SSLv3Sand.asc', format='ascii')


################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3Sand, "56_OutPredict_All_Lv3Sand_5m.csv")
write.csv(out.predict.HBLv3Sand, "57_OutPredict_HB_Lv3Sand_5m.csv")
write.csv(out.predict.TBLv3Sand, "58_OutPredict_TB_Lv3Sand_5m.csv")
write.csv(out.predict.MGLv3Sand, "74_OutPredict_MG_Lv3Sand_5m.csv")
write.csv(out.predict.SSLv3Sand, "59_OutPredict_SS_Lv3Sand_5m.csv")

```











```{r}

####################################
#### Level 3 - SAND AND PEBBLES ####
###################################


Lv3SndPeb.tree <- tree(as.factor(Lv3_Sand_and_Pebbles) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3SndPeb.tree); text(Lv3SndPeb.tree,cex=0.5)
summary(Lv3SndPeb.tree)


# Select the best model variables
Lv3SndPeb.tree <- tree(as.factor(Lv3_Sand_and_Pebbles) ~ Depth + std5 + mean25 + std25 + range25 + + BPI_B_100 +
                         mean10 + hyp25 + std10 + BPI_B_50,
                        data=model, method = "class")

summary(Lv3SndPeb.tree) # MISCLASSIFICATION RATE 5.6%


#################
## Helby Banks ##
#################

HBLv3SndPeb.tree <- tree(as.factor(Lv3_Sand_and_Pebbles) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= HBmodel, na.action = na.exclude, method = "class")
plot(HBLv3SndPeb.tree); text(HBLv3SndPeb.tree,cex=0.5)
summary(HBLv3SndPeb.tree)

# Select the best model variables
HBLv3SndPeb.tree <- tree(as.factor(Lv3_Sand_and_Pebbles) ~ mean3 + mean25 + range25 + BPI_B_100 + range5 + BScatter +
                           hyp10 + BPI_B_250 + std5 + mean10 + std10 + hyp25 + range10 + BPI_B_50 + std25,
                        data=HBmodel, method = "class")

summary(HBLv3SndPeb.tree) # MISCLAssIFICATION RATE 2.2%


################
## Tantabiddi ##
################

TBLv3SndPeb.tree <- tree(as.factor(Lv3_Sand_and_Pebbles) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= TBmodel, na.action = na.exclude, method = "class")
plot(TBLv3SndPeb.tree); text(TBLv3SndPeb.tree,cex=0.5)
summary(TBLv3SndPeb.tree)

# Select the best model variables
TBLv3SndPeb.tree <- tree(as.factor(Lv3_Sand_and_Pebbles) ~ std25 + Depth + std5 + curv_plan + std10 +
                           range5 + mean25 + hyp25 + BPI_B_250 + range10,
                        data=TBmodel, method = "class")

summary(TBLv3SndPeb.tree) # MISCLATBIFICATION RATE 0.8%

##############
## Mangrove ##
##############

MGLv3SndPeb.tree <- tree(as.factor(Lv3_Sand_and_Pebbles) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= MGmodel, na.action = na.exclude, method = "class")
plot(MGLv3SndPeb.tree); text(MGLv3SndPeb.tree,cex=0.5)
summary(MGLv3SndPeb.tree)

# Select the best model variables
MGLv3SndPeb.tree <- tree(as.factor(Lv3_Sand_and_Pebbles) ~ mean25 + BPI_B_100 + BPI_B_250 + range25 + Depth + hyp25 +
                           std10 + curv_plan + curv + range10,
                        data=MGmodel, method = "class")

summary(MGLv3SndPeb.tree) # MISCLAMGIFICATION RATE 0.51%


##################
# Southern Site ##
##################

SSLv3SndPeb.tree <- tree(as.factor(Lv3_Sand_and_Pebbles) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= SSmodel, na.action = na.exclude, method = "class")
plot(SSLv3SndPeb.tree); text(SSLv3SndPeb.tree,cex=0.5)
summary(SSLv3SndPeb.tree)

# Select the best model variables
SSLv3SndPeb.tree <- tree(as.factor(Lv3_Sand_and_Pebbles) ~ range10 + mean10 + BScatter,
                        data=SSmodel, method = "class")

summary(SSLv3SndPeb.tree) # MISCLASSIFICATION RATE 0.09%



########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3SndPeb.fit1  <- cv.tree(Lv3SndPeb.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3SndPeb.fit1)
        summary(Lv3SndPeb.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 4    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3SndPeb.prune <- prune.misclass(Lv3SndPeb.tree, best = TreeSize) 
        plot(Lv3SndPeb.prune); text(Lv3SndPeb.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3SndPeb.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3SndPeb.prune <- prune.misclass(Lv3SndPeb.tree, best = 10)         # choose best tree size and add value in!!!
plot(Lv3SndPeb.prune); text(Lv3SndPeb.prune,cex=0.8)
summary(Lv3SndPeb.prune) # 5.8% misclassification

Lv3SndPeb.predict <- predict(Lv3SndPeb.prune, test, type = c("vector"))
Lv3SndPeb.predict <- as.data.frame(Lv3SndPeb.predict [,2])
out.predict.Lv3SndPeb <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Sand_and_Pebbles, Lv3SndPeb.predict))
names(out.predict.Lv3SndPeb) <- c("X", "Y", "Lv3SndPeb.test", "Lv3SndPeb.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3SndPeb_prune.txt")
Lv3SndPeb.prune 
sink()



###############
# Helby Banks #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats croHB validation proceHB to create 4 graphs of miscalHBification
        HBLv3SndPeb.fit1  <- cv.tree(HBLv3SndPeb.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(HBLv3SndPeb.fit1)
        summary(HBLv3SndPeb.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 10   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune proceHB to create 4 graphsof miscalHBification
        HBLv3SndPeb.prune <- prune.misclass(HBLv3SndPeb.tree, best = TreeSize) 
        plot(HBLv3SndPeb.prune); text(HBLv3SndPeb.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(HBLv3SndPeb.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


HBLv3SndPeb.prune <- prune.misclass(HBLv3SndPeb.tree, best = 14)         # choose best tree size and add value in!!!
plot(HBLv3SndPeb.prune); text(HBLv3SndPeb.prune,cex=0.8)
summary(HBLv3SndPeb.prune) # misclaHBification rate 5.3%

HBLv3SndPeb.predict <- predict(HBLv3SndPeb.prune, HBtest, type = c("vector"))
HBLv3SndPeb.predict <- as.data.frame(HBLv3SndPeb.predict [,2])
out.predict.HBLv3SndPeb <- as.data.frame(cbind(HBtest$Long, HBtest$Lat, 
   HBtest$Lv3_Sand_and_Pebbles, HBLv3SndPeb.predict))
names(out.predict.HBLv3SndPeb) <- c("X", "Y", "Lv3SndPeb.test", "Lv3SndPeb.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/HB_Lv3SndPeb_prune.txt")
HBLv3SndPeb.prune 
sink()

###############
# Tantabiddi #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats croTB validation proceTB to create 4 graphs of miscalTBification
        TBLv3SndPeb.fit1  <- cv.tree(TBLv3SndPeb.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(TBLv3SndPeb.fit1)
        summary(TBLv3SndPeb.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune proceTB to create 4 graphsof miscalTBification
        TBLv3SndPeb.prune <- prune.misclass(TBLv3SndPeb.tree, best = TreeSize) 
        plot(TBLv3SndPeb.prune); text(TBLv3SndPeb.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(TBLv3SndPeb.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


TBLv3SndPeb.prune <- prune.misclass(TBLv3SndPeb.tree, best = 12)         # choose best tree size and add value in!!!
plot(TBLv3SndPeb.prune); text(TBLv3SndPeb.prune,cex=0.8)
summary(TBLv3SndPeb.prune) # misclaTBification rate 1.5%

TBLv3SndPeb.predict <- predict(TBLv3SndPeb.prune, TBtest, type = c("vector"))
TBLv3SndPeb.predict <- as.data.frame(TBLv3SndPeb.predict [,2])
out.predict.TBLv3SndPeb <- as.data.frame(cbind(TBtest$Long, TBtest$Lat, 
   TBtest$Lv3_Sand_and_Pebbles, TBLv3SndPeb.predict))
names(out.predict.TBLv3SndPeb) <- c("X", "Y", "Lv3SndPeb.test", "Lv3SndPeb.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/TB_Lv3SndPeb_prune.txt")
TBLv3SndPeb.prune 
sink()


############
# Mangrove #
############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats croMG validation proceMG to create 4 graphs of miscalMGification
        MGLv3SndPeb.fit1  <- cv.tree(MGLv3SndPeb.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(MGLv3SndPeb.fit1)
        summary(MGLv3SndPeb.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune proceMG to create 4 graphsof miscalMGification
        MGLv3SndPeb.prune <- prune.misclass(MGLv3SndPeb.tree, best = TreeSize) 
        plot(MGLv3SndPeb.prune); text(MGLv3SndPeb.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(MGLv3SndPeb.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


MGLv3SndPeb.prune <- prune.misclass(MGLv3SndPeb.tree, best = 10)         # choose best tree size and add value in!!!
plot(MGLv3SndPeb.prune); text(MGLv3SndPeb.prune,cex=0.8)
summary(MGLv3SndPeb.prune) # misclaMGification rate 0.38%

MGLv3SndPeb.predict <- predict(MGLv3SndPeb.prune, MGtest, type = c("vector"))
MGLv3SndPeb.predict <- as.data.frame(MGLv3SndPeb.predict [,2])
out.predict.MGLv3SndPeb <- as.data.frame(cbind(MGtest$Long, MGtest$Lat, 
   MGtest$Lv3_Sand_and_Pebbles, MGLv3SndPeb.predict))
names(out.predict.MGLv3SndPeb) <- c("X", "Y", "Lv3SndPeb.test", "Lv3SndPeb.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/MG_Lv3SndPeb_prune.txt")
MGLv3SndPeb.prune 
sink()

#################
# Southern Site #
################

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        SSLv3SndPeb.fit1  <- cv.tree(SSLv3SndPeb.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(SSLv3SndPeb.fit1)
        summary(SSLv3SndPeb.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        SSLv3SndPeb.prune <- prune.misclass(SSLv3SndPeb.tree, best = TreeSize) 
        plot(SSLv3SndPeb.prune); text(SSLv3SndPeb.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(SSLv3SndPeb.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


SSLv3SndPeb.prune <- prune.misclass(SSLv3SndPeb.tree, best = 4)         # choose best tree size and add value in!!!
plot(SSLv3SndPeb.prune); text(SSLv3SndPeb.prune,cex=0.8)
summary(SSLv3SndPeb.prune) # misclassification rate 3.9%

SSLv3SndPeb.predict <- predict(SSLv3SndPeb.prune, SStest, type = c("vector"))
SSLv3SndPeb.predict <- as.data.frame(SSLv3SndPeb.predict [,2])
out.predict.SSLv3SndPeb <- as.data.frame(cbind(SStest$Long, SStest$Lat, 
   SStest$Lv3_Sand_and_Pebbles, SSLv3SndPeb.predict))
names(out.predict.SSLv3SndPeb) <- c("X", "Y", "Lv3SndPeb.test", "Lv3SndPeb.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/SS_Lv3SndPeb_prune.txt")
SSLv3SndPeb.prune 
sink()



############
# Predict ##
############


###########
# ALL SITES 
###########

Lv3SndPeb.rs.predict1 <- predict(Lv3SndPeb.prune, points1, type = c("vector"))
Lv3SndPeb.predict1 <- as.data.frame(Lv3SndPeb.rs.predict1[,2])
pred.Lv3SndPeb1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3SndPeb.predict1))
names(pred.Lv3SndPeb1) <- c("X","Y", "predLv3SndPeb")

Lv3SndPeb.rs.predict2 <- predict(Lv3SndPeb.prune, points2, type = c("vector"))
Lv3SndPeb.predict2 <- as.data.frame(Lv3SndPeb.rs.predict2[,2])
pred.Lv3SndPeb2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3SndPeb.predict2))
names(pred.Lv3SndPeb2) <- c("X","Y", "predLv3SndPeb")

Lv3SndPeb.rs.predict3 <- predict(Lv3SndPeb.prune, points3, type = c("vector"))
Lv3SndPeb.predict3 <- as.data.frame(Lv3SndPeb.rs.predict3[,2])
pred.Lv3SndPeb3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3SndPeb.predict3))
names(pred.Lv3SndPeb3) <- c("X","Y", "predLv3SndPeb")


#########################
## Helby Banks Predict ##
#########################

HB.Lv3SndPeb.rs.predict <- predict(HBLv3SndPeb.prune, HBpoints, type = c("vector"))
HB.Lv3SndPeb.predict <- as.data.frame(HB.Lv3SndPeb.rs.predict[,2])
predHB.Lv3SndPeb <- as.data.frame(cbind(HBpoints$Long, HBpoints$Lat,  HB.Lv3SndPeb.predict))
names(predHB.Lv3SndPeb) <- c("X","Y", "predLv3SndPeb")

#########################
## Tantabiddi Predict ##
#########################

TB.Lv3SndPeb.rs.predict <- predict(TBLv3SndPeb.prune, TBpoints, type = c("vector"))
TB.Lv3SndPeb.predict <- as.data.frame(TB.Lv3SndPeb.rs.predict[,2])
predTB.Lv3SndPeb <- as.data.frame(cbind(TBpoints$Long, TBpoints$Lat,  TB.Lv3SndPeb.predict))
names(predTB.Lv3SndPeb) <- c("X","Y", "predLv3SndPeb")

######################
## Mangrove Predict ##
######################

MG.Lv3SndPeb.rs.predict <- predict(MGLv3SndPeb.prune, MGpoints, type = c("vector"))
MG.Lv3SndPeb.predict <- as.data.frame(MG.Lv3SndPeb.rs.predict[,2])
predMG.Lv3SndPeb <- as.data.frame(cbind(MGpoints$Long, MGpoints$Lat,  MG.Lv3SndPeb.predict))
names(predMG.Lv3SndPeb) <- c("X","Y", "predLv3SndPeb")


###########################
## Southern Site Predict ##
###########################

SS.Lv3SndPeb.rs.predict <- predict(SSLv3SndPeb.prune, SSpoints, type = c("vector"))
SS.Lv3SndPeb.predict <- as.data.frame(SS.Lv3SndPeb.rs.predict[,2])
predSS.Lv3SndPeb <- as.data.frame(cbind(SSpoints$Long, SSpoints$Lat,  SS.Lv3SndPeb.predict))
names(predSS.Lv3SndPeb) <- c("X","Y", "predLv3SndPeb")


#####################
## Export to ASCII ##
#####################

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3SndPeb1) <- ~X+Y
ext <- extent(pred.Lv3SndPeb1)
table(diff(pred.Lv3SndPeb1@coords[,1]))
r <- raster(ext=ext,res=0.0000483000000031097)
to_ascii <- rasterize(pred.Lv3SndPeb1, r, 'predLv3SndPeb')
writeRaster(to_ascii,'AllLv3SndPeb1.asc', format='ascii')

coordinates(pred.Lv3SndPeb2) <- ~X+Y
ext2 <- extent(pred.Lv3SndPeb2)
r2 <- raster(ext=ext2,res=0.0000483000000031097)
to_ascii2 <- rasterize(pred.Lv3SndPeb2, r2, 'predLv3SndPeb')
writeRaster(to_ascii2,'AllLv3SndPeb2.asc', format='ascii', overwrite = TRUE)

coordinates(pred.Lv3SndPeb3) <- ~X+Y
ext3 <- extent(pred.Lv3SndPeb3)
r3 <- raster(ext=ext3,res=0.0000483000000031097)
to_ascii3 <- rasterize(pred.Lv3SndPeb3, r3, 'predLv3SndPeb')
writeRaster(to_ascii3,'AllLv3SndPeb3.asc', format='ascii')

# Helby Banks
coordinates(predHB.Lv3SndPeb) <- ~X+Y
extHB <- extent(predHB.Lv3SndPeb)
table(diff(predHB.Lv3SndPeb@coords[,1]))
rHB <- raster(ext=extHB,res=0.0000483000000031097)
to_asciiHB <- rasterize(predHB.Lv3SndPeb, rHB, 'predLv3SndPeb')
writeRaster(to_asciiHB,'HBLv3SndPeb.asc', format='ascii')


# Tantabiddi
coordinates(predTB.Lv3SndPeb) <- ~X+Y
extTB <- extent(predTB.Lv3SndPeb)
table(diff(predTB.Lv3SndPeb@coords[,1]))
rTB <- raster(ext=extTB,res=0.0000483000000031097)
to_asciiTB <- rasterize(predTB.Lv3SndPeb, rTB, 'predLv3SndPeb')
writeRaster(to_asciiTB,'TBLv3SndPeb.asc', format='ascii')

# Mangrove
coordinates(predMG.Lv3SndPeb) <- ~X+Y
extMG <- extent(predMG.Lv3SndPeb)
table(diff(predMG.Lv3SndPeb@coords[,1]))
rMG <- raster(ext=extMG,res=0.0000483000000031097)
to_asciiMG <- rasterize(predMG.Lv3SndPeb, rMG, 'predLv3SndPeb')
writeRaster(to_asciiMG,'MGLv3SndPeb.asc', format='ascii')


# Southern Site
coordinates(predSS.Lv3SndPeb) <- ~X+Y
extSS <- extent(predSS.Lv3SndPeb)
table(diff(predSS.Lv3SndPeb@coords[,1]))
rSS <- raster(ext=extSS,res=0.00004500000005447)
to_asciiSS <- rasterize(predSS.Lv3SndPeb, rSS, 'predLv3SndPeb')
writeRaster(to_asciiSS,'SSLv3SndPeb.asc', format='ascii')


################################################################
## WRITE OUT.PREDICT files to CSV to use for ROC CALCULATIONS ##
################################################################

setwd("C:/OneDrive/C3_Map/Model_Outputs/ROCtests")

write.csv(out.predict.Lv3SndPeb, "60_OutPredict_All_Lv3SndPeb_5m.csv")
write.csv(out.predict.HBLv3SndPeb, "79_OutPredict_HB_Lv3SndPeb_5m.csv")
write.csv(out.predict.TBLv3SndPeb, "80_OutPredict_TB_Lv3SndPeb_5m.csv")
write.csv(out.predict.MGLv3SndPeb, "81_OutPredict_MG_Lv3SndPeb_5m.csv")
write.csv(out.predict.SSLv3SndPeb, "82_OutPredict_SS_Lv3SndPeb_5m.csv")

```










```{r}

################################
#### Level 3 - SANDY GRAVEL ####
################################

Lv3SndGrv.tree <- tree(as.factor(Lv3_Sandy_Gravel) ~ curv +	curv_plan +	curv_prof +	slope +	mean3 +	mean5 +	
                          mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	range25 +
                       hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	BPI_F_15 +
                       BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250 +	Depth + BScatter,
                     data= model, na.action = na.exclude, method = "class")
plot(Lv3SndGrv.tree); text(Lv3SndGrv.tree,cex=0.5)
summary(Lv3SndGrv.tree)


# Select the best model variables
Lv3SndGrv.tree <- tree(as.factor(Lv3_Sandy_Gravel) ~ mean3 + BPI_B_100 + range10 + BScatter + BPI_B_250 + mean10 +
                         BPI_B_50 + Depth + hyp25 + range25 + std25 + rugosity + mean25,
                        data=model, method = "class")

summary(Lv3SndGrv.tree) # MISCLASSIFICATION RATE 2.2%


#################
## Helby Banks ##
#################

HBLv3SndGrv.tree <- tree(as.factor(Lv3_Sandy_Gravel) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= HBmodel, na.action = na.exclude, method = "class")
plot(HBLv3SndGrv.tree); text(HBLv3SndGrv.tree,cex=0.5)
summary(HBLv3SndGrv.tree)

# Select the best model variables
HBLv3SndGrv.tree <- tree(as.factor(Lv3_Sandy_Gravel) ~ BPI_B_100 + mean25 + BPI_B_250 + Depth + range25 +
                         std10 + hyp25,
                        data=HBmodel, method = "class")

summary(HBLv3SndGrv.tree) # MISCLAssIFICATION RATE 0.08%


################
## Tantabiddi ##
################

TBLv3SndGrv.tree <- tree(as.factor(Lv3_Sandy_Gravel) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= TBmodel, na.action = na.exclude, method = "class")
plot(TBLv3SndGrv.tree); text(TBLv3SndGrv.tree,cex=0.5)
summary(TBLv3SndGrv.tree)

# Select the best model variables
TBLv3SndGrv.tree <- tree(as.factor(Lv3_Sandy_Gravel) ~ Depth + BPI_B_100 + range25 + std25,
                        data=TBmodel, method = "class")

summary(TBLv3SndGrv.tree) # MISCLATBIFICATION RATE 0.1%

##############
## Mangrove ##
##############

MGLv3SndGrv.tree <- tree(as.factor(Lv3_Sandy_Gravel) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= MGmodel, na.action = na.exclude, method = "class")
plot(MGLv3SndGrv.tree); text(MGLv3SndGrv.tree,cex=0.5)
summary(MGLv3SndGrv.tree)

# Select the best model variables
MGLv3SndGrv.tree <- tree(as.factor(Lv3_Sandy_Gravel) ~ range25 + std25 + BPI_B_250 + mean10 + hyp10 + std10 + rugosity,
                        data=MGmodel, method = "class")

summary(MGLv3SndGrv.tree) # MISCLAMGIFICATION RATE 0.3%


##################
# Southern Site ##
##################

SSLv3SndGrv.tree <- tree(as.factor(Lv3_Sandy_Gravel) ~ Depth + BScatter + curv +	curv_plan +	curv_prof +	slope +	mean3 +	
                            mean5 + mean10 + mean25 +	std3 +	std5 +	std10 +	std25 +	range3 +	range5 +	range10 +	
                         range25 + hyp3 +	hyp5 +	hyp10 +	hyp25 +	rugosity +	east +	north +	BPI_F_10 +	
                         BPI_F_15 + BPI_F_25 +	BPI_B_50 +	BPI_B_100 +	BPI_B_250,
                     data= SSmodel, na.action = na.exclude, method = "class")
plot(SSLv3SndGrv.tree); text(SSLv3SndGrv.tree,cex=0.5)
summary(SSLv3SndGrv.tree)

# Select the best model variables
SSLv3SndGrv.tree <- tree(as.factor(Lv3_Sandy_Gravel) ~ mean25 + range25 + BPI_B_50 + Depth + rugosity + std5 + std25,
                        data=SSmodel, method = "class")

summary(SSLv3SndGrv.tree) # MISCLASSIFICATION RATE 0.46%



########################################################
## Investigating and Pruning the classification trees ##
########################################################

#############
# All sites #
#############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        Lv3SndGrv.fit1  <- cv.tree(Lv3SndGrv.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(Lv3SndGrv.fit1)
        summary(Lv3SndGrv.fit1)
        }
par(mfrow=c(1,1)) 



# pruning the tree based on visual inspection of misclassification rate plots using CV

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2    # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        Lv3SndGrv.prune <- prune.misclass(Lv3SndGrv.tree, best = TreeSize) 
        plot(Lv3SndGrv.prune); text(Lv3SndGrv.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(Lv3SndGrv.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


Lv3SndGrv.prune <- prune.misclass(Lv3SndGrv.tree, best = 4)         # choose best tree size and add value in!!!
plot(Lv3SndGrv.prune); text(Lv3SndGrv.prune,cex=0.8)
summary(Lv3SndGrv.prune) # 2.2% misclassification

Lv3SndGrv.predict <- predict(Lv3SndGrv.prune, test, type = c("vector"))
Lv3SndGrv.predict <- as.data.frame(Lv3SndGrv.predict [,2])
out.predict.Lv3SndGrv <- as.data.frame(cbind(test$Long, test$Lat, 
   test$Lv3_Sandy_Gravel, Lv3SndGrv.predict))
names(out.predict.Lv3SndGrv) <- c("X", "Y", "Lv3SndGrv.test", "Lv3SndGrv.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/All_Sites_Lv3SndGrv_prune.txt")
Lv3SndGrv.prune 
sink()



###############
# Helby Banks #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats croHB validation proceHB to create 4 graphs of miscalHBification
        HBLv3SndGrv.fit1  <- cv.tree(HBLv3SndGrv.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(HBLv3SndGrv.fit1)
        summary(HBLv3SndGrv.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 6   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune proceHB to create 4 graphsof miscalHBification
        HBLv3SndGrv.prune <- prune.misclass(HBLv3SndGrv.tree, best = TreeSize) 
        plot(HBLv3SndGrv.prune); text(HBLv3SndGrv.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(HBLv3SndGrv.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


HBLv3SndGrv.prune <- prune.misclass(HBLv3SndGrv.tree, best = 10)         # choose best tree size and add value in!!!
plot(HBLv3SndGrv.prune); text(HBLv3SndGrv.prune,cex=0.8)
summary(HBLv3SndGrv.prune) # misclaHBification rate 10.7%

HBLv3SndGrv.predict <- predict(HBLv3SndGrv.prune, HBtest, type = c("vector"))
HBLv3SndGrv.predict <- as.data.frame(HBLv3SndGrv.predict [,2])
out.predict.HBLv3SndGrv <- as.data.frame(cbind(HBtest$Long, HBtest$Lat, 
   HBtest$Lv3_Sandy_Gravel, HBLv3SndGrv.predict))
names(out.predict.HBLv3SndGrv) <- c("X", "Y", "Lv3SndGrv.test", "Lv3SndGrv.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/HB_Lv3SndGrv_prune.txt")
HBLv3SndGrv.prune 
sink()

###############
# Tantabiddi #
###############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats croTB validation proceTB to create 4 graphs of miscalTBification
        TBLv3SndGrv.fit1  <- cv.tree(TBLv3SndGrv.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(TBLv3SndGrv.fit1)
        summary(TBLv3SndGrv.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 2   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune proceTB to create 4 graphsof miscalTBification
        TBLv3SndGrv.prune <- prune.misclass(TBLv3SndGrv.tree, best = TreeSize) 
        plot(TBLv3SndGrv.prune); text(TBLv3SndGrv.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(TBLv3SndGrv.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


TBLv3SndGrv.prune <- prune.misclass(TBLv3SndGrv.tree, best = 8)         # choose best tree size and add value in!!!
plot(TBLv3SndGrv.prune); text(TBLv3SndGrv.prune,cex=0.8)
summary(TBLv3SndGrv.prune) # misclaTBification rate 0.1%

TBLv3SndGrv.predict <- predict(TBLv3SndGrv.prune, TBtest, type = c("vector"))
TBLv3SndGrv.predict <- as.data.frame(TBLv3SndGrv.predict [,2])
out.predict.TBLv3SndGrv <- as.data.frame(cbind(TBtest$Long, TBtest$Lat, 
   TBtest$Lv3_Sandy_Gravel, TBLv3SndGrv.predict))
names(out.predict.TBLv3SndGrv) <- c("X", "Y", "Lv3SndGrv.test", "Lv3SndGrv.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/TB_Lv3SndGrv_prune.txt")
TBLv3SndGrv.prune 
sink()


############
# Mangrove #
############

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats croMG validation proceMG to create 4 graphs of miscalMGification
        MGLv3SndGrv.fit1  <- cv.tree(MGLv3SndGrv.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(MGLv3SndGrv.fit1)
        summary(MGLv3SndGrv.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 4   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune proceMG to create 4 graphsof miscalMGification
        MGLv3SndGrv.prune <- prune.misclass(MGLv3SndGrv.tree, best = TreeSize) 
        plot(MGLv3SndGrv.prune); text(MGLv3SndGrv.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(MGLv3SndGrv.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


MGLv3SndGrv.prune <- prune.misclass(MGLv3SndGrv.tree, best = 10)         # choose best tree size and add value in!!!
plot(MGLv3SndGrv.prune); text(MGLv3SndGrv.prune,cex=0.8)
summary(MGLv3SndGrv.prune) # misclaMGification rate 0.38%

MGLv3SndGrv.predict <- predict(MGLv3SndGrv.prune, MGtest, type = c("vector"))
MGLv3SndGrv.predict <- as.data.frame(MGLv3SndGrv.predict [,2])
out.predict.MGLv3SndGrv <- as.data.frame(cbind(MGtest$Long, MGtest$Lat, 
   MGtest$Lv3_Sandy_Gravel, MGLv3SndGrv.predict))
names(out.predict.MGLv3SndGrv) <- c("X", "Y", "Lv3SndGrv.test", "Lv3SndGrv.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/MG_Lv3SndGrv_prune.txt")
MGLv3SndGrv.prune 
sink()

#################
# Southern Site #
################

par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2columns - 4 per page
for (i in 1:4) {                # repeats cross validation process to create 4 graphs of miscalssification
        SSLv3SndGrv.fit1  <- cv.tree(SSLv3SndGrv.tree ,FUN = prune.misclass)  #default is 10 fold, k=10
        plot(SSLv3SndGrv.fit1)
        summary(SSLv3SndGrv.fit1)
        }
par(mfrow=c(1,1)) 


par(mfrow=c(2,2))               # makes graphs appear in 2 rows and 2 columns - 4 per page
TreeSize <- 4   # enter the minimum tree size - will try 4 different sizes increasing size by 2 eata timme.
for (i in 1:4) {                # repeats prune process to create 4 graphsof miscalssification
        SSLv3SndGrv.prune <- prune.misclass(SSLv3SndGrv.tree, best = TreeSize) 
        plot(SSLv3SndGrv.prune); text(SSLv3SndGrv.prune,cex=0.6,srt=0)
        title(paste("Tree Size used for pruning =", TreeSize))
        cat("\n\nTree Size based on Misclassification =", TreeSize) 
        print(summary(SSLv3SndGrv.prune))          # prints summary of 4 versions of pruned tree
        TreeSize = TreeSize + 2
}
par(mfrow=c(1,1))


SSLv3SndGrv.prune <- prune.misclass(SSLv3SndGrv.tree, best = 8)         # choose best tree size and add value in!!!
plot(SSLv3SndGrv.prune); text(SSLv3SndGrv.prune,cex=0.8)
summary(SSLv3SndGrv.prune) # misclassification rate 3.9%

SSLv3SndGrv.predict <- predict(SSLv3SndGrv.prune, SStest, type = c("vector"))
SSLv3SndGrv.predict <- as.data.frame(SSLv3SndGrv.predict [,2])
out.predict.SSLv3SndGrv <- as.data.frame(cbind(SStest$Long, SStest$Lat, 
   SStest$Lv3_Sandy_Gravel, SSLv3SndGrv.predict))
names(out.predict.SSLv3SndGrv) <- c("X", "Y", "Lv3SndGrv.test", "Lv3SndGrv.predicted")

sink("C:/OneDrive/C3_Map/Model_Outputs/Figures/SS_Lv3SndGrv_prune.txt")
SSLv3SndGrv.prune 
sink()



############
# Predict ##
############


###########
# ALL SITES 
###########

Lv3SndGrv.rs.predict1 <- predict(Lv3SndGrv.prune, points1, type = c("vector"))
Lv3SndGrv.predict1 <- as.data.frame(Lv3SndGrv.rs.predict1[,2])
pred.Lv3SndGrv1 <- as.data.frame(cbind(points1$Long, points1$Lat,  Lv3SndGrv.predict1))
names(pred.Lv3SndGrv1) <- c("X","Y", "predLv3SndGrv")

Lv3SndGrv.rs.predict2 <- predict(Lv3SndGrv.prune, points2, type = c("vector"))
Lv3SndGrv.predict2 <- as.data.frame(Lv3SndGrv.rs.predict2[,2])
pred.Lv3SndGrv2 <- as.data.frame(cbind(points2$Long, points2$Lat,  Lv3SndGrv.predict2))
names(pred.Lv3SndGrv2) <- c("X","Y", "predLv3SndGrv")

Lv3SndGrv.rs.predict3 <- predict(Lv3SndGrv.prune, points3, type = c("vector"))
Lv3SndGrv.predict3 <- as.data.frame(Lv3SndGrv.rs.predict3[,2])
pred.Lv3SndGrv3 <- as.data.frame(cbind(points3$Long, points3$Lat,  Lv3SndGrv.predict3))
names(pred.Lv3SndGrv3) <- c("X","Y", "predLv3SndGrv")


#########################
## Helby Banks Predict ##
#########################

HB.Lv3SndGrv.rs.predict <- predict(HBLv3SndGrv.prune, HBpoints, type = c("vector"))
HB.Lv3SndGrv.predict <- as.data.frame(HB.Lv3SndGrv.rs.predict[,2])
predHB.Lv3SndGrv <- as.data.frame(cbind(HBpoints$Long, HBpoints$Lat,  HB.Lv3SndGrv.predict))
names(predHB.Lv3SndGrv) <- c("X","Y", "predLv3SndGrv")

#########################
## Tantabiddi Predict ##
#########################

TB.Lv3SndGrv.rs.predict <- predict(TBLv3SndGrv.prune, TBpoints, type = c("vector"))
TB.Lv3SndGrv.predict <- as.data.frame(TB.Lv3SndGrv.rs.predict[,2])
predTB.Lv3SndGrv <- as.data.frame(cbind(TBpoints$Long, TBpoints$Lat,  TB.Lv3SndGrv.predict))
names(predTB.Lv3SndGrv) <- c("X","Y", "predLv3SndGrv")

######################
## Mangrove Predict ##
######################

MG.Lv3SndGrv.rs.predict <- predict(MGLv3SndGrv.prune, MGpoints, type = c("vector"))
MG.Lv3SndGrv.predict <- as.data.frame(MG.Lv3SndGrv.rs.predict[,2])
predMG.Lv3SndGrv <- as.data.frame(cbind(MGpoints$Long, MGpoints$Lat,  MG.Lv3SndGrv.predict))
names(predMG.Lv3SndGrv) <- c("X","Y", "predLv3SndGrv")


###########################
## Southern Site Predict ##
###########################

SS.Lv3SndGrv.rs.predict <- predict(SSLv3SndGrv.prune, SSpoints, type = c("vector"))
SS.Lv3SndGrv.predict <- as.data.frame(SS.Lv3SndGrv.rs.predict[,2])
predSS.Lv3SndGrv <- as.data.frame(cbind(SSpoints$Long, SSpoints$Lat,  SS.Lv3SndGrv.predict))
names(predSS.Lv3SndGrv) <- c("X","Y", "predLv3SndGrv")


#####################
## Export to ASCII ##
#####################

setwd("C:/OneDrive/C3_Map/Model_Outputs/Lv3Outputs")

# All Sites
coordinates(pred.Lv3SndGrv1) <- ~X+Y
ext <- extent                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          